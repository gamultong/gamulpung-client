(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{6124:function(e,t,n){Promise.resolve().then(n.bind(n,5352))},5352:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return eg}});var r=n(7437),o=n(7397),i=n.n(o),s=n(2265);function a(){let[e,t]=(0,s.useState)({windowWidth:0,windowHeight:0});return(0,s.useEffect)(()=>{let e=()=>{t({windowWidth:1.1*window.innerWidth,windowHeight:1.1*window.innerHeight})};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),e}var l=n(3011);let c=(0,l.U)(e=>({x:1/0,y:1/0,content:"",movecost:0,setMovecost:t=>e({movecost:t}),setPosition:(t,n,r)=>e({x:t,y:n,content:r})})),u=(0,l.U)(e=>({useAnimation:!0,setAnimation:t=>e({useAnimation:t})}));var d=n(6507),h=n.n(d),f=JSON.parse('{"tileColors":{"inner":[["#8fe340","#A4E863"],["#62B628","#71C637"],["#F1FAD1","#E9F6B9"]],"outer":[["#A8EC67","#81D92C"],["#74C63C","#5BB31F"],["#E9FAAA","#F5FDD8"]]},"flagPaths":["M219.428 109.389 C226.519 114.964 223.188 126.337 214.21 127.205 L79.8702 140.188 L115.929 28.0267 L219.428 109.389 Z","M79.9801 8.51632 C75.8798 9.72627 73.972 13.8825 73.0599 18.0591 L25.8244 234.356 C30.5707 235.401 36.0988 236 42 236 C45.1362 236 48.1671 235.831 51.0311 235.515 L116.451 28.5289 C117.573 24.9766 117.96 21.0358 115.39 18.3387 C112.87 15.6942 108.055 12.4097 98.862 9.69397 C89.7757 7.00975 83.7643 7.39963 79.9801 8.51632 Z"],"boomPaths":[" M77.85 145.025 L0.899994 54.5752 L103.5 92.3752 L117 0.575195 L164.25 74.8252 L219.6 38.3752 L202.05 103.175 L276.3 108.575 L219.6 153.125 L287.1 223.325 L198 230.075 L177.75 312.425 L130.5 236.825 L67.05 284.075 L75.15 196.325 L11.7 177.425 L77.85 145.025 "," M67.05 104.525 L104.85 150.425 L71.1 169.325 L104.85 178.775 L100.8 226.025 L133.2 200.375 L158.85 239.525 L168.3 196.325 L218.25 192.275 L181.8 154.475 L212.85 131.525 L171 128.825 L181.8 93.7251 L152.1 113.975 L126.45 73.4751 L118.35 122.075 L67.05 104.525 "],"cursorPaths":"M1.50025 12.3269C-1.20902 5.52993 5.52992 -1.20901 12.3269 1.50027L52.892 17.6696C60.2374 20.5975 59.7565 31.1525 52.1752 33.4002L50.7 33.8376C42.5878 36.2427 36.2427 42.5878 33.8376 50.7L33.4002 52.1752C31.1525 59.7565 20.5975 60.2374 17.6696 52.892L1.50025 12.3269Z","countColors":["#0059B280","#0095B280","#00B20080","#77B20080","#B2950080","#B24A0080","#B2000080","#7700B280"],"stunPaths":["M129.815 125.662C130.503 123.446 133.497 123.446 134.185 125.662L139.22 141.887C139.527 142.878 140.409 143.549 141.404 143.549H157.699C159.924 143.549 160.849 146.53 159.049 147.899L145.866 157.927C145.061 158.539 144.724 159.625 145.032 160.616L150.067 176.841C150.755 179.057 148.333 180.899 146.533 179.53L133.35 169.502C132.545 168.89 131.455 168.89 130.65 169.502L117.467 179.53C115.667 180.899 113.245 179.057 113.933 176.841L118.968 160.616C119.276 159.625 118.939 158.539 118.134 157.927L104.951 147.899C103.151 146.53 104.076 143.549 106.301 143.549H122.596C123.591 143.549 124.473 142.878 124.78 141.887L129.815 125.662Z","M194.44 89.187C194.931 87.6043 197.069 87.6043 197.56 89.187L201.157 100.776C201.377 101.484 202.007 101.963 202.717 101.963H214.356C215.946 101.963 216.606 104.093 215.321 105.071L205.905 112.234C205.329 112.671 205.089 113.446 205.309 114.154L208.905 125.744C209.396 127.326 207.666 128.642 206.38 127.664L196.964 120.501C196.389 120.064 195.611 120.064 195.036 120.501L185.62 127.664C184.334 128.642 182.604 127.326 183.095 125.744L186.691 114.154C186.911 113.446 186.671 112.671 186.095 112.234L176.679 105.071C175.394 104.093 176.054 101.963 177.644 101.963H189.283C189.993 101.963 190.623 101.484 190.843 100.776L194.44 89.187Z","M170 93.7976C170 90.9223 167.92 88.439 165.054 88.2051C163.391 88.0694 161.705 88 160 88C139.889 88 122.445 97.66 113.794 111.795C111.465 115.603 114.57 120 119.034 120C121.483 120 123.681 118.599 125.072 116.583C131.592 107.134 144.005 100 160 100C160.973 100 161.933 100.026 162.879 100.078C166.586 100.281 170 97.5106 170 93.7976ZM206 132C202.686 132 200.06 134.723 199.266 137.94C196.313 149.9 184.652 160.816 167.768 163.416C164.571 163.908 162 166.522 162 169.756C162 173.154 164.823 175.908 168.191 175.457C190.725 172.44 208.443 157.177 211.524 137.977C212.049 134.705 209.314 132 206 132Z"]}');let x=(0,l.U)(e=>({id:"",position:{x:0,y:0},color:"blue",originPosition:{x:0,y:0},zoom:1,score:0,setId:t=>e({id:t}),setColor:t=>e({color:t}),setZoom:t=>e({zoom:t}),setOringinPosition:t=>e({originPosition:t}),goOriginTo:t=>e(e=>({originPosition:{x:e.originPosition.x+t.x,y:e.originPosition.y+t.y}})),setPosition:t=>e({position:t}),zoomUp:()=>e(e=>({zoom:1.5*e.zoom<1.7?1.5*e.zoom:e.zoom})),zoomDown:()=>e(e=>({zoom:e.zoom/1.5>.15?e.zoom/1.5:e.zoom})),moveUp:()=>e(e=>({position:{x:e.position.x,y:e.position.y-1}})),moveDown:()=>e(e=>({position:{x:e.position.x,y:e.position.y+1}})),moveLeft:()=>e(e=>({position:{x:e.position.x-1,y:e.position.y}})),moveRight:()=>e(e=>({position:{x:e.position.x+1,y:e.position.y}})),setScore:t=>e({score:t})})),g=(0,l.U)(e=>({cursors:[],addCursors:t=>e(e=>({cursors:[...e.cursors,...t]})),removeCursor:t=>e(e=>({cursors:e.cursors.filter(e=>e!==t)})),setCursors:t=>e({cursors:t})})),m=(0,l.U)(e=>({socket:null,message:"",isOpen:!1,connect:t=>{let n=new WebSocket(t);n.onopen=()=>e({socket:n,isOpen:!0}),n.onclose=()=>e({socket:null,isOpen:!1}),n.onmessage=t=>e({message:t.data})},disconnect:()=>{let{socket:t}=m.getState();null==t||t.close(),e({socket:null,isOpen:!1})},sendMessage:(e,t)=>{let{socket:n,isOpen:r}=m.getState(),o={header:{event:e},payload:t};console.log(o,r,n),r&&n&&n.send(JSON.stringify(o))}}));var y=n(2698),p=n.n(y);let C={CLOSED:"C",FLAGGED:"F",BOOM:"B"},w={CHAT:"CHAT",MOVE:"MOVE",OPEN_TILES:"OPEN-TILES",SET_FLAG:"SET-FLAG",SET_WINDOW:"SET-WINDOW",CREATE_CURSOR:"CREATE-CURSOR"},v={CHAT:"CHAT",CURSORS_STATE:"CURSORS-STATE",EXPLOSION:"EXPLOSION",MY_CURSOR:"MY-CURSOR",QUIT_CURSOR:"QUIT-CURSOR",SCOREBOARD_STATE:"SCOREBOARD-STATE",TILES_STATE:"TILES-STATE"},L={RIGHT:"R",LEFT:"L",UP:"U",DOWN:"D",ALL:"A"};function E(){let[e,t]=(0,s.useState)(""),[n,o]=(0,s.useState)(0),[i,l]=(0,s.useState)(0),[c,u]=(0,s.useState)(Date.now()),{sendMessage:d}=m(),{color:h,originPosition:f,zoom:y}=x(),{cursors:C}=g(),{windowHeight:v,windowWidth:L}=a(),E=(0,s.useRef)(null),b=(0,s.useRef)(null),k=e=>e?e-c>4e3?1:(e-c)/4e3:0,S={left:"51%",top:"51%",backgroundColor:h,opacity:k(i)};(0,s.useEffect)(()=>{if(!b.current||!e)return;let t=requestAnimationFrame(()=>{b.current&&o(b.current.getBoundingClientRect().width)});return()=>cancelAnimationFrame(t)},[e]);let M=e=>{var n;"Enter"===e.key&&(null===(n=E.current)||void 0===n||n.focus()),"Escape"===e.key&&(t(""),l(null))};return(0,s.useEffect)(()=>(window.addEventListener("keydown",M),()=>window.removeEventListener("keydown",M)),[]),(0,s.useEffect)(()=>{setTimeout(()=>u(Date.now()),1e3)},[c]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("form",{className:p().chat,onSubmit:n=>{n.preventDefault(),l(Date.now()+8e3),""===e||i<c||(d(w.CHAT,{message:e}),t(""))},style:S,children:[(0,r.jsx)("input",{type:"text",ref:E,className:p().message,value:e,maxLength:40,onChange:e=>{t(e.target.value),l(Date.now()+8e3)},style:{width:"".concat(n+5,"px"),color:"yellow"===h?"black":"white"}}),(0,r.jsx)("div",{ref:b,"aria-hidden":!0,children:e})]}),C.map((e,t)=>(0,r.jsx)("div",{className:p().chat,style:{left:"".concat(L/2+(e.position.x-f.x-1/y/2)*y*80,"px"),top:"".concat(v/2+(e.position.y-f.y-1/y/2)*y*80,"px"),backgroundColor:e.color,color:"yellow"===e.color?"black":"white",opacity:k(e.messageTime)},children:e.message},"".concat(e.id,"-").concat(t)))]})}var b=n(4648),k=n(1442);let S=e=>new Path2D(e),M=e=>{let t=[];return e.forEach(e=>t.push(new Path2D(e))),t},j=(e,t,n)=>{e.save(),e.fillStyle=n,e.fill(t),e.restore()},_=async(e,t,n,r)=>{let o=k.xEZ.from(e);try{let t=await createImageBitmap(e);o=k.xEZ.from(t)}catch(e){}finally{return o.baseTexture.scaleMode=k.aH$.NEAREST,o.baseTexture.mipmap=k.WBB.OFF,o.baseTexture.wrapMode=k.Nt$.CLAMP,o.baseTexture.setSize(t,n),"number"==typeof r&&(o.baseTexture.resolution=r),o}},A=e=>{let t=parseInt(e.replace("#",""),16);return{r:t>>16&255,g:t>>8&255,b:255&t}},T=(e,t,n)=>Math.round(e+(t-e)*n),R=[[-1,0],[0,-1],[0,1],[1,0],[-1,-1],[-1,1],[1,-1],[1,1]],F={red:"#FF4D00",blue:"#0094FF",yellow:"#F0C800",purple:"#BC3FDC",0:"#FF4D00",1:"#F0C800",2:"#0094FF",3:"#BC3FDC"},O={red:"#FBCBB6",blue:"#A8DBFF",yellow:"#FFEE99",purple:"#E8BEF3",0:"#FBCBB6",1:"#A8DBFF",2:"#FFEE99",3:"#E8BEF3"};function B(e){let{tiles:t,tileSize:n,tilePadWidth:o,tilePadHeight:i,className:l}=e,{flagPaths:c,tileColors:u,countColors:d,boomPaths:h}=f,{outer:g,inner:m}=u,{zoom:y}=x(),{windowHeight:p,windowWidth:w}=a(),v=(0,s.useRef)(new Map),L=(0,s.useRef)(new Map),[E,M]=(0,s.useState)(!1),[R,O]=(0,s.useState)(!1),B=()=>new Map,P=(0,s.useRef)(null),N=(0,s.useRef)([]),D=(0,s.useRef)({outerCachedSprite:B(),innerCachedSprite:B(),boomCachedSprite:B(),flagCachedSprite:B(),numberCachedSprite:B()}),I=e=>e.getContext("2d",{willReadFrequently:!1,desynchronized:!0}),W=e=>{let t=0,n=[],r=()=>{if(t>=e)return;let r=n.shift();r&&(t++,r())};return o=>new Promise((i,s)=>{let a=e=>{let n=o();n.then(i),n.catch(s),n.finally(()=>{!e&&t--,r()})};t>=e?n.push(a):a(!0)})};(0,s.useEffect)(()=>{(async()=>{let e=[],t=W(8),r=new Map;for(let o=1;o<=d.length;o++)e.push(t(async()=>{let e=document.createElement("canvas");e.width=e.height=n;let t=I(e);if(!t)return;t.clearRect(0,0,n,n),t.textAlign="center",t.textBaseline="middle",t.font="".concat(.6*n>>>0,"px LOTTERIACHAB"),t.fillStyle=d[o-1],t.imageSmoothingEnabled=!1,t.fillText("".concat(o),n/2,n/2);let i=await _(e,n,n,1);r.set(o,i)}));await Promise.all(e),L.current=r,O(!0)})();let e=v.current,t=(t,r)=>{let o="".concat(t).concat(r).concat(n);if(e.has(o))return;let i=document.createElement("canvas");i.width=i.height=4;let s=I(i);if(!s)return;let a=A(t),l=A(r);for(let e=0;e<4;e++){let t=e/3,n=T(a.r,l.r,t),r=T(a.g,l.g,t),o=T(a.b,l.b,t);s.fillStyle="rgb(".concat(n,",").concat(r,",").concat(o,")"),s.fillRect(e,0,1,4)}let c=k.xEZ.from(i);c.baseTexture.scaleMode=k.aH$.NEAREST,c.baseTexture.mipmap=k.WBB.OFF,c.baseTexture.wrapMode=k.Nt$.CLAMP,c.baseTexture.setSize(4,4),c.baseTexture.resolution=.001,e.set(o,c)};for(let e=0;e<g.length;e++)t(g[e][0],g[e][1]),t(m[e][0],m[e][1]);let r=[],o=W(8);r.push(o(async()=>{let t=document.createElement("canvas");t.width=t.height=n/3;let r=I(t);if(!r)return;r.scale(y/3/4,y/3/4),j(r,S(h[0]),"rgba(0, 0, 0, 0.6)"),j(r,S(h[1]),"rgba(0, 0, 0, 0.5)");let o=await _(t,n/3,n/3);e.set("boom",o)})),[0,1,2,3].forEach(t=>r.push(o(async()=>{let r=document.createElement("canvas");r.width=r.height=n/2;let o=I(r);if(!o)return;let i=o.createLinearGradient(36.5,212.5,36.5,259);i.addColorStop(0,"#E8E8E8"),i.addColorStop(1,"transparent"),o.translate(r.width/6,r.height/6),o.scale(y/2/4.5,y/2/4.5),j(o,S(c[0]),F[t]),j(o,S(c[1]),i);let s=await _(r,n,n);e.set("flag".concat(t),s)}))),Promise.all(r).finally(()=>M(!0))},[n]);let z=(e,t,n,r,o,i,s)=>({startCol:Math.max(0,Math.ceil(n-1)),endCol:Math.min(t-1,n+(o+s)/(s||1)>>>0),startRow:Math.max(0,Math.ceil(r-1)),endRow:Math.min(e-1,r+(i+s)/(s||1)>>>0)}),H=(e,t,n)=>{let r=(131071*e+t)*131+(0|n)>>>0;return{tileKeyNum:r,key:10*r>>>0}},U=e=>[C.CLOSED,C.FLAGGED].some(t=>t===e),G=(e,t)=>{if(!e||!U(e[0]))return{...t,closed:!1};let r=+e.slice(-1)%2,o=v.current,[i,s]=[g[r],m[r]];return{outerTexture:o.get("".concat(i[0]).concat(i[1]).concat(n))||t.outerTexture,innerTexture:o.get("".concat(s[0]).concat(s[1]).concat(n))||t.innerTexture,closed:!0}},Z=(e,t,n,r,o)=>{let i=(e-n)*o,s=(t-r)*o,a=Math.round(i),l=Math.round(s),c=Math.round(i+o),u=Math.round(s+o);return{xFloat:i,yFloat:s,startX:a,startY:l,endX:c,endY:u,w:c-a,h:u-l}};(0,s.useEffect)(()=>{let e=v.current,t=N.current,n=D.current;return()=>{e.forEach(e=>e.destroy()),e.clear(),t.forEach(e=>{let{outer:t,inner:n}=e;t.destroy(),n.destroy()}),N.current=[],Object.values(n).forEach(e=>e.clear())}},[]),(0,s.useLayoutEffect)(()=>{let e=P.current;if(!e)return;let t=Math.ceil((w/(n||1)+2)*(p/(n||1)+2));for(;N.current.length<t;){let t=new k.jyi;t.roundPixels=!0,t.eventMode="none",t.cullable=!0;let n=new k.jyi;n.roundPixels=!0,n.eventMode="none",n.cullable=!0,e.addChild(t),e.addChild(n),N.current.push({outer:t,inner:n})}for(let e=t;e<N.current.length;e++){let{outer:t,inner:n}=N.current[e];t.visible=n.visible=!1}let{current:r}=N,o=0;for(;o<X.length&&o<r.length;){let{outerTexture:e,innerTexture:t,startX:i,startY:s,endX:a,endY:l}=X[o],c=r[o++];c.outer.texture=e,c.outer.x=i,c.outer.y=s,c.outer.width=c.outer.height=n;let u=5*y,d=Math.round(i+u),h=Math.round(s+u),f=Math.round(a-u),x=Math.round(l-u);c.inner.x=d,c.inner.y=h,c.inner.texture=t,c.inner.width=Math.max(0,f-d),c.inner.height=Math.max(0,x-h),c.outer.visible=c.inner.visible=!0}for(;o<r.length;)r[o].outer.visible=r[o++].inner.visible=!1},[t]);let{outerSprites:V,innerSprites:J,boomSprites:Q,flagSprites:K,textElements:Y,closedEntries:X,bgKey:q}=(0,s.useMemo)(()=>{let e={outerSprites:[],innerSprites:[],boomSprites:[],flagSprites:[],textElements:[],closedEntries:[],bgKey:""},a=t.length;if(0===a)return e;let l=t[0].length;if(0===l)return e;let{startCol:c,endCol:u,startRow:d,endRow:h}=z(a,l,o,i,w,p,n);if(c>u||d>h||!Number.isFinite(c+u+d+h))return e;let f=Math.max(0,h-d+1|0)*Math.max(0,u-c+1|0);(!Number.isFinite(f)||f<0)&&(f=0);let x=Array(f),k=Array(f),S=Array(f),M=Array(f),j=Array(f),_=[],[A,T,F,O,B]=[0,0,0,0,0],[P,N]=[0,0],{outerCachedSprite:I,innerCachedSprite:W,boomCachedSprite:U,flagCachedSprite:V,numberCachedSprite:J}=D.current,Q=v.current,K={outerTexture:Q.get("".concat(g[2][0]).concat(g[2][1]).concat(n)),innerTexture:Q.get("".concat(m[2][0]).concat(m[2][1]).concat(n))};if(!K.outerTexture||!K.innerTexture)return e;for(let e=d;e<=h;e++)for(let a=c;a<=u;a++){var Y,X,q,$,ee;let{xFloat:l,yFloat:c,startX:u,startY:d,endX:h,endY:f,w:g,h:m}=Z(a,e,o,i,n),p=t[e][a],{outerTexture:w,innerTexture:v,closed:D}=G(p,K),{key:z}=H(e,a,n);if(D||(P++,N=N+((4099*e^131*a)>>>0)+(0|+p[0])>>>0),w){let e="".concat(w.baseTexture.uid).concat(n),t=null!==(Y=I.get(e))&&void 0!==Y?Y:(0,r.jsx)(b.jy,{cullable:!1,roundPixels:!0,eventMode:"none",texture:w});if(I.set(e,t),!D){let{width:e,height:n}=w,r={x:g/e,y:m/n};x[A++]=(0,s.cloneElement)(t,{key:z,x:u,y:d,scale:r})}}if(v){let e="".concat(v.baseTexture.uid).concat(n),t=5*y,o=Math.round(l+t),i=Math.round(c+t),a=Math.max(0,Math.round(u+g-t)-o),x=Math.max(0,Math.round(d+m-t)-i),p=null!==(X=W.get(e))&&void 0!==X?X:(0,r.jsx)(b.jy,{cullable:!1,roundPixels:!0,eventMode:"none",texture:v});if(W.set(e,p),D)_.push({startX:u,startY:d,endX:h,endY:f,outerTexture:w,innerTexture:v});else{let{width:e,height:t}=v,n={x:a/e,y:x/t};k[T++]=(0,s.cloneElement)(p,{key:z,x:o,y:i,scale:n})}}if(p===C.BOOM&&E){let e="boom".concat(n),t=Q.get("boom"),o=null!==(q=U.get(e))&&void 0!==q?q:(0,r.jsx)(b.jy,{cullable:!0,roundPixels:!0,eventMode:"none",texture:t});if(U.set(e,o),!t)continue;let{width:i,height:a}=t,l={x:g/i,y:m/a};S[F++]=(0,s.cloneElement)(o,{key:z,x:u,y:d,scale:l})}if(p[0]===C.FLAGGED&&E){let e=p[1],t="flag".concat(e).concat(n),o=Q.get("flag".concat(e)),i=null!==($=V.get(t))&&void 0!==$?$:(0,r.jsx)(b.jy,{cullable:!0,roundPixels:!0,eventMode:"none",texture:o,anchor:.5});if(V.set(t,i),!o)continue;let{width:a,height:l}=o,c={x:g/a,y:m/l};M[O++]=(0,s.cloneElement)(i,{key:z,x:u+n/2,y:d+n/2,scale:c})}let et=R?L.current.get(+p):void 0;if(!et)continue;let en="num".concat(p).concat(n),er=null!==(ee=J.get(en))&&void 0!==ee?ee:(0,r.jsx)(b.jy,{cullable:!0,roundPixels:!0,eventMode:"none",texture:et,anchor:.5});J.set(en,er);let{width:eo,height:ei}=et,es={x:g/eo,y:m/ei};j[B++]=(0,s.cloneElement)(er,{key:z+4,x:u+n/2,y:d+n/2,scale:es})}let et="".concat(n).concat(P).concat(N);return{outerSprites:x.slice(0,A),innerSprites:k.slice(0,T),boomSprites:S.slice(0,F),flagSprites:M.slice(0,O),textElements:j.slice(0,B),closedEntries:_,bgKey:et}},[t]);return E&&R?(0,r.jsx)(b.Hf,{id:"Tilemap",className:l,width:w,height:p,options:{backgroundColor:8421504,resolution:1,antialias:!1,powerPreference:"high-performance",autoDensity:!1,preserveDrawingBuffer:!1,clearBeforeRender:!0,sharedTicker:!0},children:(0,r.jsxs)(b.W2,{name:"container",sortableChildren:!1,eventMode:"none",cacheAsBitmap:!1,cullable:!0,children:[E&&(0,r.jsxs)(b.W2,{name:"background",eventMode:"none",cacheAsBitmap:!0,children:[V,J,Y]},"bg".concat(q)),(0,r.jsx)(b.W2,{name:"closed-layer",ref:P,eventMode:"none",sortableChildren:!1}),Q,K]})}):null}class P{constructor(e,t){this.x=e,this.y=t,this.gScore=1/0,this.heuristic=0,this.fTotal=1/0,this.parent=null}}var N=e=>{let{paddingTiles:t,tiles:n,tileSize:o,cursorOriginX:i,cursorOriginY:l,startPoint:d,leftReviveTime:y}=e,p=o>>1,[v,L]=[i-d.x,l-d.y],b=1/(t-1),[k,j]=[(t-1)*v/t,(t-1)*L/t],[_,A]=[k*b,j*b],{boomPaths:T,cursorPaths:N,flagPaths:D,stunPaths:I}=f,{windowHeight:W,windowWidth:z}=a(),{setPosition:H,x:U,y:G,setMovecost:Z}=c(),{position:V,zoom:J,color:Q,setPosition:K,goOriginTo:Y}=x(),{cursors:X}=g(),{sendMessage:q}=m(),{useAnimation:$}=u(),ee=(0,s.useRef)(null),et={interactionCanvasRef:(0,s.useRef)(null),otherCursorsRef:(0,s.useRef)(null),otherPointerRef:(0,s.useRef)(null),myCursorRef:(0,s.useRef)(null)},[en,er]=(0,s.useState)(!0),[eo,ei]=(0,s.useState)([]),[es,ea]=(0,s.useState)({x:0,y:0}),[el,ec]=(0,s.useState)(),[eu,ed]=(0,s.useState)(),eh=()=>{ee.current&&(clearInterval(ee.current),ee.current=null)},ef=()=>{Object.values(et).forEach(e=>{if(e.current){let t=e.current.getContext("2d");null==t||t.clearRect(0,0,e.current.width,e.current.height)}}),ed(void 0)},ex=(e,t)=>{let n=e.getBoundingClientRect();e.width=n.width,e.height=n.height,e.style.width=n.width+"px",e.style.height=n.height+"px",t.imageSmoothingEnabled=!0,t.imageSmoothingQuality="high","textRenderingOptimization"in t&&(t.textRenderingOptimization="optimizeQuality")};(0,s.useEffect)(()=>{let e=e=>e.preventDefault();return window.addEventListener("contextmenu",e),()=>{window.removeEventListener("contextmenu",e),eh()}},[]);let eg=e=>{let t=e[0];return t!==C.CLOSED&&t!==C.FLAGGED},em=(e,t,n,r)=>{if(ee.current)return;let i=0,s=ek(v,L,e,t),a=s[i];if((null==a?void 0:a.x)===void 0||(null==a?void 0:a.y)===void 0)return;let[l,c]=[V.x,V.y];Z(s.length-1),K({x:e+d.x,y:t+d.y});let u=(e,t)=>{let{interactionCanvasRef:n,otherCursorsRef:r,otherPointerRef:i}=et,s=document.getElementById("Tilemap"),a=[n.current,r.current,i.current,s],l=performance.now(),c=n=>{let r=Math.min((n-l)/200,1),i=o*(1-r),[s,u]=[i*e,i*t];a.forEach(e=>e.style.transform="translate(".concat(s,"px, ").concat(u,"px)")),r<1?requestAnimationFrame(c):a.forEach(e=>e.style.transform="translate(0, 0)")};requestAnimationFrame(c)};ee.current=setInterval(()=>{if(++i>=s.length){ey(n,r,w.MOVE),ei([]),eh();return}let e=s[i];if(!e)return;let[t,o]=[Math.sign(e.x-a.x),Math.sign(e.y-a.y)];ec({x:t,y:o}),Y({x:t,y:o}),[l,c]=[t+l,o+c],a=e,ei(s.slice(i)),$&&u(t,o)},200)},ey=(e,t,n)=>{let{MOVE:r,OPEN_TILES:o,SET_FLAG:i}=w;[r,o,i].some(e=>e===n)&&q(n,{position:{x:e,y:t}})},ep=(e,t)=>R.some(n=>{let[r,o]=n;return i+r===e&&l+o===t}),eC=(e,t)=>{let r={x:1/0,y:1/0};return[[0,0],...R].some(o=>{let[i,s]=o,a=e+i,l=t+s;return!!(n[l]&&n[l][a]&&eg(n[l][a]))&&(r={x:a,y:l},!0)}),r},ew=(0,s.useCallback)(function(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,l=J*a;if(e.save(),e.fillStyle=r,e.translate(t,n),1===a){let t=p>>2;switch((Math.round((s+Math.PI)/(Math.PI/4))+2)%8){case 0:e.translate(p,t);break;case 1:e.translate(o-t,t);break;case 2:e.translate(o-t,p);break;case 3:e.translate(o-t,o-t);break;case 4:e.translate(p,o-t);break;case 5:e.translate(t,o-t);break;case 6:e.translate(t,p);break;case 7:e.translate(t,t)}}else e.translate(p,p);if(e.rotate(s-Math.PI/4),e.scale(l,l),e.fill(eu.cursor),e.restore(),!(i>0&&Date.now()<i&&(null==eu?void 0:eu.stun)))return;let c=J/2;e.save(),e.translate(t-p,n-p),e.fillStyle="white",e.strokeStyle="black",e.scale(c,c),eu.stun.forEach(t=>{e.fill(t),e.stroke(t)}),e.restore()},[o,eu]),ev=(0,s.useCallback)(()=>{let e=et.otherCursorsRef.current;if(!e)return;let t=e.getContext("2d");t&&(ex(e,t),t.clearRect(0,0,z,W),X.forEach(e=>{var n;let{position:r,color:s,revive_at:a}=e,{x:c,y:u}=null!==(n=null==e?void 0:e.pointer)&&void 0!==n?n:{x:1/0,y:1/0},[d,h]=[r.x-i+_,r.y-l+A],[f,x]=[r.x-c,r.y-u];ew(t,d*o,h*o,F[s],a,0!==f||0!==x?Math.atan2(x,f):0)}))},[X,i,l,k,j,o,z,W,et.otherCursorsRef]),eL=(0,s.useCallback)((e,t,n,r,i)=>{e&&(e.beginPath(),e.strokeStyle=r,e.lineWidth=i,e.strokeRect(t+i/2,n+i/2,o-i,o-i),e.closePath())},[o]),eE=e=>{let t=et.otherPointerRef.current;if(!t)return;let n=t.getContext("2d");n&&(ex(t,n),n.clearRect(0,0,z,W),X.forEach(t=>{let{pointer:r,color:s}=t,{x:a,y:c}=null!=r?r:{x:0,y:0},[u,d]=[a-i+_,c-l+A];eL(n,u*o,d*o,O[s],e)}))},eb=(e,t)=>X.some(n=>n.position.x===e+d.x&&n.position.y===t+d.y),ek=(e,t,r,o)=>{let i=(e,t)=>{let n=[];for(let[r,o]of R){let[i,s]=[t.x+r,t.y+o];s<0||s>=e.length||i<0||i>=e[s].length||null===e[s][i]||eb(i,s)||n.push({node:e[s][i],isDiagonal:0!==r&&0!==o})}return n},s=(e,t,n)=>({x:e.x-t,y:e.y-n}),[a,l]=[new P(e,t),new P(r,o)],c=n.map((e,t)=>e.map((e,n)=>eg(e)?new P(n,t):null)),u=[a],d=[];for(a.gScore=0,a.fTotal=a.gScore+a.heuristic;u.length>0;){let n=u.reduce((e,t)=>e.fTotal<t.fTotal?e:t);if(n.x===l.x&&n.y===l.y){ea(s(n,e,t));let r=[];for(let o=n;o;o=o.parent)r.unshift({x:o.x-e,y:o.y-t});return r}for(let{node:e,isDiagonal:t}of(u=u.filter(e=>e!==n),d.push(n),i(c,n))){if(d.includes(e))continue;let r=n.gScore+(t?14:10);r>=e.gScore||(u.includes(e)||u.push(e),e.parent=n,e.gScore=r,e.heuristic=Math.abs(e.x-l.x)+Math.abs(e.y-l.y),e.fTotal=e.gScore+e.heuristic)}}return[]},eS=()=>{let{interactionCanvasRef:e,myCursorRef:n,otherCursorsRef:r,otherPointerRef:s}=et,{current:a}=e,{current:c}=n,{current:u}=r,{current:d}=s;if(!a||!c||!u||!d)return;let[h,f]=[a.getContext("2d"),c.getContext("2d")];if(!h||!f)return;ex(a,h),ex(c,f),f.clearRect(0,0,z,W),h.clearRect(0,0,z,W);let x=F[Q],g=5*J,m={x:v/t*o,y:L/t*o},y={x:m.x+(U-i)*o,y:m.y+(G-l)*o},C={x:m.x-i-k-es.x+v+.5,y:m.y-l-j-es.y+L+.5},w=(i!==U||l!==G)&&el?Math.atan2(-el.y,-el.x):0;ew(f,m.x,m.y,x,0,w),eL(h,y.x,y.y,x,g),ev(),eE(g);let E=null==eo?void 0:eo.map(e=>{let[t,n]=[e.x+C.x,e.y+C.y];return{x:t*o,y:n*o}});if(E.length<=1)return;h.beginPath(),h.strokeStyle=x,h.lineWidth=o/10,h.lineJoin=h.lineCap="round",h.miterLimit=2;let b=.15*o;h.moveTo(E[0].x,E[0].y);for(let e=1;e<E.length-1;e++){let[t,n,r]=[...E.slice(e-1,e+2)],[o,i]=[n.x-t.x,n.y-t.y],[s,a]=[r.x-n.x,r.y-n.y],[l,c]=[Math.hypot(o,i),Math.hypot(s,a)],u=o*a-i*s,d=(o*s+i*a)/(l*c);if(1e-6>Math.abs(u)||d>.995)h.lineTo(n.x,n.y);else{let e=Math.min(b,.5*Math.min(l,c));h.arcTo(n.x,n.y,r.x,r.y,e)}}let[S,M]=[...E.slice(-2)],[_,A]=[(M.x+S.x)/2,(M.y+S.y)/2],T=Math.PI+Math.atan2(M.y-S.y,M.x-S.x);h.lineTo(_,A),ew(h,_-p,A-p,x,0,T,.6),h.stroke()};return(0,s.useLayoutEffect)(()=>{if(!en&&n.length>0)return;let e=async()=>{try{if(document.fonts.check("1em LOTTERIACHAB"))return;let e=new FontFace("LOTTERIACHAB","url('https://fastly.jsdelivr.net/gh/projectnoonnu/noonfonts_2302@1.0/LOTTERIACHAB.woff2') format('woff2')");await e.load(),document.fonts.add(e)}catch(e){console.warn("Font loading failed, using fallback font")}},t=S(N);ed({cursor:t,stun:M(I),flag:{flag:S(D[0]),pole:S(D[1])},boom:{inner:S(T[0]),outer:S(T[1])}}),er(!1),e()},[n,en]),(0,s.useEffect)(()=>{en||eS()},[i,l,d,U,G,Q,X]),(0,s.useEffect)(()=>()=>{eh(),ef()},[]),(0,r.jsxs)(r.Fragment,{children:[en&&(0,r.jsxs)("div",{className:h().loading,children:[(0,r.jsx)("h1",{children:"Assets Loading..."}),(0,r.jsx)("div",{className:"".concat(n.length<1?h().loadingBar:h().loadComplete)})]}),!en&&(0,r.jsxs)("div",{className:"".concat(h().canvasContainer," ").concat(y>0?h().vibration:""),children:[(0,r.jsx)(E,{}),(0,r.jsx)(B,{className:h().canvas,tilePadHeight:j,tilePadWidth:k,tileSize:o,tiles:n}),(0,r.jsx)("canvas",{className:h().canvas,id:"OtherCursors",ref:et.otherCursorsRef,width:z,height:W}),(0,r.jsx)("canvas",{className:h().canvas,id:"OtherPointer",ref:et.otherPointerRef,width:z,height:W}),(0,r.jsx)("canvas",{className:h().canvas,id:"MyCursor",ref:et.myCursorRef,width:z,height:W}),(0,r.jsx)("canvas",{className:h().canvas,id:"InteractionCanvas",ref:et.interactionCanvasRef,width:z,height:W,onPointerDown:e=>{var t,r;let i=et.interactionCanvasRef.current;if(!i)return;let{left:s,top:a}=i.getBoundingClientRect(),[l,c]=[e.clientX-s,e.clientY-a],[u,h]=[l/o+k>>>0,c/o+j>>>0],[f,x]=[Math.round(u+d.x),Math.round(h+d.y)],g=null!==(r=null===(t=n[h])||void 0===t?void 0:t[u])&&void 0!==r?r:"Out of bounds";H(f,x,g);let m=g.includes(C.CLOSED),y=2!==e.buttons?"general":"special";if(m)"special"===y&&ey(f,x,w.SET_FLAG),"general"===y&&ey(f,x,w.OPEN_TILES);else if(g.includes(C.FLAGGED))ey(f,x,w.SET_FLAG);else{if("special"===y)return;let{x:e,y:t}=eC(u,h);if(ep(f,x)&&([e,t]=[u,h]),eo.length>0)return;em(e,t,f,x)}}})]})]})},D=n(2723),I=n.n(D);function W(e){let{time:t}=e;return(0,r.jsxs)("div",{className:I().inactive,children:[(0,r.jsxs)("div",{className:I().alert,children:[(0,r.jsx)("p",{children:"You`re stunned!"}),(0,r.jsx)("p",{children:"Try Again After"}),(0,r.jsxs)("p",{children:[t/60>>>0,":",(t%60).toString().padStart(2,"0")]})]}),(0,r.jsx)("div",{className:I().ad,children:"광고 받습니다: kkh061101@naver.com"})]})}var z=n(6324),H=n.n(z);function U(){return(0,r.jsx)("svg",{width:"22",height:"26",viewBox:"0 0 22 26",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,r.jsx)("path",{d:"M0.436226 1.88654C0.321855 0.917668 1.42232 0.282312 2.2042 0.865797L20.8289 14.7645C21.6738 15.3951 21.2476 16.7379 20.1937 16.7657L12.1637 16.978C11.0359 17.0078 9.99976 17.606 9.41006 18.5678L5.21123 25.4159C4.66013 26.3147 3.28415 26.0124 3.16055 24.9653L0.436226 1.88654Z",fill:"white"})})}function G(){return(0,r.jsx)("svg",{width:"24",height:"14",viewBox:"0 0 24 14",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,r.jsx)("path",{d:"M2 2L11.5286 11.5286C11.7889 11.7889 12.2111 11.7889 12.4714 11.5286L22 2",stroke:"white",strokeWidth:"4",strokeLinecap:"round"})})}function Z(){return(0,r.jsxs)("svg",{width:"32",height:"32",viewBox:"0 0 32 32",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,r.jsx)("path",{d:"M20 5L26 5C26.5523 5 27 5.44772 27 6L27 12",stroke:"white",strokeWidth:"4",strokeLinecap:"round"}),(0,r.jsx)("path",{d:"M12 27L6 27C5.44772 27 5 26.5523 5 26L5 20",stroke:"white",strokeWidth:"4",strokeLinecap:"round"}),(0,r.jsx)("path",{d:"M5 12L5 6C5 5.44772 5.44772 5 6 5L12 5",stroke:"white",strokeWidth:"4",strokeLinecap:"round"}),(0,r.jsx)("path",{d:"M27 20L27 26C27 26.5523 26.5523 27 26 27L20 27",stroke:"white",strokeWidth:"4",strokeLinecap:"round"})]})}function V(){return(0,r.jsxs)("svg",{width:"32",height:"32",viewBox:"0 0 32 32",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,r.jsx)("circle",{cx:"14",cy:"14",r:"9",stroke:"white",strokeWidth:"4"}),(0,r.jsx)("path",{d:"M27 27L21.5 21.5",stroke:"white",strokeWidth:"4",strokeLinecap:"round"})]})}function J(){return(0,r.jsx)("svg",{width:"24",height:"14",viewBox:"0 0 24 14",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,r.jsx)("path",{d:"M2 12L11.5286 2.4714C11.7889 2.21105 12.2111 2.21106 12.4714 2.4714L22 12",stroke:"white",strokeWidth:"4",strokeLinecap:"round"})})}function Q(e){let{tileSize:t,renderRange:n,maxTileCount:o}=e,{zoom:i,zoomDown:l,zoomUp:d,originPosition:h}=x(),{windowWidth:f,windowHeight:g}=a(),{x:m,y:y}=c(),{useAnimation:p,setAnimation:C}=u(),w=()=>f*n/(t/1.5)+g*n/(t/1.5)>o,[v,L]=(0,s.useState)(!0);return(0,r.jsx)("div",{className:H().dashboard,children:(0,r.jsxs)("div",{className:H().bottom,children:[(0,r.jsxs)("div",{className:H().toggle,onPointerDown:()=>L(!v),children:[!v&&(0,r.jsx)(G,{}),v&&(0,r.jsx)(J,{})]}),v&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:H().coordinates,children:[(0,r.jsxs)("p",{children:["\xa0",(0,r.jsx)(U,{}),"(",h.x,", ",h.y,")"]}),(0,r.jsxs)("p",{children:[(0,r.jsx)(Z,{}),"\xa0(",m===1/0?"":m,", ",y===1/0?"":y,")"]}),(0,r.jsxs)("p",{className:H().animation,onClick:()=>C(!p),children:[(0,r.jsx)("input",{type:"checkbox",checked:p,readOnly:!0}),"Animation"]})]}),(0,r.jsxs)("div",{className:H().zoom,children:[(0,r.jsxs)("p",{children:[(0,r.jsx)(V,{}),"\xa0",Math.ceil(100*i),"%"]}),(0,r.jsxs)("div",{className:H().buttons,children:[(0,r.jsx)("button",{onPointerDown:()=>!w()&&l(),children:"-"}),(0,r.jsx)("button",{onPointerDown:d,children:"+"})]})]})]})]})})}var K=n(1071),Y=n.n(K),X=n(3145),q=JSON.parse('{"a":[{"id":1,"gif":"/mainvideos/moving.gif","description":{"en":"Click Open Tile to move cursor","ko":"열린 타일을 클릭하여 커서를 이동하세요"}},{"id":2,"gif":"/mainvideos/block.gif","description":{"en":"If the path to the tile you clicked is blocked, you cannot move.","ko":"클릭한 타일로 가는 길이 막혀있을 경우 이동이 되지 않습니다."}},{"id":3,"gif":"/mainvideos/zoom.gif","description":{"en":"Click - and + buttons to zoom in and out","ko":"확대 및 축소 버튼을 클릭하여 확대 및 축소하세요"}},{"id":4,"gif":"/mainvideos/open_tile.gif","description":{"en":"Click left mouse button on closed tile to open tile","ko":"닫힌 타일에 왼쪽 마우스 버튼을 클릭하여 타일을 엽니다"}},{"id":5,"gif":"/mainvideos/flag.gif","description":{"en":"Click right mouse button on open tile to flag tile","ko":"열린 타일에 오른쪽 마우스 버튼을 클릭하여 타일을 깃발로 표시하세요"}},{"id":6,"gif":"/mainvideos/mine.gif","description":{"en":"If the tile you clicked is a mine, you get a stun for 3 minutes","ko":"클릭한 타일이 지뢰인 경우 3분간 스턴을 받습니다"}},{"id":7,"gif":"/mainvideos/chat.gif","description":{"en":"If you click on a tile that is not a mine, the number of mines around the tile will be displayed","ko":"엔터 버튼을 누를 경우 채팅이 활성화 되며, 끄려면 ESC를 누르세요. 입력하고 엔터를 다시 누를 경우 채팅이 전송됩니다."}}]}'),$=n(9376);function ee(){return(0,r.jsxs)("svg",{width:"120",height:"120",viewBox:"0 0 120 120",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,r.jsx)("path",{d:"M25 55L58.2322 21.7678C59.2085 20.7915 60.7915 20.7915 61.7678 21.7678L95 55",stroke:"white",strokeWidth:"10",strokeLinecap:"round"}),(0,r.jsx)("path",{d:"M25 90L58.2322 56.7678C59.2085 55.7915 60.7915 55.7915 61.7678 56.7678L95 90",stroke:"white",strokeWidth:"10",strokeLinecap:"round"})]})}function et(){return(0,r.jsxs)("svg",{width:"120",height:"120",viewBox:"0 0 120 120",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,r.jsx)("path",{d:"M25 65L58.2322 98.2322C59.2085 99.2085 60.7915 99.2085 61.7678 98.2322L95 65",stroke:"white",strokeWidth:"10",strokeLinecap:"round"}),(0,r.jsx)("path",{d:"M25 30L58.2322 63.2322C59.2085 64.2085 60.7915 64.2085 61.7678 63.2322L95 30",stroke:"white",strokeWidth:"10",strokeLinecap:"round"})]})}function en(){let e="https://gamultong.github.io/gamulpung-client",t=(0,$.useSearchParams)().get("lang")||"ko",[n,o]=(0,s.useState)(-1),i=q.a[n];return(0,s.useEffect)(()=>{"done"!==localStorage.getItem("tutorial")&&o(0)},[]),(0,r.jsx)(r.Fragment,{children:-1!==n&&(0,r.jsxs)("div",{className:Y().tutorial,children:[(0,r.jsx)("div",{className:Y().button,onClick:()=>o(n>0?n-1:n),children:n>0&&(0,r.jsx)(ee,{})}),(0,r.jsxs)("div",{className:Y().step,children:[(0,r.jsx)(X.default,{src:"".concat(e).concat(i.gif),alt:i.gif,width:400,height:225}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("p",{children:["Step ",i.id]}),(0,r.jsx)("p",{children:i.description[t]})]})]}),(0,r.jsx)("div",{className:Y().button,onClick:()=>{n<q.a.length-1?o(n+1):(o(-1),localStorage.setItem("tutorial","done"))},children:q.a.length-1>n?(0,r.jsx)(et,{}):(0,r.jsx)(X.default,{src:"".concat(e,"/icon.png"),alt:"Play",width:88,height:88})})]})})}var er=n(1871),eo=n.n(er),ei=()=>(0,r.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,r.jsx)("path",{d:"M3.75 17.25H20.25V18.75C20.25 19.5784 19.5784 20.25 18.75 20.25H5.25C4.42157 20.25 3.75 19.5784 3.75 18.75V17.25Z",fill:"#FFB743"}),(0,r.jsx)("path",{d:"M20.25 15.75H3.75L2.48723 6.91058C2.39554 6.2688 3.1063 5.82087 3.64571 6.18047L7.875 9L11.36 3.29721C11.6525 2.81866 12.3475 2.81866 12.64 3.29721L16.125 9L20.3543 6.18048C20.8937 5.82087 21.6045 6.2688 21.5128 6.91058L20.25 15.75Z",fill:"#FFB743"})]});let es=(0,l.U)(e=>({rankings:[{ranking:1,score:12345},{ranking:2,score:12345},{ranking:3,score:12345},{ranking:4,score:12345},{ranking:5,score:12345},{ranking:6,score:12345},{ranking:7,score:12345},{ranking:8,score:12345},{ranking:9,score:12345},{ranking:10,score:12345}],setRanking:t=>e({rankings:t})}));function ea(){let{rankings:e}=es(),[t,n]=(0,s.useState)(!0);return(0,r.jsxs)("div",{className:eo().scoreboard,children:[(0,r.jsxs)("div",{className:eo().toggle,onPointerDown:()=>n(!t),children:[(0,r.jsx)("span",{children:"RANKING"}),t?(0,r.jsx)(G,{}):(0,r.jsx)(J,{})]}),t&&(0,r.jsx)("div",{className:eo().scoreList,children:e.map((e,t)=>(0,r.jsxs)("div",{className:eo().scoreItem,children:[(0,r.jsxs)("span",{children:["#",e.ranking," ",1===e.ranking&&(0,r.jsx)(ei,{})]}),(0,r.jsx)("span",{children:e.score})]},t))})]})}(0,l.U)(e=>({ranking:0,score:0,setRanking:t=>e({ranking:t.ranking,score:t.score})}));let el=[["F00","F01"],["F10","F11"],["F20","F21"],["F30","F31"]],ec=["O","1","2","3","4","5","6","7"],eu=Array(256),ed=Array(256),eh=Array(256),ef=new Int8Array(128);(()=>{for(let e=0;e<ef.length;e++)ef[e]=-1;for(let e=48;e<=57;e++)ef[e]=e-48;for(let e=65;e<=70;e++)ef[e]=e-55;for(let e=97;e<=102;e++)ef[e]=e-87})();let ex=new Uint8Array(65536);function eg(){let e="".concat("wss://gamulpung-server-prod.kimgh06.com","/session"),{}=c(),{setCursors:t,cursors:n}=g(),{isOpen:o,sendMessage:l,connect:u,disconnect:d}=m(),{position:h,zoom:f,originPosition:y}=x(),{setPosition:p,setOringinPosition:C,setId:E,id:b}=x(),{zoomUp:k,zoomDown:S,setZoom:M}=x(),{setRanking:j}=es(),{windowWidth:_,windowHeight:A}=a(),[T,R]=(0,s.useState)(0),[F,O]=(0,s.useState)({x:0,y:0}),[B,P]=(0,s.useState)({x:0,y:0}),[D,I]=(0,s.useState)({x:0,y:0}),[z,H]=(0,s.useState)([]),[U,G]=(0,s.useState)([...z.map(e=>[...e])]),[Z,V]=(0,s.useState)(-1),[J,K]=(0,s.useState)(!1),Y=(0,s.useRef)([]),X=(0,s.useRef)(0),q=(0,s.useRef)(null),$=(0,s.useRef)(!1),ee=(e,t,n,r,i)=>{if(!o||!J)return;let s=performance.now();if(i===L.ALL&&s-X.current<300)return;X.current=s;let[a,l]=[Math.abs(n-e)+1,Math.abs(t-r)+1],c=[...Y.current];switch(i){case L.UP:c=[...Array.from({length:l},()=>Array(a).fill("??")),...c.slice(0,-l)];break;case L.DOWN:c=[...c.slice(l),...Array.from({length:l},()=>Array(a).fill("??"))];break;case L.LEFT:for(let e=0;e<l;e++)c[e]&&(c[e]=[...Array(a).fill("??"),...c[e].slice(0,c[e].length-a)]);break;case L.RIGHT:for(let e=0;e<l;e++)c[e]&&(c[e]=[...c[e].slice(a),...Array(a).fill("??")]);break;case L.ALL:c=Array.from({length:l},()=>Array.from({length:a},()=>"??"))}Y.current=c},et=()=>{H(Y.current.map(e=>[...e]))},er=e=>{switch(e.key.toLowerCase()){case"-":e.preventDefault(),S();break;case"=":e.preventDefault(),k()}};(0,s.useLayoutEffect)(()=>(document.documentElement.style.overflow="hidden",K(!1),M(1),document.addEventListener("keydown",er),()=>{document.documentElement.style.overflow="auto",document.removeEventListener("keydown",er),q.current&&(clearTimeout(q.current),q.current=null),d(),Y.current=[],H([]),G([]),K(!1),V(-1)}),[]),(0,s.useLayoutEffect)(()=>{o||F.x===B.x||B.y===F.y||(V(-1),$.current||(u(e),$.current=!0))},[o,F]);let eo=e=>{if(e.length<1)return;let t=Y.current;e.forEach(e=>{let{row:n,col:r,value:o}=e;t[n]&&(t[n][r]=o)})},ei=(e,t,n,r,o,i,s,a,l)=>Array.from({length:e},(e,c)=>{let u=c*t;return el(r,o,i,s,a,l,u,Math.min(u+t,n))}),el=function(e,t,n,r,o,i){let s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:-1,l=Math.abs(e-n+1)<<1,c=l>>1,u=Math.abs(r-t+1),d=t-F.y,h="All"===i?0:n-F.x-1,f=-1===a?u*c:a,x=[],g=Y.current;for(let e=s;e<f;e++){let r;let i=Math.floor(e/c),s=e%c,a=u-1-i,f=a+d;if(f<0||f>=g.length)continue;let m=g[f]||[],y=m.length;if(0===y)continue;let p=n+(t-a)&1,C=Math.max(0,-h),w=Math.min(c,y-h);if(s<C||s>=w)continue;let v=i*l+(s<<1),L=ex[o.charCodeAt(v)<<8|o.charCodeAt(v+1)];if(255===L)continue;let E=p^1&s,b=s+h;if(L<8)r=0===L?"O":L.toString();else if(8===L)r="B";else if(24===L)r="C".concat(E);else if(L>=16&&L<24){let e=Math.floor((L-16)/2);r="F".concat(e).concat(E)}else r="??";m[b]!==r&&x.push({row:f,col:b,value:r})}return x},ec=async(e,t,n,r,o,i)=>{if(0===o.length)return;"All"===i&&ee(n,r,e,t,L.ALL);let s=Math.abs(r-t+1)*Math.abs(e-n+1),a=Math.min(navigator.hardwareConcurrency||4,Math.ceil(s/32)),l=Math.ceil(s/a),c=n+1,u=e-1,d=[];if("undefined"!=typeof SharedArrayBuffer&&"undefined"!=typeof Atomics){let e=new Int32Array(new SharedArrayBuffer(4*s)),n=new Int32Array(new SharedArrayBuffer(4));Atomics.store(n,0,0);let h=ei(a,l,s,u,t,c,r,o,i);(await Promise.all(h)).forEach(t=>{t.forEach(t=>{let{row:r,col:o,value:i}=t,a=Atomics.add(n,0,1);if(a>=s)return;let l=3*a;e[l]=r,e[l+1]=o,e[l+2]=i.charCodeAt(0)})});let f=Atomics.load(n,0);for(let t=0;t<f;t++){let n=e[3*t],r=e[3*t+1],o=String.fromCharCode(e[3*t+2]);d.push({row:n,col:r,value:o})}}else try{let e=ei(a,l,s,u,t,c,r,o,i);d=(await Promise.all(e)).flat()}catch(e){console.error("Ultra-Parallel Worker tile processing error:",e),d=el(u,t,c,r,o,i)}eo(d),et()};!function(e){let{message:t}=m();(0,s.useLayoutEffect)(()=>{t&&e(t)},[t])}(async e=>{let{MY_CURSOR:r,CHAT:o,CURSORS_STATE:i,EXPLOSION:s,QUIT_CURSOR:a,SCOREBOARD_STATE:c,TILES_STATE:u}=v;try{let{header:d,payload:f}=JSON.parse(e),{event:x}=d;switch(x){case u:{let{tiles_li:e}=f;for(let t of e){let{data:e,range:n}=t,{top_left:r,bottom_right:o}=n,{width:i,height:s}=ed(),[a,l]=[o.x-r.x+1,r.y-o.y+1],[c,u]=[a/2>>>0,l/2>>>0],d="PART";c===i&&u===s&&(d="All"),ec(r.x,o.y,o.x,r.y,e,d)}break}case s:{let{position:e}=f,{x:t,y:n}=e,{x:r,y:o}=h;r>=t-1&&r<=t+1&&o>=n-1&&o<=n+1&&V(10);break}case c:{let{scoreboard:e}=f;j(Object.entries(e).map(e=>{let[t,n]=e;return{ranking:parseInt(t)+1,score:n}}));break}case i:{let{cursors:e}=f,n=e.map(e=>({color:"red",id:e.id,position:e.position,message:"",messageTime:0,pointer:{x:1/0,y:1/0},score:e.score,revive_at:new Date(e.active_at).getTime()})),r=n.find(e=>e.id===b).position;t(n.filter(e=>e.id!==b)),r.x===h.x&&r.y===h.y||(p(r),C(r));break}case r:{let{id:e}=f;E(e),setTimeout(()=>K(!0),0);let t=ed();l(w.CREATE_CURSOR,t);break}case a:{let{id:e}=f;t(n.filter(t=>t.id!==e));break}case o:{let{id:e,message:r}=f,o=n.map(t=>t.id!==e?t:{...t,message:r,messageTime:Date.now()+8e3});t(o)}}}catch(e){console.error(e)}});let eu=(0,s.useMemo)(()=>{let e=z.length;if(0===e)return[];let t=y.x-h.x,n=y.y-h.y,r=D.x,o=D.y;return 0===t&&0===n?z:z.map((i,s)=>{let a=s+n;if(a<0||a>=e)return Array(i.length).fill("??");let l=z[a];return l?i.map((e,n)=>{let i=n+t;if(i<0||i>=l.length)return"??";let a=l[i];if(!a||"??"===a)return"??";let c=a[0];if(!["C","F"].includes(c))return a;let u=r+n+(o+s)&1;if("C"===c)return"C".concat(u);if("F"===c){let e=a[1]||"0";return"F".concat(e).concat(u)}return a}):Array(i.length).fill("??")})},[z,y,h,D]),ed=()=>{let e=80*f;return{width:1.5*_/e/2>>>0,height:1.5*A/e/2>>>0}};return(0,s.useLayoutEffect)(()=>{G(eu)},[eu]),(0,s.useLayoutEffect)(()=>{let e=80*f,[t,n]=[1.5*_/e/2>>>0,1.5*A/e/2>>>0];n<1||t<1||(O({x:h.x-t,y:h.y-n}),P({x:h.x+t,y:h.y+n}),I({x:y.x-t,y:y.y-n}),R(e))},[_,A,f,y,h,J]),(0,s.useLayoutEffect)(()=>{if(!J)return;let e=ed();l(w.SET_WINDOW,e)},[_,A,f,J]),(0,s.useEffect)(()=>{if(J)l(w.MOVE,{position:{x:y.x,y:y.y}})},[y]),(0,s.useEffect)(()=>(Z>0&&(q.current=setTimeout(()=>V(e=>e>0?e-1:e),1e3)),()=>{q.current&&(clearTimeout(q.current),q.current=null)}),[Z]),(0,r.jsxs)("div",{className:i().page,children:[Z>0&&(0,r.jsx)(W,{time:Z}),(0,r.jsx)(en,{}),(0,r.jsx)(ea,{}),(0,r.jsx)(Q,{tileSize:T,renderRange:1.5,maxTileCount:530}),(0,r.jsx)(N,{leftReviveTime:Z,paddingTiles:1.5,tiles:U,tileSize:T,startPoint:D,cursorOriginX:y.x,cursorOriginY:y.y})]})}(()=>{for(let e=0;e<65536;e++){let t=e>>8&255,n=255&e,r=t<128?ef[t]:-1,o=n<128?ef[n]:-1;if(r<0||o<0){ex[e]=255;continue}let i=r<<4|o,s=(128&i)!=0,a=(64&i)!=0,l=(32&i)!=0,c=(24&i)>>3,u=7&i;s?ex[e]=a?8:u:l?ex[e]=16+2*c:ex[e]=24}})(),(()=>{for(let e=0;e<256;e++){let t=e>>5,n=(4&t)!=0,r=(2&t)!=0,o=(1&t)!=0,i=(24&e)>>3,s=7&e;if(n)eu[e]=r?"B":ec[s],ed[e]="C0",eh[e]="C1";else if(o){eu[e]=null;let t=el[i];ed[e]=t[0],eh[e]=t[1]}else eu[e]=null,ed[e]="C0",eh[e]="C1"}})()},7397:function(e){e.exports={page:"page_page__9CbJ0"}},6507:function(e){e.exports={loading:"style_loading__42LVe",loadingBar:"style_loadingBar__AtBJr",loadingAnimation:"style_loadingAnimation__ScSQQ",loadComplete:"style_loadComplete__SRD5Z",canvasContainer:"style_canvasContainer__nKMjH",canvas:"style_canvas__m8mJO",vibration:"style_vibration__6_Fiw"}},6324:function(e){e.exports={dashboard:"style_dashboard__nDsof",bottom:"style_bottom___8aLI",coordinates:"style_coordinates__3RzzR",animation:"style_animation__Kv66j",toggle:"style_toggle__R68Vw",zoom:"style_zoom__EWfUf",buttons:"style_buttons__zf0nF"}},2698:function(e){e.exports={chat:"style_chat__ZTXhD",message:"style_message__uEVba"}},2723:function(e){e.exports={inactive:"style_inactive__B_gRa",fade:"style_fade__sZevv",alert:"style_alert__pv_lG",ad:"style_ad__2DN3O"}},1871:function(e){e.exports={scoreboard:"style_scoreboard__Th1NE",scoreList:"style_scoreList__P4ewN",scoreItem:"style_scoreItem__lRMtn",toggle:"style_toggle__axVEQ"}},1071:function(e){e.exports={tutorial:"style_tutorial__75p5w",step:"style_step__kswJY",fade:"style_fade__KaBU4",button:"style_button__rjKit"}}},function(e){e.O(0,[118,145,214,971,117,744],function(){return e(e.s=6124)}),_N_E=e.O()}]);