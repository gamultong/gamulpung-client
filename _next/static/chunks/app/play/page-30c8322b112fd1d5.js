(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{6124:function(e,t,n){Promise.resolve().then(n.bind(n,8552))},8552:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return eq}});var i=n(7437),r=n(7397),s=n.n(r),l=n(2265);function o(){let[e,t]=(0,l.useState)({windowWidth:0,windowHeight:0});return(0,l.useEffect)(()=>{let e=()=>{t({windowWidth:1.1*window.innerWidth,windowHeight:1.1*window.innerHeight})};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),e}var a=n(3011);let c=(0,a.U)(e=>({x:1/0,y:1/0,content:0,movecost:0,setMovecost:t=>e({movecost:t}),setPosition:(t,n,i)=>e({x:t,y:n,content:i})})),u=(0,a.U)(e=>({useAnimation:!0,setAnimation:t=>e({useAnimation:t})}));var d=n(6507),h=n.n(d),f=JSON.parse('{"tileColors":{"inner":[["#8fe340","#A4E863"],["#62B628","#71C637"],["#F1FAD1","#E9F6B9"]],"outer":[["#A8EC67","#81D92C"],["#74C63C","#5BB31F"],["#E9FAAA","#F5FDD8"]]},"flagPaths":["M219.428 109.389 C226.519 114.964 223.188 126.337 214.21 127.205 L79.8702 140.188 L115.929 28.0267 L219.428 109.389 Z","M79.9801 8.51632 C75.8798 9.72627 73.972 13.8825 73.0599 18.0591 L25.8244 234.356 C30.5707 235.401 36.0988 236 42 236 C45.1362 236 48.1671 235.831 51.0311 235.515 L116.451 28.5289 C117.573 24.9766 117.96 21.0358 115.39 18.3387 C112.87 15.6942 108.055 12.4097 98.862 9.69397 C89.7757 7.00975 83.7643 7.39963 79.9801 8.51632 Z"],"boomPaths":[" M77.85 145.025 L0.899994 54.5752 L103.5 92.3752 L117 0.575195 L164.25 74.8252 L219.6 38.3752 L202.05 103.175 L276.3 108.575 L219.6 153.125 L287.1 223.325 L198 230.075 L177.75 312.425 L130.5 236.825 L67.05 284.075 L75.15 196.325 L11.7 177.425 L77.85 145.025 "," M67.05 104.525 L104.85 150.425 L71.1 169.325 L104.85 178.775 L100.8 226.025 L133.2 200.375 L158.85 239.525 L168.3 196.325 L218.25 192.275 L181.8 154.475 L212.85 131.525 L171 128.825 L181.8 93.7251 L152.1 113.975 L126.45 73.4751 L118.35 122.075 L67.05 104.525 "],"cursorPaths":"M1.50025 12.3269C-1.20902 5.52993 5.52992 -1.20901 12.3269 1.50027L52.892 17.6696C60.2374 20.5975 59.7565 31.1525 52.1752 33.4002L50.7 33.8376C42.5878 36.2427 36.2427 42.5878 33.8376 50.7L33.4002 52.1752C31.1525 59.7565 20.5975 60.2374 17.6696 52.892L1.50025 12.3269Z","countColors":["#0059B280","#0095B280","#00B20080","#77B20080","#B2950080","#B24A0080","#B2000080","#7700B280"],"stunPaths":["M129.815 125.662C130.503 123.446 133.497 123.446 134.185 125.662L139.22 141.887C139.527 142.878 140.409 143.549 141.404 143.549H157.699C159.924 143.549 160.849 146.53 159.049 147.899L145.866 157.927C145.061 158.539 144.724 159.625 145.032 160.616L150.067 176.841C150.755 179.057 148.333 180.899 146.533 179.53L133.35 169.502C132.545 168.89 131.455 168.89 130.65 169.502L117.467 179.53C115.667 180.899 113.245 179.057 113.933 176.841L118.968 160.616C119.276 159.625 118.939 158.539 118.134 157.927L104.951 147.899C103.151 146.53 104.076 143.549 106.301 143.549H122.596C123.591 143.549 124.473 142.878 124.78 141.887L129.815 125.662Z","M194.44 89.187C194.931 87.6043 197.069 87.6043 197.56 89.187L201.157 100.776C201.377 101.484 202.007 101.963 202.717 101.963H214.356C215.946 101.963 216.606 104.093 215.321 105.071L205.905 112.234C205.329 112.671 205.089 113.446 205.309 114.154L208.905 125.744C209.396 127.326 207.666 128.642 206.38 127.664L196.964 120.501C196.389 120.064 195.611 120.064 195.036 120.501L185.62 127.664C184.334 128.642 182.604 127.326 183.095 125.744L186.691 114.154C186.911 113.446 186.671 112.671 186.095 112.234L176.679 105.071C175.394 104.093 176.054 101.963 177.644 101.963H189.283C189.993 101.963 190.623 101.484 190.843 100.776L194.44 89.187Z","M170 93.7976C170 90.9223 167.92 88.439 165.054 88.2051C163.391 88.0694 161.705 88 160 88C139.889 88 122.445 97.66 113.794 111.795C111.465 115.603 114.57 120 119.034 120C121.483 120 123.681 118.599 125.072 116.583C131.592 107.134 144.005 100 160 100C160.973 100 161.933 100.026 162.879 100.078C166.586 100.281 170 97.5106 170 93.7976ZM206 132C202.686 132 200.06 134.723 199.266 137.94C196.313 149.9 184.652 160.816 167.768 163.416C164.571 163.908 162 166.522 162 169.756C162 173.154 164.823 175.908 168.191 175.457C190.725 172.44 208.443 157.177 211.524 137.977C212.049 134.705 209.314 132 206 132Z"]}');let g=(0,a.U)(e=>({id:"",position:{x:0,y:0},color:"blue",originPosition:{x:0,y:0},zoom:1,score:0,isBombMode:!1,items:{bomb:0},setId:t=>e({id:t}),setColor:t=>e({color:t}),setZoom:t=>e({zoom:t}),setIsBombMode:t=>e({isBombMode:t}),setOriginPosition:t=>e({originPosition:t}),setPosition:t=>e({position:t}),zoomUp:()=>e(e=>({zoom:1.5*e.zoom<1.7?1.5*e.zoom:e.zoom})),zoomDown:()=>e(e=>({zoom:e.zoom/1.5>.15?e.zoom/1.5:e.zoom})),moveUp:()=>e(e=>({position:{x:e.position.x,y:e.position.y-1}})),moveDown:()=>e(e=>({position:{x:e.position.x,y:e.position.y+1}})),moveLeft:()=>e(e=>({position:{x:e.position.x-1,y:e.position.y}})),moveRight:()=>e(e=>({position:{x:e.position.x+1,y:e.position.y}})),setScore:t=>e({score:t}),setItems:t=>e({items:t})})),x=(0,a.U)(e=>({cursors:[],addCursors:t=>e(e=>({cursors:[...e.cursors,...t]})),removeCursor:t=>e(e=>({cursors:e.cursors.filter(e=>e!==t)})),setCursors:t=>e({cursors:t})})),m=(0,a.U)(e=>({socket:null,message:"",binaryMessage:null,isOpen:!1,connect:t=>{let n=new WebSocket(t);n.binaryType="arraybuffer",n.onopen=()=>{console.info("connect: WebSocket is opened"),e({socket:n,isOpen:!0})},n.onclose=()=>{console.info("server closed: WebSocket is closed"),e({socket:null,isOpen:!1})},n.onmessage=t=>{t.data instanceof ArrayBuffer?e({binaryMessage:t.data}):e({message:t.data})}},disconnect:()=>{let{socket:t}=m.getState();null==t||t.close(),e({socket:null,isOpen:!1}),console.info("disconnect: WebSocket is closed")},sendMessage:(e,t)=>{let{socket:n,isOpen:i}=m.getState();i&&n?n.send(JSON.stringify({header:{event:e},payload:t})):console.error("send: WebSocket is closed")}})),y={CHAT:"CHAT",MOVE:"MOVE",OPEN_TILES:"OPEN-TILES",SET_FLAG:"SET-FLAG",SET_WINDOW:"SET-WINDOW",CREATE_CURSOR:"CREATE-CURSOR",DISMANTLE_MINE:"DISMANTLE-MINE",INSTALL_BOMB:"INSTALL-BOMB"},p={CHAT:"CHAT",CURSORS_STATE:"CURSORS-STATE",EXPLOSION:"EXPLOSION",MY_CURSOR:"MY-CURSOR",QUIT_CURSOR:"QUIT-CURSOR",SCOREBOARD_STATE:"SCOREBOARD-STATE",TILES_STATE:"TILES-STATE"},w={RIGHT:"R",LEFT:"L",UP:"U",DOWN:"D",ALL:"A",UP_RIGHT:"UR",DOWN_RIGHT:"DR",UP_LEFT:"UL",DOWN_LEFT:"DL"},C={BOMB:8,FILL:255},v=e=>e===C.BOMB,L=e=>(254&e)==16,_=e=>e>=32&&e<=39,k=e=>e>=16&&e<=39,b=e=>e<16||e>39,E=e=>1&e,M=e=>e-32>>1,S=e=>16|1&e,j=(e,t)=>32|(3&e)<<1|1&t;class T{get(e,t){return e<0||e>=this.height||t<0||t>=this.width?C.FILL:this.data[e*this.width+t]}set(e,t,n){e>=0&&e<this.height&&t>=0&&t<this.width&&(this.data[e*this.width+t]=n)}clone(){let e=new T(0,0,0);return e.width=this.width,e.height=this.height,e.data=this.data.slice(),e}get isEmpty(){return 0===this.width||0===this.height}static empty(){return new T(0,0,0)}constructor(e,t,n=C.FILL){this.width=e,this.height=t,this.data=new Uint8Array(e*t),0!==n&&this.data.fill(n)}}let R={tiles:T.empty(),renderTiles:T.empty(),startPoint:{x:0,y:0},endPoint:{x:0,y:0},renderStartPoint:{x:0,y:0},tileSize:0},I=(0,a.U)((e,t)=>({...R,setTiles:t=>e({tiles:t}),setRenderTiles:t=>e({renderTiles:t}),setStartPoint:t=>e({startPoint:t}),setEndPoint:t=>e({endPoint:t}),setRenderStartPoint:t=>e({renderStartPoint:t}),setTileSize:t=>e({tileSize:t}),padtiles:(n,i,r,s,l)=>{let{tiles:o}=t(),{UP:a,ALL:c,DOWN:u,LEFT:d,RIGHT:h,DOWN_LEFT:f,DOWN_RIGHT:g,UP_LEFT:x,UP_RIGHT:m}=w;if(l===c){e({tiles:new T(Math.abs(r-n)+1,Math.abs(s-i)+1)});return}let y=o.clone(),{data:p}=y,v=y.width,L=y.height;if((l===a||l===m||l===x)&&(p.copyWithin(v,0,(L-1)*v),p.fill(C.FILL,0,v)),(l===u||l===g||l===f)&&(p.copyWithin(0,v,L*v),p.fill(C.FILL,(L-1)*v,L*v)),l===d||l===f||l===x)for(let e=L-1;e>=0;e--){let t=e*v;p.copyWithin(t+1,t,t+v-1),p[t]=C.FILL}if(l===h||l===g||l===m)for(let e=0;e<L;e++){let t=e*v;p.copyWithin(t,t+1,t+v),p[t+v-1]=C.FILL}console.log("pad after",l,performance.now()),e({tiles:y})},applyTileChanges:n=>{if(n.length<1)return;let{tiles:i}=t(),r=i.clone();for(let{row:e,col:t,value:i}of n)r.set(e,t,i);e({tiles:r})},applyPackedChanges:n=>{if(0===n.length)return;let{tiles:i}=t(),r=i.clone(),s=r.data,l=r.width;for(let e=0;e<n.length;e++){let t=n[e];s[(t>>16&65535)*l+(t>>8&255)]=255&t}e({tiles:r})},reset:()=>e(R),getTile:(e,n)=>{let{tiles:i}=t();return i.get(e,n)}})),N=()=>I(e=>e.tiles),A=()=>I(e=>e.renderTiles),B=()=>I(e=>e.startPoint),P=()=>I(e=>e.endPoint),F=()=>I(e=>e.renderStartPoint),O=()=>I(e=>e.tileSize);var D=n(2698),W=n.n(D);function U(){let[e,t]=(0,l.useState)(""),[n,r]=(0,l.useState)(0),[s,a]=(0,l.useState)(0),[c,u]=(0,l.useState)(Date.now()),{sendMessage:d}=m(),{color:h,originPosition:f,zoom:p}=g(),{cursors:w}=x(),{windowHeight:C,windowWidth:v}=o(),L=(0,l.useRef)(null),_=(0,l.useRef)(null),k=e=>e?e-c>4e3?1:(e-c)/4e3:0,b={left:"51%",top:"51%",backgroundColor:h,opacity:k(s)};(0,l.useEffect)(()=>{if(!_.current||!e)return;let t=requestAnimationFrame(()=>{_.current&&r(_.current.getBoundingClientRect().width)});return()=>cancelAnimationFrame(t)},[e]);let E=e=>{var n;"Enter"===e.key&&(null===(n=L.current)||void 0===n||n.focus()),"Escape"===e.key&&(t(""),a(null))};return(0,l.useEffect)(()=>(window.addEventListener("keydown",E),()=>window.removeEventListener("keydown",E)),[]),(0,l.useEffect)(()=>{setTimeout(()=>u(Date.now()),1e3)},[c]),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("form",{className:W().chat,onSubmit:n=>{n.preventDefault(),a(Date.now()+8e3),""===e||s<c||(d(y.CHAT,{message:e}),t(""))},style:b,children:[(0,i.jsx)("input",{type:"text",ref:L,className:W().message,value:e,maxLength:40,onChange:e=>{t(e.target.value),a(Date.now()+8e3)},style:{width:"".concat(n+5,"px"),color:"yellow"===h?"black":"white"}}),(0,i.jsx)("div",{ref:_,"aria-hidden":!0,children:e})]}),w.map((e,t)=>(0,i.jsx)("div",{className:W().chat,style:{left:"".concat(v/2+(e.position.x-f.x-1/p/2)*p*80,"px"),top:"".concat(C/2+(e.position.y-f.y-1/p/2)*p*80,"px"),backgroundColor:e.color,color:"yellow"===e.color?"black":"white",opacity:k(e.messageTime)},children:e.message},"".concat(e.id,"-").concat(t)))]})}var z=n(4648),H=n(1442);let Z=e=>new Path2D(e),G=e=>{let t=[];return e.forEach(e=>t.push(new Path2D(e))),t},K=(e,t,n)=>{e.save(),e.fillStyle=n,e.fill(t),e.restore()},V=async(e,t,n,i)=>{let r=H.xEZ.from(e);try{let t=await createImageBitmap(e);r=H.xEZ.from(t)}catch(e){}finally{return r.baseTexture.scaleMode=H.aH$.NEAREST,r.baseTexture.mipmap=H.WBB.OFF,r.baseTexture.wrapMode=H.Nt$.CLAMP,r.baseTexture.setSize(t,n),"number"==typeof i&&(r.baseTexture.resolution=i),r}},X=e=>{let t=parseInt(e.replace("#",""),16);return{r:t>>16&255,g:t>>8&255,b:255&t}},Y=(e,t,n)=>Math.round(e+(t-e)*n),J=[[-1,0],[0,-1],[0,1],[1,0],[-1,-1],[-1,1],[1,-1],[1,1]],Q={red:"#FF4D00",blue:"#0094FF",yellow:"#F0C800",purple:"#BC3FDC",0:"#FF4D00",1:"#F0C800",2:"#0094FF",3:"#BC3FDC"},q={red:"#FBCBB6",blue:"#A8DBFF",yellow:"#FFEE99",purple:"#E8BEF3",0:"#FBCBB6",1:"#A8DBFF",2:"#FFEE99",3:"#E8BEF3"};function $(e,t,n){for(;e.length<n;){let n=new H.jyi;n.roundPixels=!0,n.eventMode="none",n.cullable=!0,n.visible=!1,t.addChild(n),e.push(n)}return e}function ee(e,t){for(let n=t;n<e.length;n++)e[n].visible=!1}function et(e){let{tilePadWidth:t,tilePadHeight:n,className:r}=e,s=A(),a=O(),{flagPaths:c,tileColors:u,countColors:d,boomPaths:h}=f,{outer:x,inner:m}=u,{zoom:y}=g(),{windowHeight:p,windowWidth:w}=o(),L=(0,l.useRef)(new Map),b=(0,l.useRef)(new Map),[S,j]=(0,l.useState)(!1),[T,R]=(0,l.useState)(!1),I=(0,l.useRef)(null),N=(0,l.useRef)(null),B=(0,l.useRef)(null),P=(0,l.useRef)(null),F=(0,l.useRef)([]),D=(0,l.useRef)([]),W=(0,l.useRef)([]),U=(0,l.useRef)([]),G=(0,l.useRef)([]),J=(0,l.useRef)([]),q=e=>e.getContext("2d",{willReadFrequently:!1,desynchronized:!0}),et=e=>{let t=0,n=[],i=()=>{if(t>=e)return;let i=n.shift();i&&(t++,i())};return r=>new Promise((s,l)=>{let o=e=>{let n=r();n.then(s),n.catch(l),n.finally(()=>{!e&&t--,i()})};t>=e?n.push(o):o(!0)})};return((0,l.useEffect)(()=>{(async()=>{let e=[],t=et(8),n=new Map;for(let i=1;i<=d.length;i++)e.push(t(async()=>{let e=document.createElement("canvas");e.width=e.height=a;let t=q(e);if(!t)return;t.clearRect(0,0,a,a),t.textAlign="center",t.textBaseline="middle",t.font="".concat(.6*a>>>0,"px LOTTERIACHAB"),t.fillStyle=d[i-1],t.imageSmoothingEnabled=!1,t.fillText("".concat(i),a/2,a/2);let r=await V(e,a,a,1);n.set(i,r)}));await Promise.all(e),b.current=n,R(!0)})();let e=L.current,t=(t,n)=>{let i="".concat(t).concat(n).concat(a);if(e.has(i))return;let r=document.createElement("canvas");r.width=r.height=4;let s=q(r);if(!s)return;let l=X(t),o=X(n);for(let e=0;e<4;e++){let t=e/3,n=Y(l.r,o.r,t),i=Y(l.g,o.g,t),r=Y(l.b,o.b,t);s.fillStyle="rgb(".concat(n,",").concat(i,",").concat(r,")"),s.fillRect(e,0,1,4)}let c=H.xEZ.from(r);c.baseTexture.scaleMode=H.aH$.NEAREST,c.baseTexture.mipmap=H.WBB.OFF,c.baseTexture.wrapMode=H.Nt$.CLAMP,c.baseTexture.setSize(4,4),c.baseTexture.resolution=.001,e.set(i,c)};for(let e=0;e<x.length;e++)t(x[e][0],x[e][1]),t(m[e][0],m[e][1]);let n=[],i=et(8);n.push(i(async()=>{let t=document.createElement("canvas");t.width=t.height=a/3;let n=q(t);if(!n)return;n.scale(y/3/4,y/3/4),K(n,Z(h[0]),"rgba(0, 0, 0, 0.6)"),K(n,Z(h[1]),"rgba(0, 0, 0, 0.5)");let i=await V(t,a/3,a/3);e.set("boom",i)})),[0,1,2,3].forEach(t=>n.push(i(async()=>{let n=document.createElement("canvas");n.width=n.height=a/2;let i=q(n);if(!i)return;let r=i.createLinearGradient(36.5,212.5,36.5,259);r.addColorStop(0,"#E8E8E8"),r.addColorStop(1,"transparent"),i.translate(n.width/6,n.height/6),i.scale(y/2/4.5,y/2/4.5),K(i,Z(c[0]),Q[t]),K(i,Z(c[1]),r);let s=await V(n,a,a);e.set("flag".concat(t),s)}))),Promise.all(n).finally(()=>j(!0))},[a]),(0,l.useEffect)(()=>{let e=L.current,t=W.current;return()=>{e.forEach(e=>e.destroy()),e.clear(),t.forEach(e=>{let{outer:t,inner:n}=e;t.destroy(),n.destroy()}),W.current=[],F.current=[],D.current=[],U.current=[],G.current=[],J.current=[]}},[]),(0,l.useLayoutEffect)(()=>{let e=I.current,i=N.current,r=B.current,l=P.current;if(!e||!i||!r||!l||!S||!T)return;let o=s.height,c=s.width;if(0===o||0===c)return;let u=Math.max(0,Math.ceil(t-1)),d=Math.min(c-1,t+(w+a)/(a||1)>>>0),h=Math.max(0,Math.ceil(n-1)),f=Math.min(o-1,n+(p+a)/(a||1)>>>0);if(u>d||h>f||!Number.isFinite(u+d+h+f))return;let g=L.current,j=g.get("".concat(x[2][0]).concat(x[2][1]).concat(a)),R=g.get("".concat(m[2][0]).concat(m[2][1]).concat(a));if(!j||!R)return;let A=Math.max(0,f-h+1|0)*Math.max(0,d-u+1|0),O=5*y;for($(F.current,e,A),$(D.current,e,A),$(U.current,r,A),$(G.current,l,A),$(J.current,e,A);W.current.length<A;){let e=new H.jyi;e.roundPixels=!0,e.eventMode="none",e.cullable=!0;let t=new H.jyi;t.roundPixels=!0,t.eventMode="none",t.cullable=!0,i.addChild(e),i.addChild(t),W.current.push({outer:e,inner:t})}let z=0,Z=0,K=0,V=0,X=0,Y=0;for(let e=h;e<=f;e++)for(let i=u;i<=d;i++){let r,l;let o=s.get(e,i);if(o===C.FILL)continue;let c=(i-t)*a,u=(e-n)*a,d=Math.round(c),h=Math.round(u),f=Math.round(c+a),y=Math.round(u+a),p=f-d,w=y-h,L=k(o);if(L){let e=E(o),[t,n]=[x[e],m[e]];r=g.get("".concat(t[0]).concat(t[1]).concat(a))||j,l=g.get("".concat(n[0]).concat(n[1]).concat(a))||R}else r=j,l=R;if(L){let e=W.current[K++];if(!e)continue;e.outer.texture=r,e.outer.x=d,e.outer.y=h,e.outer.width=e.outer.height=a,e.outer.visible=!0;let t=Math.round(d+O),n=Math.round(h+O),i=Math.round(f-O),s=Math.round(y-O);if(e.inner.texture=l,e.inner.x=t,e.inner.y=n,e.inner.width=Math.max(0,i-t),e.inner.height=Math.max(0,s-n),e.inner.visible=!0,_(o)){let e=M(o),t=g.get("flag".concat(e));if(t){let e=G.current[X++];e.texture=t,e.anchor.set(.5),e.x=d+a/2,e.y=h+a/2,e.width=p,e.height=w,e.visible=!0}}}else{let e=F.current[z++];e.texture=r,e.x=d,e.y=h,e.width=p,e.height=w,e.visible=!0;let t=Math.round(c+O),n=Math.round(u+O),i=Math.round(d+p-O),s=Math.round(h+w-O),f=D.current[Z++];if(f.texture=l,f.x=t,f.y=n,f.width=Math.max(0,i-t),f.height=Math.max(0,s-n),f.visible=!0,v(o)){let e=g.get("boom");if(e){let t=U.current[V++];t.texture=e,t.x=d,t.y=h,t.width=p,t.height=w,t.visible=!0}}if(o>=1&&o<=7){let e=b.current.get(o);if(e){let t=J.current[Y++];t.texture=e,t.anchor.set(.5),t.x=d+a/2,t.y=h+a/2,t.width=p,t.height=w,t.visible=!0}}}}ee(F.current,z),ee(D.current,Z),ee(U.current,V),ee(G.current,X),ee(J.current,Y);for(let e=K;e<W.current.length;e++)W.current[e].outer.visible=!1,W.current[e].inner.visible=!1},[s,S,T]),S&&T)?(0,i.jsx)(z.Hf,{id:"Tilemap",className:r,width:w,height:p,options:{backgroundColor:8421504,resolution:1,antialias:!1,powerPreference:"low-power",autoDensity:!1,preserveDrawingBuffer:!1,sharedTicker:!0},children:(0,i.jsxs)(z.W2,{name:"container",sortableChildren:!1,eventMode:"none",cacheAsBitmap:!1,cullable:!0,children:[(0,i.jsx)(z.W2,{name:"background",ref:I,eventMode:"none",sortableChildren:!1}),(0,i.jsx)(z.W2,{name:"closed-layer",ref:N,eventMode:"none",sortableChildren:!1}),(0,i.jsx)(z.W2,{name:"boom-layer",ref:B,eventMode:"none",sortableChildren:!1}),(0,i.jsx)(z.W2,{name:"flag-layer",ref:P,eventMode:"none",sortableChildren:!1})]})}):null}let en=(0,a.U)(e=>({purchasedSkills:[],setPurchasedSkills:t=>e(e=>({purchasedSkills:"function"==typeof t?t(e.purchasedSkills):t}))}));var ei=n(4888),er=n(6158);let es=[{id:"1",name:"SPEED I",description:"Increase moving speed",nexts:["2"],cost:2},{id:"2",name:"SPEED II",description:"Increase moving speed",nexts:["3"],cost:4},{id:"3",name:"CLICK I",description:"Increase click intraction range",nexts:["4"],cost:8},{id:"4",name:"SPEED III",description:"Increase moving speed",nexts:["5"],cost:16},{id:"5",name:"EXPLODE I",description:"Increase intraction range",nexts:["6"],cost:32},{id:"6",name:"SPEED IV",description:"Increase moving speed",nexts:["7"],cost:64}],el=["1","2","4","6"],eo=()=>{let e=2*Math.PI/es.length;return es.map((t,n)=>{let{id:i,name:r}=t,s=(n-2)*e;return{id:i,data:{label:r},position:{x:200*Math.cos(s),y:200*Math.sin(s)}}})},ea=()=>es.flatMap(e=>e.nexts.map(t=>({id:"".concat(e.id,"-").concat(t),source:e.id,target:t,animated:!0,style:{strokeWidth:4,stroke:"#ff4d4f"},markerEnd:{type:ei.M.ArrowClosed,width:20,height:20}})));function ec(){let{score:e}=g(),t=en(e=>e.purchasedSkills),n=en(e=>e.setPurchasedSkills),[i,r,s]=(0,er.Rr)(eo()),[o,a,c]=(0,er.ll)(ea()),[u,d]=(0,l.useState)(null),[h,f]=(0,l.useState)([]),x=(0,l.useMemo)(()=>u&&t.includes(u.id),[t,u]),m=(0,l.useMemo)(()=>200/(1+.2*el.filter(e=>t.includes(e)).length),[t]);return{nodes:i,edges:o,onNodesChange:s,onEdgesChange:c,selectedSkill:u,purchasedSkills:t,purchaseableSkills:h,isPurchased:x,MOVE_SPEED:m,onNodeClick:(e,t)=>{let n=es.find(e=>{let{id:n}=e;return n===t.id});d(null!=n?n:null)},purchaseSkill:()=>{if(!u||t.includes(u.id)||u.cost>e)return;let s=es.filter(e=>e.nexts.includes(u.id));if(!s.every(e=>t.includes(e.id))&&s.length>0)return;let l=[...t,u.id];n(l),a(o.map(e=>{let t=l.includes(e.target)?"#ffd700":"#ff4d4f";return{...e,style:{...e.style,stroke:t}}})),r(i.map(e=>e.id===u.id?{...e,className:"skill-purchased"}:e)),f(h.filter(e=>e.id!==u.id))}}}class eu{constructor(e,t){this.x=e,this.y=t,this.gScore=1/0,this.heuristic=0,this.fTotal=1/0,this.parent=null}}var ed=e=>{let{paddingTiles:t,cursorOriginX:n,cursorOriginY:r,leftReviveTime:s}=e,a=A(),d=O(),p=F(),C=B(),v=P(),{padtiles:k}=I(),{MOVE_SPEED:E}=ec(),M=d>>1,[S,j]=[n-p.x,r-p.y],T=1/(t-1),[R,N]=[(t-1)*S/t,(t-1)*j/t],[D,W]=[R*T,N*T],[z,H]=(0,l.useState)({x:1/0,y:1/0}),{boomPaths:K,cursorPaths:V,flagPaths:X,stunPaths:Y}=f,{windowHeight:$,windowWidth:ee}=o(),{setPosition:en,x:ei,y:er,setMovecost:es}=c(),{position:el,zoom:eo,color:ea,setPosition:ed,setOriginPosition:eh,isBombMode:ef}=g(),{cursors:eg}=x(),{sendMessage:ex}=m(),{useAnimation:em}=u(),ey=(0,l.useRef)(null),ep=(0,l.useRef)(null),ew=(0,l.useRef)(null),eC=(0,l.useRef)(!1),ev={interactionCanvasRef:(0,l.useRef)(null),otherCursorsRef:(0,l.useRef)(null),otherPointerRef:(0,l.useRef)(null),myCursorRef:(0,l.useRef)(null)},[eL,e_]=(0,l.useState)(!0),[ek,eb]=(0,l.useState)([]),[eE,eM]=(0,l.useState)({x:1/0,y:1/0}),[eS,ej]=(0,l.useState)(),[eT,eR]=(0,l.useState)(),eI=()=>{ey.current&&(clearInterval(ey.current),ey.current=null)},eN=()=>{Object.values(ev).forEach(e=>{if(e.current){let t=e.current.getContext("2d");null==t||t.clearRect(0,0,e.current.width,e.current.height)}}),eR(void 0)},eA=(e,t)=>{let n=e.getBoundingClientRect();e.width=n.width,e.height=n.height,e.style.width=n.width+"px",e.style.height=n.height+"px",t.imageSmoothingEnabled=!0,t.imageSmoothingQuality="low","textRenderingOptimization"in t&&(t.textRenderingOptimization="optimizeQuality")};(0,l.useEffect)(()=>{let e=e=>e.preventDefault();return window.addEventListener("contextmenu",e),()=>{window.removeEventListener("contextmenu",e),eI()}},[]);let eB=e=>b(e),eP=(e,t,n,i,r)=>{if(ey.current)return;let s=0,l=eX(S,j,e,t),o=l[s];if((null==o?void 0:o.x)===void 0||(null==o?void 0:o.y)===void 0)return;let a=[...l];if(a.length>2){let n=a[a.length-2],i=S+n.x,r=j+n.y;i===e&&r===t&&a.pop();let s=a[a.length-1];s&&H({x:el.x+s.x,y:el.y+s.y})}let[c,u]=[el.x,el.y];es(a.length-1);let h=(e,t)=>{let{interactionCanvasRef:n,otherCursorsRef:i,otherPointerRef:r}=ev,s=document.getElementById("Tilemap"),l=[n.current,i.current,r.current,s],o=performance.now(),a=n=>{let i=Math.min((n-o)/E,1),r=d*(1-i),[s,c]=[r*e,r*t];l.forEach(e=>e.style.transform="translate(".concat(s,"px, ").concat(c,"px)")),i<1?requestAnimationFrame(a):l.forEach(e=>e.style.transform="translate(0, 0)")};requestAnimationFrame(a)};ey.current=setInterval(()=>{if(++s>=a.length){ed({x:e+p.x,y:t+p.y}),eb([]),H({x:1/0,y:1/0}),eI(),null==r||r(n,i);return}let l=a[s];if(!l)return;let[d,f]=[Math.sign(l.x-o.x),Math.sign(l.y-o.y)];ej({x:d,y:f});let g="";1===f&&(g+=w.DOWN),-1===f&&(g+=w.UP),1===d&&(g+=w.RIGHT),-1===d&&(g+=w.LEFT),[c,u]=[d+c,f+u];let x={x:c,y:u};ex(y.MOVE,{position:x}),eh(x),ed(x),o=l,eb(a.slice(s)),g&&C&&v&&k(C.x,v.y,v.x,C.y,g),em&&h(d,f),console.log("animation",performance.now())},E)},eF=(e,t,n)=>{let{MOVE:i,OPEN_TILES:r,SET_FLAG:s,DISMANTLE_MINE:l,INSTALL_BOMB:o}=y;[i,r,s,l,o].some(e=>e===n)&&ex(n,{position:{x:e,y:t}})},eO={special:y.SET_FLAG,general:y.OPEN_TILES},eD=()=>{ep.current&&(clearTimeout(ep.current),ep.current=null),ew.current=null},eW=(e,t)=>J.some(i=>{let[s,l]=i;return n+s===e&&r+l===t}),eU=(e,t)=>{let n={x:1/0,y:1/0};return[[0,0],...J].some(i=>{let[r,s]=i,[l,o]=[e+r,t+s];return!(o<0)&&!(o>=a.height)&&!(l<0)&&!(l>=a.width)&&!!eB(a.get(o,l))&&(n={x:l,y:o},!0)}),n},ez=(e,t)=>{let i={x:1/0,y:1/0},s=n-p.x,l=r-p.y;if((J.some(i=>{let[s,l]=i;return n===e+s&&r===t+l})||n===e&&r===t)&&l>=0&&l<a.height&&s>=0&&s<a.width&&eB(a.get(l,s)))return{x:s,y:l};let o=1/0;return[[0,0],...J].forEach(n=>{let[r,c]=n,u=e+r-p.x,d=t+c-p.y;if(d<0||d>=a.height||u<0||u>=a.width||!eB(a.get(d,u)))return;let h=Math.abs(u-s)+Math.abs(d-l);h<o&&(o=h,i={x:u,y:d})}),i},eH=(0,l.useCallback)(function(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,o=eo*l;if(e.save(),e.fillStyle=i,e.translate(t,n),1===l){let t=(Math.round((s+Math.PI)/(Math.PI/4))+2)%8,n=M>>2;0===t?e.translate(M,n):1===t?e.translate(d-n,n):2===t?e.translate(d-n,M):3===t?e.translate(d-n,d-n):4===t?e.translate(M,d-n):5===t?e.translate(n,d-n):6===t?e.translate(n,M):7===t&&e.translate(n,n)}else e.translate(M,M);if(e.rotate(s-Math.PI/4),e.scale(o,o),e.fill(eT.cursor),e.restore(),!(r>0&&Date.now()<r&&(null==eT?void 0:eT.stun)))return;let a=eo/2;e.save(),e.translate(t-M,n-M),e.fillStyle="white",e.strokeStyle="black",e.scale(a,a),eT.stun.forEach(t=>{e.fill(t),e.stroke(t)}),e.restore()},[d,eT]),eZ=(0,l.useCallback)(()=>{let e=ev.otherCursorsRef.current;if(!e)return;let t=e.getContext("2d");t&&(eA(e,t),t.clearRect(0,0,ee,$),eg.forEach(e=>{var i;let{position:s,color:l,revive_at:o}=e,{x:a,y:c}=null!==(i=null==e?void 0:e.pointer)&&void 0!==i?i:{x:1/0,y:1/0},[u,h]=[s.x-n+D,s.y-r+W],[f,g]=[s.x-a,s.y-c];eH(t,u*d,h*d,Q[l],o,0!==f||0!==g?Math.atan2(g,f):0)}))},[eg,n,r,R,N,d,ee,$,ev.otherCursorsRef]),eG=(0,l.useCallback)((e,t,n,i,r)=>{e&&(e.beginPath(),e.strokeStyle=i,e.lineWidth=r,e.strokeRect(t+r/2,n+r/2,d-r,d-r),e.closePath())},[d]),eK=e=>{let t=ev.otherPointerRef.current;if(!t)return;let i=t.getContext("2d");i&&(eA(t,i),i.clearRect(0,0,ee,$),eg.forEach(t=>{let{pointer:s,color:l}=t,{x:o,y:a}=null!=s?s:{x:0,y:0},[c,u]=[o-n+D,a-r+W];eG(i,c*d,u*d,q[l],e)}))},eV=(e,t)=>eg.some(n=>n.position.x===e+p.x&&n.position.y===t+p.y),eX=(e,t,n,i)=>{var r;if(e===n&&t===i)return[{x:0,y:0}];let s=n-e,l=i-t;if(1>=Math.abs(s)&&1>=Math.abs(l)&&(0!==s||0!==l)&&i>=0&&i<a.height&&n>=0&&n<a.width&&eB(a.get(i,n))&&!eV(n,i))return[{x:0,y:0},{x:s,y:l}];let o=(e,t)=>{let n=[];for(let[i,r]of J){let[s,l]=[t.x+i,t.y+r];l<0||l>=e.length||s<0||s>=e[l].length||null===e[l][s]||eV(s,l)||n.push({node:e[l][s],isDiagonal:0!==i&&0!==r})}return n},c=(e,t,n)=>({x:e.x-t,y:e.y-n}),[u,d]=[new eu(e,t),new eu(n,i)],h=[];for(let e=0;e<a.height;e++){let t=[];for(let n=0;n<a.width;n++)t.push(eB(a.get(e,n))?new eu(n,e):null);h.push(t)}if(i<0||i>=h.length||n<0||n>=(null===(r=h[i])||void 0===r?void 0:r.length)||null===h[i][n])return[];let f=[u],g=[];for(u.gScore=0,u.heuristic=Math.abs(e-n)+Math.abs(t-i),u.fTotal=u.gScore+u.heuristic;f.length>0;){let n=f.reduce((e,t)=>e.fTotal<t.fTotal?e:t);if(eM(c(n,e,t)),n.x===d.x&&n.y===d.y){let i=[];for(let r=n;r;r=r.parent)i.unshift({x:r.x-e,y:r.y-t});return i}for(let{node:e,isDiagonal:t}of(f=f.filter(e=>e!==n),g.push(n),o(h,n))){if(g.includes(e))continue;let i=n.gScore+(t?14:10);i>=e.gScore||(f.includes(e)||f.push(e),e.parent=n,e.gScore=i,e.heuristic=Math.abs(e.x-d.x)+Math.abs(e.y-d.y),e.fTotal=e.gScore+e.heuristic)}}return[]},eY=()=>{let{interactionCanvasRef:e,myCursorRef:i,otherCursorsRef:s,otherPointerRef:l}=ev,{current:o}=e,{current:a}=i,{current:c}=s,{current:u}=l;if(!o||!a||!c||!u)return;let[h,f]=[o.getContext("2d"),a.getContext("2d")];if(!h||!f)return;eA(o,h),eA(a,f),f.clearRect(0,0,ee,$),h.clearRect(0,0,ee,$);let g=Q[ea],x=5*eo,m={x:S/t*d,y:j/t*d},y={x:m.x+(ei-n)*d,y:m.y+(er-r)*d},p={x:z.x-n-eE.x-R+S+.5,y:z.y-r-eE.y-N+j+.5},w=(n!==ei||r!==er)&&eS?Math.atan2(-eS.y,-eS.x):0;eH(f,m.x,m.y,g,0,w),eG(h,y.x,y.y,g,x),eZ(),eK(x);let C=null==ek?void 0:ek.map(e=>{let[t,n]=[e.x+p.x,e.y+p.y];return{x:t*d,y:n*d}});if(C.length<=1)return;let v=.15*d;h.beginPath(),h.strokeStyle=g,h.lineWidth=d/10,h.lineJoin=h.lineCap="round",h.miterLimit=2,h.moveTo(C[0].x,C[0].y);for(let e=1;e<C.length-1;e++){let[t,n,i]=[...C.slice(e-1,e+2)],[r,s]=[n.x-t.x,n.y-t.y],[l,o]=[i.x-n.x,i.y-n.y],[a,c]=[Math.hypot(r,s),Math.hypot(l,o)],u=r*o-s*l,d=(r*l+s*o)/(a*c);if(1e-6>Math.abs(u)||d>.995)h.lineTo(n.x,n.y);else{let e=Math.min(v,.5*Math.min(a,c));h.arcTo(n.x,n.y,i.x,i.y,e)}}let[L,_]=[...C.slice(-2)],[k,b]=[(_.x+L.x)/2,(_.y+L.y)/2],E=Math.PI+Math.atan2(_.y-L.y,_.x-L.x);h.lineTo(k,b),eH(h,k-M,b-M,g,0,E,.6),h.stroke()};return(0,l.useLayoutEffect)(()=>{if(!eL&&!a.isEmpty)return;let e=async()=>{try{if(document.fonts.check("1em LOTTERIACHAB"))return;let e=new FontFace("LOTTERIACHAB","url('https://fastly.jsdelivr.net/gh/projectnoonnu/noonfonts_2302@1.0/LOTTERIACHAB.woff2') format('woff2')");await e.load(),document.fonts.add(e)}catch(e){console.warn("Font loading failed, using fallback font")}},t=Z(V),n=G(Y),[i,r]=X.map(Z),[s,l]=K.map(Z);eR({cursor:t,stun:n,flag:{flag:i,pole:r},boom:{inner:s,outer:l}}),e_(!1),e()},[a,eL]),(0,l.useEffect)(()=>{eL||eY()},[n,r,p,ei,er,ea,eg,eE]),(0,l.useEffect)(()=>()=>{eI(),eN()},[]),(0,i.jsxs)(i.Fragment,{children:[eL&&(0,i.jsxs)("div",{className:h().loading,children:[(0,i.jsx)("h1",{children:"Assets Loading..."}),(0,i.jsx)("div",{className:"".concat(a.isEmpty?h().loadingBar:h().loadComplete)})]}),!eL&&(0,i.jsxs)("div",{className:"".concat(h().canvasContainer," ").concat(s>0?h().vibration:""),children:[(0,i.jsx)(U,{}),(0,i.jsx)(et,{className:h().canvas,tilePadHeight:N,tilePadWidth:R}),(0,i.jsx)("canvas",{className:h().canvas,id:"OtherCursors",ref:ev.otherCursorsRef,width:ee,height:$}),(0,i.jsx)("canvas",{className:h().canvas,id:"OtherPointer",ref:ev.otherPointerRef,width:ee,height:$}),(0,i.jsx)("canvas",{className:h().canvas,id:"MyCursor",ref:ev.myCursorRef,width:ee,height:$}),(0,i.jsx)("canvas",{className:h().canvas,id:"InteractionCanvas",ref:ev.interactionCanvasRef,width:ee,height:$,onPointerDown:e=>{if(2===e.button){e.preventDefault();let t=ev.interactionCanvasRef.current;if(!t)return;let{left:i,top:s}=t.getBoundingClientRect(),[l,o]=[e.clientX-i,e.clientY-s],[c,u]=[l/d+R>>>0,o/d+N>>>0],[h,f]=[Math.round(c+p.x),Math.round(u+p.y)],g=a.get(u,c);en(h,f,g);let x=L(g),m=_(g),[w,C]=[h-n,f-r],v=w>=-1&&w<=1&&C>=-1&&C<=1,k=ef?y.INSTALL_BOMB:y.SET_FLAG;if(v&&(x||m))eF(h,f,k);else if(!v&&(x||m)){let{x:e,y:t}=ez(h,f);if(!(e===1/0||t===1/0||ek.length>0)){let i=e+p.x,s=t+p.y;i===n&&s===r&&eF(h,f,k),eP(e,t,h,f,(e,t)=>eF(e,t,k))}}return}let t=ev.interactionCanvasRef.current;if(!t)return;let{left:i,top:s}=t.getBoundingClientRect(),[l,o]=[e.clientX-i,e.clientY-s];ew.current={x:l,y:o},ep.current&&clearTimeout(ep.current),ep.current=setTimeout(()=>{let e=ew.current;if(!e)return;let{x:t,y:i}=e,[s,l]=[t/d+R>>>0,i/d+N>>>0],[o,c]=[Math.round(s+p.x),Math.round(l+p.y)],u=a.get(l,s),h=L(u),f=_(u),g=h||f,[x,m]=[o-n,c-r];if(x>=-1&&x<=1&&m>=-1&&m<=1&&g)eF(o,c,y.DISMANTLE_MINE);else if(g){let{x:e,y:t}=ez(o,c);e===1/0||t===1/0||ek.length>0||eP(e,t,o,c,(e,t)=>eF(e,t,y.DISMANTLE_MINE))}eC.current=!0,ep.current=null,ew.current=null},500)},onPointerUp:eD,onPointerMove:e=>{if(!ep.current||!ew.current)return;let t=ev.interactionCanvasRef.current;if(!t)return;let{left:n,top:i}=t.getBoundingClientRect(),[r,s]=[e.clientX-n,e.clientY-i];Math.hypot(r-ew.current.x,s-ew.current.y)>10&&(clearTimeout(ep.current),ep.current=null,ew.current=null)},onPointerCancel:eD,onClick:e=>{if(eC.current){eC.current=!1;return}let t=ev.interactionCanvasRef.current;if(!t)return;let{left:i,top:s}=t.getBoundingClientRect(),[l,o]=[e.clientX-i,e.clientY-s],[c,u]=[l/d+R>>>0,o/d+N>>>0],[h,f]=[Math.round(c+p.x),Math.round(u+p.y)],g=a.get(u,c);en(h,f,g);let x=L(g),m=_(g),[w,C]=[h-n,f-r],v=w>=-1&&w<=1&&C>=-1&&C<=1,k=2!==e.buttons?"general":"special",b=x||m;if(v){if(ef&&b&&"special"===k){eF(h,f,y.INSTALL_BOMB);return}if(b&&"special"===k?eF(h,f,y.SET_FLAG):x&&"general"===k&&eF(h,f,y.OPEN_TILES),b)return}if(!v&&b){let{x:e,y:t}=ez(h,f);if(e===1/0||t===1/0||ek.length>0)return;let i=ef&&"special"===k?y.INSTALL_BOMB:eO[k],s=e+p.x,l=t+p.y;if(s===n&&l===r){i&&eF(h,f,i);return}if(!i)return;eP(e,t,h,f,(e,t)=>eF(e,t,i));return}if("special"===k&&ek.length>0)return;let{x:E,y:M}=eU(c,u);eW(h,f)&&([E,M]=[c,u]),eP(E,M,h,f)}})]})]})},eh=n(2723),ef=n.n(eh);function eg(e){let{time:t}=e;return(0,i.jsxs)("div",{className:ef().inactive,children:[(0,i.jsxs)("div",{className:ef().alert,children:[(0,i.jsx)("p",{children:"You`re stunned!"}),(0,i.jsx)("p",{children:"Try Again After"}),(0,i.jsxs)("p",{children:[t/60>>>0,":",(t%60).toString().padStart(2,"0")]})]}),(0,i.jsx)("div",{className:ef().ad,children:"광고 받습니다: kkh061101@naver.com"})]})}var ex=n(6324),em=n.n(ex);function ey(){return(0,i.jsx)("svg",{width:"22",height:"26",viewBox:"0 0 22 26",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,i.jsx)("path",{d:"M0.436226 1.88654C0.321855 0.917668 1.42232 0.282312 2.2042 0.865797L20.8289 14.7645C21.6738 15.3951 21.2476 16.7379 20.1937 16.7657L12.1637 16.978C11.0359 17.0078 9.99976 17.606 9.41006 18.5678L5.21123 25.4159C4.66013 26.3147 3.28415 26.0124 3.16055 24.9653L0.436226 1.88654Z",fill:"white"})})}function ep(){return(0,i.jsx)("svg",{width:"24",height:"14",viewBox:"0 0 24 14",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,i.jsx)("path",{d:"M2 2L11.5286 11.5286C11.7889 11.7889 12.2111 11.7889 12.4714 11.5286L22 2",stroke:"white",strokeWidth:"4",strokeLinecap:"round"})})}function ew(){return(0,i.jsxs)("svg",{width:"32",height:"32",viewBox:"0 0 32 32",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,i.jsx)("path",{d:"M20 5L26 5C26.5523 5 27 5.44772 27 6L27 12",stroke:"white",strokeWidth:"4",strokeLinecap:"round"}),(0,i.jsx)("path",{d:"M12 27L6 27C5.44772 27 5 26.5523 5 26L5 20",stroke:"white",strokeWidth:"4",strokeLinecap:"round"}),(0,i.jsx)("path",{d:"M5 12L5 6C5 5.44772 5.44772 5 6 5L12 5",stroke:"white",strokeWidth:"4",strokeLinecap:"round"}),(0,i.jsx)("path",{d:"M27 20L27 26C27 26.5523 26.5523 27 26 27L20 27",stroke:"white",strokeWidth:"4",strokeLinecap:"round"})]})}function eC(){return(0,i.jsxs)("svg",{width:"32",height:"32",viewBox:"0 0 32 32",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,i.jsx)("circle",{cx:"14",cy:"14",r:"9",stroke:"white",strokeWidth:"4"}),(0,i.jsx)("path",{d:"M27 27L21.5 21.5",stroke:"white",strokeWidth:"4",strokeLinecap:"round"})]})}function ev(){return(0,i.jsx)("svg",{width:"24",height:"14",viewBox:"0 0 24 14",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,i.jsx)("path",{d:"M2 12L11.5286 2.4714C11.7889 2.21105 12.2111 2.21106 12.4714 2.4714L22 12",stroke:"white",strokeWidth:"4",strokeLinecap:"round"})})}function eL(e){var t;let{renderRange:n,maxTileCount:r}=e,s=O(),{x:a,y:d}=c(),{useAnimation:h,setAnimation:f}=u(),{windowWidth:x,windowHeight:m}=o(),{zoom:y,zoomDown:p,zoomUp:w,originPosition:C,score:v,items:L,setIsBombMode:_,isBombMode:k}=g(),b=null!==(t=null==L?void 0:L.bomb)&&void 0!==t?t:0,E=x*n/(s/1.5),M=m*n/(s/1.5),[S,j]=(0,l.useState)(!0),T=()=>E*M>r;return(0,i.jsx)("div",{className:em().dashboard,children:(0,i.jsxs)("div",{className:em().bottom,children:[(0,i.jsxs)("div",{className:em().toggle,onPointerDown:()=>j(!S),children:[!S&&(0,i.jsx)(ep,{}),S&&(0,i.jsx)(ev,{})]}),S&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{className:em().score,children:[v," pts"]}),(0,i.jsxs)("div",{className:em().coordinates,children:[(0,i.jsxs)("p",{children:["\xa0",(0,i.jsx)(ey,{}),"(",C.x,", ",C.y,")"]}),(0,i.jsxs)("p",{children:[(0,i.jsx)(ew,{}),"\xa0(",a===1/0?"":a,", ",d===1/0?"":d,")"]}),(0,i.jsxs)("button",{type:"button",className:"".concat(em().bomb," ").concat(k?em().bombMode:""),onClick:()=>_(!k),children:[(0,i.jsx)("span",{children:"\uD83D\uDCA3"}),(0,i.jsxs)("span",{children:["X ",b]})]}),(0,i.jsxs)("p",{className:em().animation,onClick:()=>f(!h),children:[(0,i.jsx)("input",{type:"checkbox",checked:h,readOnly:!0}),"Animation"]})]}),(0,i.jsxs)("div",{className:em().zoom,children:[(0,i.jsxs)("p",{children:[(0,i.jsx)(eC,{}),"\xa0",Math.ceil(100*y),"%"]}),(0,i.jsxs)("div",{className:em().buttons,children:[(0,i.jsx)("button",{onPointerDown:()=>!T()&&p(),children:"-"}),(0,i.jsx)("button",{onPointerDown:w,children:"+"})]})]})]})]})})}var e_=n(1071),ek=n.n(e_),eb=n(3145),eE=JSON.parse('{"a":[{"id":1,"gif":"/mainvideos/moving.gif","description":{"en":"Click Open Tile to move cursor","ko":"열린 타일을 클릭하여 커서를 이동하세요"}},{"id":2,"gif":"/mainvideos/block.gif","description":{"en":"If the path to the tile you clicked is blocked, you cannot move.","ko":"클릭한 타일로 가는 길이 막혀있을 경우 이동이 되지 않습니다."}},{"id":3,"gif":"/mainvideos/zoom.gif","description":{"en":"Click - and + buttons to zoom in and out","ko":"확대 및 축소 버튼을 클릭하여 확대 및 축소하세요"}},{"id":4,"gif":"/mainvideos/open_tile.gif","description":{"en":"Click left mouse button on closed tile to open tile","ko":"닫힌 타일에 왼쪽 마우스 버튼을 클릭하여 타일을 엽니다"}},{"id":5,"gif":"/mainvideos/flag.gif","description":{"en":"Click right mouse button on open tile to flag tile","ko":"열린 타일에 오른쪽 마우스 버튼을 클릭하여 타일을 깃발로 표시하세요"}},{"id":6,"gif":"/mainvideos/mine.gif","description":{"en":"If the tile you clicked is a mine, you get a stun for 3 minutes","ko":"클릭한 타일이 지뢰인 경우 3분간 스턴을 받습니다"}},{"id":7,"gif":"/mainvideos/chat.gif","description":{"en":"If you click on a tile that is not a mine, the number of mines around the tile will be displayed","ko":"엔터 버튼을 누를 경우 채팅이 활성화 되며, 끄려면 ESC를 누르세요. 입력하고 엔터를 다시 누를 경우 채팅이 전송됩니다."}}]}'),eM=n(9376);function eS(){return(0,i.jsxs)("svg",{width:"120",height:"120",viewBox:"0 0 120 120",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,i.jsx)("path",{d:"M25 55L58.2322 21.7678C59.2085 20.7915 60.7915 20.7915 61.7678 21.7678L95 55",stroke:"white",strokeWidth:"10",strokeLinecap:"round"}),(0,i.jsx)("path",{d:"M25 90L58.2322 56.7678C59.2085 55.7915 60.7915 55.7915 61.7678 56.7678L95 90",stroke:"white",strokeWidth:"10",strokeLinecap:"round"})]})}function ej(){return(0,i.jsxs)("svg",{width:"120",height:"120",viewBox:"0 0 120 120",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,i.jsx)("path",{d:"M25 65L58.2322 98.2322C59.2085 99.2085 60.7915 99.2085 61.7678 98.2322L95 65",stroke:"white",strokeWidth:"10",strokeLinecap:"round"}),(0,i.jsx)("path",{d:"M25 30L58.2322 63.2322C59.2085 64.2085 60.7915 64.2085 61.7678 63.2322L95 30",stroke:"white",strokeWidth:"10",strokeLinecap:"round"})]})}function eT(){let e="https://gamultong.github.io/gamulpung-client",t=(0,eM.useSearchParams)().get("lang")||"ko",[n,r]=(0,l.useState)(-1),s=eE.a[n];return(0,l.useEffect)(()=>{"done"!==localStorage.getItem("tutorial")&&r(0)},[]),(0,i.jsx)(i.Fragment,{children:-1!==n&&(0,i.jsxs)("div",{className:ek().tutorial,children:[(0,i.jsx)("div",{className:ek().button,onClick:()=>r(n>0?n-1:n),children:n>0&&(0,i.jsx)(eS,{})}),(0,i.jsxs)("div",{className:ek().step,children:[(0,i.jsx)(eb.default,{src:"".concat(e).concat(s.gif),alt:s.gif,width:400,height:225}),(0,i.jsxs)("div",{children:[(0,i.jsxs)("p",{children:["Step ",s.id]}),(0,i.jsx)("p",{children:s.description[t]})]})]}),(0,i.jsx)("div",{className:ek().button,onClick:()=>{n<eE.a.length-1?r(n+1):(r(-1),localStorage.setItem("tutorial","done"))},children:eE.a.length-1>n?(0,i.jsx)(ej,{}):(0,i.jsx)(eb.default,{src:"".concat(e,"/icon.png"),alt:"Play",width:88,height:88})})]})})}var eR=n(1871),eI=n.n(eR),eN=()=>(0,i.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,i.jsx)("path",{d:"M3.75 17.25H20.25V18.75C20.25 19.5784 19.5784 20.25 18.75 20.25H5.25C4.42157 20.25 3.75 19.5784 3.75 18.75V17.25Z",fill:"#FFB743"}),(0,i.jsx)("path",{d:"M20.25 15.75H3.75L2.48723 6.91058C2.39554 6.2688 3.1063 5.82087 3.64571 6.18047L7.875 9L11.36 3.29721C11.6525 2.81866 12.3475 2.81866 12.64 3.29721L16.125 9L20.3543 6.18048C20.8937 5.82087 21.6045 6.2688 21.5128 6.91058L20.25 15.75Z",fill:"#FFB743"})]});let eA=(0,a.U)(e=>({rankings:[{ranking:1,score:12345},{ranking:2,score:12345},{ranking:3,score:12345},{ranking:4,score:12345},{ranking:5,score:12345},{ranking:6,score:12345},{ranking:7,score:12345},{ranking:8,score:12345},{ranking:9,score:12345},{ranking:10,score:12345}],setRanking:t=>e({rankings:t})}));function eB(){let{rankings:e}=eA(),[t,n]=(0,l.useState)(!0);return(0,i.jsxs)("div",{className:eI().scoreboard,children:[(0,i.jsxs)("div",{className:eI().toggle,onPointerDown:()=>n(!t),children:[(0,i.jsx)("span",{children:"RANK"}),t?(0,i.jsx)(ep,{}):(0,i.jsx)(ev,{})]}),t&&(0,i.jsx)("div",{className:eI().scoreList,children:e.map((e,t)=>(0,i.jsxs)("div",{className:eI().scoreItem,children:[(0,i.jsxs)("span",{children:["#",e.ranking," ",1===e.ranking&&(0,i.jsx)(eN,{})]}),(0,i.jsx)("span",{children:e.score})]},t))})]})}(0,a.U)(e=>({ranking:0,score:0,setRanking:t=>e({ranking:t.ranking,score:t.score})}));let eP=[["F00","F01"],["F10","F11"],["F20","F21"],["F30","F31"]],eF=["O","1","2","3","4","5","6","7"],eO=Array(256),eD=Array(256),eW=Array(256),eU=new Int8Array(128);(()=>{for(let e=0;e<eU.length;e++)eU[e]=-1;for(let e=48;e<=57;e++)eU[e]=e-48;for(let e=65;e<=70;e++)eU[e]=e-55;for(let e=97;e<=102;e++)eU[e]=e-87})();let ez=new Uint8Array(65536);(()=>{for(let e=0;e<65536;e++){let t=e>>8&255,n=255&e,i=t<128?eU[t]:-1,r=n<128?eU[n]:-1;if(i<0||r<0){ez[e]=255;continue}let s=i<<4|r,l=(128&s)!=0,o=(64&s)!=0,a=(32&s)!=0,c=(24&s)>>3,u=7&s;l?ez[e]=o?8:u:a?ez[e]=16+2*c:ez[e]=24}})(),(()=>{for(let e=0;e<256;e++){let t=e>>5,n=(4&t)!=0,i=(2&t)!=0,r=(1&t)!=0,s=(24&e)>>3,l=7&e;if(n)eO[e]=i?"B":eF[l],eD[e]="C0",eW[e]="C1";else if(r){eO[e]=null;let t=eP[s];eD[e]=t[0],eW[e]=t[1]}else eO[e]=null,eD[e]="C0",eW[e]="C1"}})();let eH=null,eZ=null;async function eG(){return eH||eZ||(eZ=(async()=>{let e=await n.e(464).then(n.bind(n,3464));return await e.default(),eH=e,e})())}async function eK(){await eG()}let eV=new TextEncoder;var eX=n(9720),eY=n.n(eX),eJ=n(4669);function eQ(){let[e,t]=(0,l.useState)(!1),{nodes:n,edges:r,onNodesChange:s,onEdgesChange:o,selectedSkill:a,onNodeClick:c,purchaseSkill:u,isPurchased:d}=ec();return(0,i.jsxs)("div",{className:"".concat(eY().skillTree," ").concat(e?eY().closed:""),children:[(0,i.jsx)("span",{children:"SKILL TREE"}),!e&&(0,i.jsxs)("div",{className:eY().skillContainer,children:[(0,i.jsx)("div",{className:eY().skillInfo,children:a?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("p",{className:eY().skillName,children:a.name}),(0,i.jsxs)("p",{className:eY().skillCost,children:[a.cost.toLocaleString()," G"]}),(0,i.jsx)("p",{className:eY().skillDesc,children:a.description})]}),!d&&(0,i.jsx)("button",{onClick:u,children:"BUY"})]}):(0,i.jsx)("span",{className:eY().skillPlaceholder,children:"SKILL INFO"})}),(0,i.jsx)("div",{className:eY().skillCanvas,children:(0,i.jsx)(er.ZP,{nodes:n,edges:r,onNodesChange:s,onEdgesChange:o,onNodeClick:c,nodesDraggable:!1,fitView:!0,children:(0,i.jsx)(eJ.Z,{})})})]}),(0,i.jsx)("button",{onClick:()=>t(!e),className:eY().toggleButton,children:e?"OPEN":"CLOSE"})]})}function eq(){let e="".concat("wss://gamulpung-server-prod.kimgh06.com","/session"),{}=c(),{isOpen:t,sendMessage:n,connect:r,disconnect:a}=m(),{position:u,zoom:d,originPosition:h}=g(),{zoomUp:f,zoomDown:v,setZoom:L}=g(),_=N(),{startPoint:k,endPoint:b,renderStartPoint:E,setTiles:M,setRenderTiles:R,setStartPoint:A,setEndPoint:B,setRenderStartPoint:P,setTileSize:F,padtiles:O,applyTileChanges:D,applyPackedChanges:W,reset:U}=I(),{windowWidth:z,windowHeight:H}=o(),[Z,G]=(0,l.useState)(-1),[K,V]=(0,l.useState)(!1),X=(0,l.useRef)(null),Y=(0,l.useRef)(!1),J=e=>{let t=e.key.toLowerCase();switch(["-","="].includes(t)&&e.preventDefault(),t){case"-":v();break;case"=":f()}};(0,l.useEffect)(()=>{eK().catch(e=>console.warn("WASM tile engine init failed, will use JS fallback:",e))},[]),(0,l.useLayoutEffect)(()=>(document.documentElement.style.overflow="hidden",V(!1),L(1),document.addEventListener("keydown",J),()=>{document.documentElement.style.overflow="auto",document.removeEventListener("keydown",J),X.current&&(clearTimeout(X.current),X.current=null),a(),U(),V(!1),G(-1)}),[]),(0,l.useLayoutEffect)(()=>{t||k.x===b.x||b.y===k.y||(G(-1),Y.current||(r(e),Y.current=!0))},[t,k]);let Q=(0,l.useCallback)(function(e,t,n,i,r,s,l){let o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,a=arguments.length>8&&void 0!==arguments[8]?arguments[8]:-1,c=Math.abs(e-n+1)<<1,u=c>>1,d=Math.abs(i-t+1),h=t-l.y,f="All"===s?0:n-l.x-1,g=-1===a?d*u:a,x=[],m=I.getState().tiles;for(let e=o;e<g;e++){let n=Math.floor(e/u),i=e%u,s=d-1-n,o=s+h;if(o<0||o>=m.height||0===m.width)continue;let a=t-s,g=Math.max(0,-f),y=Math.min(u,m.width-f);if(i<g||i>=y)continue;let p=n*c+(i<<1),w=ez[r.charCodeAt(p)<<8|r.charCodeAt(p+1)];if(255===w)continue;let v=i+f,L=v+a+l.x&1,_=C.FILL;w<8?_=w:8===w?_=C.BOMB:24===w?_=S(L):w>=16&&w<24&&(_=j(w-16>>1,L)),m.get(o,v)!==_&&x.push({row:o,col:v,value:_})}return x},[]),q=(0,l.useCallback)(async(e,t,n,i,r,s)=>{if(0===r.length)return;console.log("replaceTiles",s,performance.now()),"All"===s&&O(n,i,e,t,w.ALL);let l=n+1,o=e-1,a="All"===s,c=eH;if(c){let e=I.getState().tiles,n=eV.encode(r);if(c.process_hex_tiles_inplace){let r=e.clone();c.process_hex_tiles_inplace(n,r.data,r.width,r.height,o,t,l,i,k.x,k.y,a)>0&&M(r)}else W(c.process_hex_tiles(n,e.data,e.width,e.height,o,t,l,i,k.x,k.y,a))}else D(Q(o,t,l,i,r,s,k));console.log("replace",performance.now())},[O,Q,k,D,W,M]),$=(0,l.useCallback)(()=>{let e=80*d;return{width:1.5*z/e/2>>>0,height:1.5*H/e/2>>>0}},[d,z,H]);!function(e){let{getCurrentTileWidthAndHeight:t,replaceTiles:n,replaceBinaryTiles:i,setLeftReviveTime:r,setIsInitialized:s}=e,{sendMessage:o}=m(),{setRanking:a}=eA(),c=(0,l.useCallback)(async e=>{let{MY_CURSOR:i,CHAT:l,CURSORS_STATE:c,EXPLOSION:u,QUIT_CURSOR:d,SCOREBOARD_STATE:h,TILES_STATE:f}=p,{position:m,id:w,setPosition:C,setOriginPosition:v,setId:L,setScore:_,setItems:k}=g.getState(),{cursors:b,setCursors:E}=x.getState();try{let{header:g,payload:x}=JSON.parse(e),{event:p}=g;switch(p){case f:{let{tiles_li:e}=x,i=[];for(let r of e){let{data:e,range:s}=r,{top_left:l,bottom_right:o}=s,{width:a,height:c}=t(),[u,d]=[o.x-l.x+1,l.y-o.y+1],[h,f]=[u/2>>>0,d/2>>>0],g="PART";h===a&&f===c&&(g="All"),i.push(n(l.x,o.y,o.x,l.y,e,g))}await Promise.all(i);break}case u:{let{position:e}=x,{x:t,y:n}=e,{x:i,y:s}=m;i>=t-1&&i<=t+1&&s>=n-1&&s<=n+1&&(console.log("explosion",performance.now()),r(10));break}case h:{let{scoreboard:e}=x;a(Object.entries(e).map(e=>{let[t,n]=e;return{ranking:+t,score:n}}));let n=t();w||o(y.CREATE_CURSOR,n);break}case c:{let{cursors:e}=x,t=new Map;for(let n of e){if(n.id===w){_(n.score),k(n.items),C(n.position),v(n.position);continue}t.set(n.id,{color:"red",id:n.id,position:n.position,message:"",messageTime:0,pointer:{x:1/0,y:1/0},score:n.score,revive_at:new Date(n.active_at).getTime(),items:n.items})}let n=[],i=new Set;for(let e of b){let r=t.get(e.id);r?(n.push(r),i.add(e.id)):n.push(e)}for(let[e,r]of t)i.has(e)||n.push(r);E(n);break}case i:{let{id:e}=x;L(e),setTimeout(()=>s(!0),0);break}case d:{let{id:e}=x;E(b.filter(t=>t.id!==e));break}case l:{let{id:e,message:t}=x,n=b.map(n=>n.id!==e?n:{...n,message:t,messageTime:Date.now()+8e3});E(n)}}}catch(e){console.error(e)}},[n,r,s,t,o,a]),u=(0,l.useCallback)(async e=>{if(i)try{let t=new Uint8Array(e);await i(t)}catch(e){console.error("Binary message error:",e)}},[i]),{message:d}=m();(0,l.useLayoutEffect)(()=>{d&&c(d)},[d]);let{binaryMessage:h}=m();(0,l.useLayoutEffect)(()=>{h&&u(h)},[h])}({getCurrentTileWidthAndHeight:$,replaceTiles:q,setLeftReviveTime:G,setIsInitialized:V});let ee=(0,l.useMemo)(()=>{if(_.isEmpty)return T.empty();let e=h.x-u.x,t=h.y-u.y;return 0===e&&0===t?_:function(){let n=_.data,i=_.width,r=_.height,s=new T(i,r),l=s.data;l.fill(C.FILL);let o=Math.max(0,t),a=Math.min(r,r+t),c=Math.max(0,e),u=Math.min(i,i+e),d=Math.max(0,-t),h=Math.max(0,-e),f=u-c;if(f<=0||a<=o)return s;let g=a-o;for(let e=0;e<g;e++){let t=(o+e)*i+c,r=(d+e)*i+h;l.set(n.subarray(t,t+f),r);let s=E.y+d+e;for(let e=0;e<f;e++){let t=l[r+e];if(t>=16&&t<=39){let n=E.x+h+e;l[r+e]=254&t|n+s&1}}}return s}()},[_,h,E]);return(0,l.useLayoutEffect)(()=>{R(ee)},[ee,R]),(0,l.useLayoutEffect)(()=>{let e=80*d,[t,n]=[1.5*z/e/2>>>0,1.5*H/e/2>>>0];n<1||t<1||(A({x:u.x-t,y:u.y-n}),B({x:u.x+t,y:u.y+n}),P({x:h.x-t,y:h.y-n}),F(e))},[z,H,d,h,u,K]),(0,l.useLayoutEffect)(()=>{if(!K)return;let e=$();n(y.SET_WINDOW,e)},[z,H,d,K]),(0,l.useEffect)(()=>(Z>0&&(X.current=setTimeout(()=>G(e=>e>0?e-1:e),1e3)),()=>{X.current&&(clearTimeout(X.current),X.current=null)}),[Z]),(0,i.jsxs)("div",{className:s().page,children:[Z>0&&(0,i.jsx)(eg,{time:Z}),(0,i.jsx)(eT,{}),(0,i.jsx)(eB,{}),(0,i.jsx)(eQ,{}),(0,i.jsx)(eL,{renderRange:1.5,maxTileCount:2e4}),(0,i.jsx)(ed,{leftReviveTime:Z,paddingTiles:1.5,cursorOriginX:h.x,cursorOriginY:h.y})]})}},7397:function(e){e.exports={page:"page_page__9CbJ0"}},6507:function(e){e.exports={loading:"style_loading__42LVe",loadingBar:"style_loadingBar__AtBJr",loadingAnimation:"style_loadingAnimation__ScSQQ",loadComplete:"style_loadComplete__SRD5Z",canvasContainer:"style_canvasContainer__nKMjH",canvas:"style_canvas__m8mJO",vibration:"style_vibration__6_Fiw"}},6324:function(e){e.exports={dashboard:"style_dashboard__nDsof",bottom:"style_bottom___8aLI",score:"style_score__vmqZh",coordinates:"style_coordinates__3RzzR",animation:"style_animation__Kv66j",bomb:"style_bomb__yX97I",bombMode:"style_bombMode__KI65w",toggle:"style_toggle__R68Vw",zoom:"style_zoom__EWfUf",buttons:"style_buttons__zf0nF"}},2698:function(e){e.exports={chat:"style_chat__ZTXhD",message:"style_message__uEVba"}},2723:function(e){e.exports={inactive:"style_inactive__B_gRa",fade:"style_fade__sZevv",alert:"style_alert__pv_lG",ad:"style_ad__2DN3O"}},1871:function(e){e.exports={scoreboard:"style_scoreboard__Th1NE",scoreList:"style_scoreList__P4ewN",scoreItem:"style_scoreItem__lRMtn",toggle:"style_toggle__axVEQ"}},9720:function(e){e.exports={skillTree:"style_skillTree__I_uYb",skillContainer:"style_skillContainer__pchHZ",skillCanvas:"style_skillCanvas__Keawm",skillInfo:"style_skillInfo__K5nQm",skillName:"style_skillName__A7_1D",skillDesc:"style_skillDesc__s_Ail",skillCost:"style_skillCost__9pUKk",skillPlaceholder:"style_skillPlaceholder__2iOpv",toggleButton:"style_toggleButton__SGLp4",closed:"style_closed__3UTSI"}},1071:function(e){e.exports={tutorial:"style_tutorial__75p5w",step:"style_step__kswJY",fade:"style_fade__KaBU4",button:"style_button__rjKit"}}},function(e){e.O(0,[398,519,145,29,214,971,117,744],function(){return e(e.s=6124)}),_N_E=e.O()}]);