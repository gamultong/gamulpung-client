(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{6124:function(e,t,n){Promise.resolve().then(n.bind(n,6837))},6837:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return ef}});var r=n(7437),o=n(7397),i=n.n(o),l=n(2265),a=n(8144),s=n(3011);let c=(0,s.U)(e=>({id:"",x:0,y:0,color:"blue",originX:0,originY:0,zoom:1,setId:t=>e({id:t}),setColor:t=>e({color:t}),setX:t=>e({x:t}),setY:t=>e({y:t}),setZoom:t=>e({zoom:t}),setOringinPosition:(t,n)=>e({originX:t,originY:n}),goOriginTo:(t,n)=>e(e=>({originX:t+e.originX,originY:n+e.originY})),setPosition:(t,n)=>e({x:t,y:n}),zoomUp:()=>e(e=>({zoom:1.5*e.zoom<1.7?1.5*e.zoom:e.zoom})),zoomDown:()=>e(e=>({zoom:e.zoom/1.5>.15?e.zoom/1.5:e.zoom})),moveUp:()=>e(e=>({y:e.originY-1})),moveDown:()=>e(e=>({y:e.originY+1})),moveLeft:()=>e(e=>({x:e.originX-1})),moveRight:()=>e(e=>({x:e.originX+1}))})),u=(0,s.U)(e=>({cursors:[],addCursors:t=>e(e=>({cursors:[...e.cursors,...t]})),removeCursor:t=>e(e=>({cursors:e.cursors.filter(e=>e!==t)})),setCursors:t=>e({cursors:t})}));var d=n(6507),h=n.n(d),f=JSON.parse('{"tileColors":{"inner":[["#8fe340","#A4E863"],["#62B628","#71C637"],["#F1FAD1","#E9F6B9"]],"outer":[["#A8EC67","#81D92C"],["#74C63C","#5BB31F"],["#E9FAAA","#F5FDD8"]]},"flagPaths":["M219.428 109.389 C226.519 114.964 223.188 126.337 214.21 127.205 L79.8702 140.188 L115.929 28.0267 L219.428 109.389 Z","M79.9801 8.51632 C75.8798 9.72627 73.972 13.8825 73.0599 18.0591 L25.8244 234.356 C30.5707 235.401 36.0988 236 42 236 C45.1362 236 48.1671 235.831 51.0311 235.515 L116.451 28.5289 C117.573 24.9766 117.96 21.0358 115.39 18.3387 C112.87 15.6942 108.055 12.4097 98.862 9.69397 C89.7757 7.00975 83.7643 7.39963 79.9801 8.51632 Z"],"boomPaths":[" M77.85 145.025 L0.899994 54.5752 L103.5 92.3752 L117 0.575195 L164.25 74.8252 L219.6 38.3752 L202.05 103.175 L276.3 108.575 L219.6 153.125 L287.1 223.325 L198 230.075 L177.75 312.425 L130.5 236.825 L67.05 284.075 L75.15 196.325 L11.7 177.425 L77.85 145.025 "," M67.05 104.525 L104.85 150.425 L71.1 169.325 L104.85 178.775 L100.8 226.025 L133.2 200.375 L158.85 239.525 L168.3 196.325 L218.25 192.275 L181.8 154.475 L212.85 131.525 L171 128.825 L181.8 93.7251 L152.1 113.975 L126.45 73.4751 L118.35 122.075 L67.05 104.525 "],"cursorPaths":"M1.50025 12.3269C-1.20902 5.52993 5.52992 -1.20901 12.3269 1.50027L52.892 17.6696C60.2374 20.5975 59.7565 31.1525 52.1752 33.4002L50.7 33.8376C42.5878 36.2427 36.2427 42.5878 33.8376 50.7L33.4002 52.1752C31.1525 59.7565 20.5975 60.2374 17.6696 52.892L1.50025 12.3269Z","countColors":["#0059B280","#0095B280","#00B20080","#77B20080","#B2950080","#B24A0080","#B2000080","#7700B280"],"stunPaths":["M129.815 125.662C130.503 123.446 133.497 123.446 134.185 125.662L139.22 141.887C139.527 142.878 140.409 143.549 141.404 143.549H157.699C159.924 143.549 160.849 146.53 159.049 147.899L145.866 157.927C145.061 158.539 144.724 159.625 145.032 160.616L150.067 176.841C150.755 179.057 148.333 180.899 146.533 179.53L133.35 169.502C132.545 168.89 131.455 168.89 130.65 169.502L117.467 179.53C115.667 180.899 113.245 179.057 113.933 176.841L118.968 160.616C119.276 159.625 118.939 158.539 118.134 157.927L104.951 147.899C103.151 146.53 104.076 143.549 106.301 143.549H122.596C123.591 143.549 124.473 142.878 124.78 141.887L129.815 125.662Z","M194.44 89.187C194.931 87.6043 197.069 87.6043 197.56 89.187L201.157 100.776C201.377 101.484 202.007 101.963 202.717 101.963H214.356C215.946 101.963 216.606 104.093 215.321 105.071L205.905 112.234C205.329 112.671 205.089 113.446 205.309 114.154L208.905 125.744C209.396 127.326 207.666 128.642 206.38 127.664L196.964 120.501C196.389 120.064 195.611 120.064 195.036 120.501L185.62 127.664C184.334 128.642 182.604 127.326 183.095 125.744L186.691 114.154C186.911 113.446 186.671 112.671 186.095 112.234L176.679 105.071C175.394 104.093 176.054 101.963 177.644 101.963H189.283C189.993 101.963 190.623 101.484 190.843 100.776L194.44 89.187Z","M170 93.7976C170 90.9223 167.92 88.439 165.054 88.2051C163.391 88.0694 161.705 88 160 88C139.889 88 122.445 97.66 113.794 111.795C111.465 115.603 114.57 120 119.034 120C121.483 120 123.681 118.599 125.072 116.583C131.592 107.134 144.005 100 160 100C160.973 100 161.933 100.026 162.879 100.078C166.586 100.281 170 97.5106 170 93.7976ZM206 132C202.686 132 200.06 134.723 199.266 137.94C196.313 149.9 184.652 160.816 167.768 163.416C164.571 163.908 162 166.522 162 169.756C162 173.154 164.823 175.908 168.191 175.457C190.725 172.44 208.443 157.177 211.524 137.977C212.049 134.705 209.314 132 206 132Z"]}');let g=(0,s.U)(e=>({x:1/0,y:1/0,content:"",movecost:0,setMovecost:t=>e({movecost:t}),setPosition:(t,n,r)=>e({x:t,y:n,content:r})})),x=(0,s.U)(e=>({socket:null,message:"",isOpen:!1,connect:t=>{let n=new WebSocket(t);n.onopen=()=>e({socket:n,isOpen:!0}),n.onclose=()=>e({socket:null,isOpen:!1}),n.onmessage=t=>e({message:t.data})},disconnect:()=>{let{socket:t}=x.getState();null==t||t.close(),e({socket:null,isOpen:!1})},sendMessage:e=>{if(!e)return;let{socket:t,isOpen:n}=x.getState();n&&t&&t.send(e)}}));var y=n(2698),m=n.n(y);let p={CLOSED:"C",FLAGGED:"F",BOOM:"B"},L={SET_VIEW_SIZE:"set-view-size",MOVING:"moving",FETCH_TILES:"fetch-tiles",POINTING:"pointing",SEND_CHAT:"send-chat"},C={MY_CURSOR:"my-cursor",YOU_DIED:"you-died",MOVED:"moved",ERROR:"error",POINTER_SET:"pointer-set",CURSORS:"cursors",CURSORS_DIED:"cursors-died",CURSOR_QUIT:"cursor-quit",CHAT:"chat",TILES:"tiles",FLAG_SET:"flag-set",SINGLE_TILE_OPENED:"single-tile-opened",TILES_OPENED:"tiles-opened"},w={RIGHT:"R",LEFT:"L",UP:"U",DOWN:"D",ALL:"A"};function v(){let[e,t]=(0,l.useState)(""),[n,o]=(0,l.useState)(0),[i,s]=(0,l.useState)(0),[d,h]=(0,l.useState)(Date.now()),{sendMessage:f}=x(),{color:g,originX:y,originY:p,zoom:C}=c(),{cursors:w}=u(),{windowHeight:v,windowWidth:b}=(0,a.Z)(),E=(0,l.useRef)(null),_=(0,l.useRef)(null),k=e=>e?e-d>4e3?1:(e-d)/4e3:0,S={left:"51%",top:"51%",backgroundColor:g,opacity:k(i)};(0,l.useEffect)(()=>{if(!_.current||!e)return;let t=requestAnimationFrame(()=>{_.current&&o(_.current.getBoundingClientRect().width)});return()=>cancelAnimationFrame(t)},[e]);let T=e=>{var n;"Enter"===e.key&&(null===(n=E.current)||void 0===n||n.focus()),"Escape"===e.key&&(t(""),s(null))};return(0,l.useEffect)(()=>(window.addEventListener("keydown",T),()=>window.removeEventListener("keydown",T)),[]),(0,l.useEffect)(()=>{setTimeout(()=>h(Date.now()),1e3)},[d]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("form",{className:m().chat,onSubmit:n=>{n.preventDefault(),s(Date.now()+8e3),""===e||i<d||(f(JSON.stringify({event:L.SEND_CHAT,payload:{message:e}})),t(""))},style:S,children:[(0,r.jsx)("input",{type:"text",ref:E,className:m().message,value:e,maxLength:40,onChange:e=>{t(e.target.value),s(Date.now()+8e3)},style:{width:"".concat(n+5,"px"),color:"yellow"===g?"black":"white"}}),(0,r.jsx)("div",{ref:_,"aria-hidden":!0,children:e})]}),w.map((e,t)=>(0,r.jsx)("div",{className:m().chat,style:{left:"".concat(b/2+(e.x-y-1/C/2)*C*80,"px"),top:"".concat(v/2+(e.y-p-1/C/2)*C*80,"px"),backgroundColor:e.color,color:"yellow"===e.color?"black":"white",opacity:k(e.messageTime)},children:e.message},"".concat(e.id,"-").concat(t)))]})}var b=n(4648),E=n(1442);let _=(e,t,n)=>{e.save(),e.fillStyle=n,e.fill(t),e.restore()},k=e=>{let t=parseInt(e.replace("#",""),16);return{r:t>>16&255,g:t>>8&255,b:255&t}},S=(e,t,n)=>Math.round(e+(t-e)*n),T=e=>new Path2D(e),M=e=>{let t=[];return e.forEach(e=>t.push(new Path2D(e))),t},O=["#FF4D00","#F0C800","#0094FF","#BC3FDC"];function j(e){let{tiles:t,tileSize:n,tilePadWidth:o,tilePadHeight:i,className:s}=e,{flagPaths:u,tileColors:d,countColors:h,boomPaths:g}=f,{outer:x,inner:y}=d,{zoom:m}=c(),{windowHeight:L,windowWidth:C}=(0,a.Z)(),w=(0,l.useRef)(new Map),v=()=>new Map,M=(0,l.useRef)(null),j=(0,l.useRef)([]),F=(0,l.useRef)({outerCachedSprite:v(),innerCachedSprite:v(),boomCachedSprite:v(),flagCachedSprite:v(),numberCachedSprite:v()}),A=e=>e.getContext("2d",{willReadFrequently:!1,desynchronized:!0}),N=(0,l.useMemo)(()=>{let e=w.current,t=(t,r)=>{let o="".concat(t).concat(r).concat(n);if(e.has(o))return e.get(o);let i=document.createElement("canvas");i.width=i.height=4;let l=A(i);if(!l)return;let a=k(t),s=k(r);for(let e=0;e<4;e++){let t=e/3,n=S(a.r,s.r,t),r=S(a.g,s.g,t),o=S(a.b,s.b,t);l.fillStyle="rgb(".concat(n,", ").concat(r,", ").concat(o,")"),l.fillRect(e,0,1,4)}let c=E.xEZ.from(i);c.baseTexture.scaleMode=E.aH$.NEAREST,c.baseTexture.mipmap=E.WBB.OFF,c.baseTexture.wrapMode=E.Nt$.CLAMP,c.baseTexture.setSize(4,4),c.baseTexture.resolution=.001,e.set(o,c)};for(let e=0;e<x.length;e++)t(x[e][0],x[e][1]),t(y[e][0],y[e][1]);let r=document.createElement("canvas");r.width=r.height=n/3;let o=A(r);if(o){o.scale(m/3/4,m/3/4),_(o,T(g[0]),"rgba(0, 0, 0, 0.6)"),_(o,T(g[1]),"rgba(0, 0, 0, 0.5)");let t=E.xEZ.from(r);t.baseTexture.scaleMode=E.aH$.NEAREST,t.baseTexture.mipmap=E.WBB.OFF,t.baseTexture.setSize(n/3,n/3),e.set("boom",t)}for(let t=0;t<O.length;t++){let r=document.createElement("canvas");r.width=r.height=n/2;let o=A(r);if(!o)continue;let i=o.createLinearGradient(36.5,212.5,36.5,259);i.addColorStop(0,"#E8E8E8"),i.addColorStop(1,"transparent"),o.translate(r.width/6,r.height/6),o.scale(m/2/4.5,m/2/4.5),_(o,T(u[0]),O[t]),_(o,T(u[1]),i);let l=E.xEZ.from(r);l.baseTexture.scaleMode=E.aH$.NEAREST,l.baseTexture.mipmap=E.WBB.OFF,l.baseTexture.setSize(n,n),e.set("flag".concat(t),l)}return e},[n]),R=(0,l.useMemo)(()=>{let e=new Map;for(let t=1;t<=h.length;t++){let r=document.createElement("canvas");r.width=r.height=n;let o=A(r);if(!o)continue;o.clearRect(0,0,n,n),o.textAlign="center",o.textBaseline="middle",o.font="".concat(.6*n>>>0,"px LOTTERIACHAB"),o.fillStyle=h[t-1],o.imageSmoothingEnabled=!1,o.fillText("".concat(t),n/2,n/2);let i=E.xEZ.from(r);i.baseTexture.scaleMode=E.aH$.NEAREST,i.baseTexture.mipmap=E.WBB.OFF,i.baseTexture.wrapMode=E.Nt$.CLAMP,i.baseTexture.setSize(n,n),i.baseTexture.resolution=1,e.set(t,i)}return e},[n]),P=(e,t,n,r,o,i,l)=>({startCol:Math.max(0,Math.ceil(n-1)),endCol:Math.min(t-1,n+(o+l)/(l||1)>>>0),startRow:Math.max(0,Math.ceil(r-1)),endRow:Math.min(e-1,r+(i+l)/(l||1)>>>0)}),D=(e,t,n)=>{let r=(131071*e+t)*131+(0|n)>>>0;return{tileKeyNum:r,typeKeyBase:10*r>>>0}},I=e=>e===p.CLOSED||e===p.FLAGGED,B=(e,t)=>{if(!I("string"==typeof e?e[0]:"".concat(e)))return{...t,closed:!1};let r=+String(e).slice(-1)%2;return{outerTexture:N.get("".concat(x[r][0]).concat(x[r][1]).concat(n))||t.outerTexture,innerTexture:N.get("".concat(y[r][0]).concat(y[r][1]).concat(n))||t.innerTexture,closed:!0}},U=(e,t,n,r,o)=>{let i=(e-n)*o,l=(t-r)*o,a=Math.round(i),s=Math.round(l),c=Math.round(i+o),u=Math.round(l+o);return{xFloat:i,yFloat:l,startX:a,startY:s,endX:c,endY:u,w:c-a,h:u-s}},[W,V]=(0,l.useState)(!1);(0,l.useLayoutEffect)(()=>{let e=M.current;if(!e)return;let t=Math.ceil((C/(n||1)+2)*(L/(n||1)+2));for(;j.current.length<t;){let t=new E.jyi;t.roundPixels=!0,t.eventMode="none",t.cullable=!0;let n=new E.jyi;n.roundPixels=!0,n.eventMode="none",n.cullable=!0,e.addChild(t),e.addChild(n),j.current.push({outer:t,inner:n})}for(let e=t;e<j.current.length;e++){let t=j.current[e];t.outer.visible=t.inner.visible=!1}let{current:r}=j,o=0;for(;o<K.length&&o<r.length;){let{outerTexture:e,innerTexture:t,startX:i,startY:l,endX:a,endY:s}=K[o],c=r[o++];c.outer.texture=e,c.outer.x=i,c.outer.y=l,c.outer.width=c.outer.height=n;let u=5*m,d=Math.round(i+u),h=Math.round(l+u),f=Math.round(a-u),g=Math.round(s-u);c.inner.x=d,c.inner.y=h,c.inner.texture=t,c.inner.width=Math.max(0,f-d),c.inner.height=Math.max(0,g-h),c.outer.visible=c.inner.visible=!0}for(;o<r.length;)r[o].outer.visible=r[o++].inner.visible=!1},[t,C,L,n,m,W]);let{outerSprites:z,innerSprites:H,boomSprites:G,flagSprites:Z,textElements:Y,closedEntries:K,bgKey:J}=(0,l.useMemo)(()=>{let e={outerSprites:[],innerSprites:[],boomSprites:[],flagSprites:[],textElements:[],closedEntries:[],bgKey:""},a=t.length;if(0===a)return e;let s=t[0].length;if(0===s)return e;let{startCol:c,endCol:u,startRow:d,endRow:h}=P(a,s,o,i,C,L,n);if(c>u||d>h||!Number.isFinite(c+u+d+h))return e;let f=Math.max(0,h-d+1|0)*Math.max(0,u-c+1|0);(!Number.isFinite(f)||f<0)&&(f=0);let g=Array(f),w=Array(f),v=Array(f),E=Array(f),_=Array(f),k=[],[S,T,M,O,j]=[0,0,0,0,0],[A,I]=[0,0],{outerCachedSprite:W,innerCachedSprite:V,boomCachedSprite:z,flagCachedSprite:H,numberCachedSprite:G}=F.current,Z={outerTexture:N.get("".concat(x[2][0]).concat(x[2][1]).concat(n)),innerTexture:N.get("".concat(y[2][0]).concat(y[2][1]).concat(n))};if(!Z.outerTexture||!Z.innerTexture)return e;for(let e=d;e<=h;e++)for(let a=c;a<=u;a++){var Y,K,J,X,Q;let{xFloat:s,yFloat:c,startX:u,startY:d,endX:h,endY:f,w:x,h:y}=U(a,e,o,i,n),L=t[e][a],{outerTexture:C,innerTexture:F,closed:P}=B(L,Z),{typeKeyBase:$}=D(e,a,n);if(P||(A++,I=I+((4099*e^131*a)>>>0)+(0|+L[0])>>>0),C){let e="".concat(C.baseTexture.uid).concat(n),t=null!==(Y=W.get(e))&&void 0!==Y?Y:(0,r.jsx)(b.jy,{cullable:!1,roundPixels:!0,eventMode:"none",texture:C});if(W.set(e,t),!P){let{width:e,height:n}=C,r={x:x/e,y:y/n};g[S++]=(0,l.cloneElement)(t,{key:$,x:u,y:d,scale:r})}}if(F){let e="".concat(F.baseTexture.uid).concat(n),t=5*m,o=Math.round(s+t),i=Math.round(c+t),a=Math.max(0,Math.round(u+x-t)-o),g=Math.max(0,Math.round(d+y-t)-i),p=null!==(K=V.get(e))&&void 0!==K?K:(0,r.jsx)(b.jy,{cullable:!1,roundPixels:!0,eventMode:"none",texture:F});if(V.set(e,p),P)k.push({startX:u,startY:d,endX:h,endY:f,outerTexture:C,innerTexture:F});else{let{width:e,height:t}=F,n={x:a/e,y:g/t};w[T++]=(0,l.cloneElement)(p,{key:$+1,x:o,y:i,scale:n})}}if(L===p.BOOM){let e="boom".concat(n),t=N.get("boom"),o=null!==(J=z.get(e))&&void 0!==J?J:(0,r.jsx)(b.jy,{cullable:!0,roundPixels:!0,eventMode:"none",texture:t});if(z.set(e,o),!t)continue;let{width:i,height:a}=t,s={x:x/i,y:y/a};v[M++]=(0,l.cloneElement)(o,{key:$+2,x:u,y:d,scale:s})}if(L[0]===p.FLAGGED){let e=L[1],t="flag".concat(e).concat(n),o=N.get("flag".concat(e)),i=null!==(X=H.get(t))&&void 0!==X?X:(0,r.jsx)(b.jy,{cullable:!0,roundPixels:!0,eventMode:"none",texture:o,anchor:.5});if(H.set(t,i),!o)continue;let{width:a,height:s}=o,c={x:x/a,y:y/s};E[O++]=(0,l.cloneElement)(i,{key:$+3,x:u+n/2,y:d+n/2,scale:c})}let q=R.get(+L);if(!q)continue;let ee="num".concat(+L).concat(n),et=null!==(Q=G.get(ee))&&void 0!==Q?Q:(0,r.jsx)(b.jy,{cullable:!0,roundPixels:!0,eventMode:"none",texture:q,anchor:.5});G.set(ee,et);let{width:en,height:er}=q,eo={x:x/en,y:y/er};_[j++]=(0,l.cloneElement)(et,{key:$+4,x:u+n/2,y:d+n/2,scale:eo})}let $="".concat(n).concat(A).concat(I);return{outerSprites:g.slice(0,S),innerSprites:w.slice(0,T),boomSprites:v.slice(0,M),flagSprites:E.slice(0,O),textElements:_.slice(0,j),closedEntries:k,bgKey:$}},[t]);return N.size&&R.size?(0,r.jsx)(b.Hf,{id:"Tilemap",className:s,width:C,height:L,options:{backgroundColor:8421504,resolution:1,antialias:!1,powerPreference:"high-performance",autoDensity:!1,preserveDrawingBuffer:!1,clearBeforeRender:!0,sharedTicker:!0},children:(0,r.jsxs)(b.W2,{name:"container",sortableChildren:!1,eventMode:"none",cacheAsBitmap:!1,cullable:!0,children:[N.size>0&&(0,r.jsxs)(b.W2,{name:"background",eventMode:"none",cacheAsBitmap:!0,children:[z,H,Y]},"bg".concat(J)),(0,r.jsx)(b.W2,{name:"closed-layer",ref:e=>{M.current=e,e&&V(!0)},eventMode:"none",sortableChildren:!1}),G,Z]})}):null}let F=[[-1,0],[0,-1],[0,1],[1,0],[-1,-1],[-1,1],[1,-1],[1,1]],A={red:"#FF4D00",blue:"#0094FF",yellow:"#F0C800",purple:"#BC3FDC",0:"#FF4D00",1:"#F0C800",2:"#0094FF",3:"#BC3FDC"},N={red:"#FBCBB6",blue:"#A8DBFF",yellow:"#FFEE99",purple:"#E8BEF3",0:"#FBCBB6",1:"#A8DBFF",2:"#FFEE99",3:"#E8BEF3"},R={GENERAL_CLICK:"GENERAL_CLICK",SPECIAL_CLICK:"SPECIAL_CLICK"};class P{constructor(e,t){this.x=e,this.y=t,this.gScore=1/0,this.heuristic=0,this.fTotal=1/0,this.parent=null}}var D=e=>{let{paddingTiles:t,tiles:n,tileSize:o,cursorOriginX:i,cursorOriginY:s,startPoint:d,leftReviveTime:y}=e,[m,C]=[i-d.x,s-d.y],w=1/(t-1),[b,E]=[(t-1)*m/t,(t-1)*C/t],[_,k]=[b*w,E*w],{boomPaths:S,cursorPaths:O,flagPaths:D,stunPaths:I}=f,{windowHeight:B,windowWidth:U}=(0,a.Z)(),{setPosition:W,x:V,y:z,setMovecost:H}=g(),{x:G,y:Z,zoom:Y,color:K,setPosition:J,goOriginTo:X}=c(),{cursors:Q}=u(),{sendMessage:$}=x(),q=(0,l.useRef)(null),ee={interactionCanvasRef:(0,l.useRef)(null),otherCursorsRef:(0,l.useRef)(null),otherPointerRef:(0,l.useRef)(null),myCursorRef:(0,l.useRef)(null)},[et,en]=(0,l.useState)(!0),[er,eo]=(0,l.useState)([]),[ei,el]=(0,l.useState)({x:0,y:0}),[ea,es]=(0,l.useState)(),[ec,eu]=(0,l.useState)(),ed=()=>{q.current&&(clearInterval(q.current),q.current=null)},eh=(e,t)=>{let n=e.getBoundingClientRect();e.width=n.width,e.height=n.height,e.style.width=n.width+"px",e.style.height=n.height+"px",t.imageSmoothingEnabled=!0,t.imageSmoothingQuality="high","textRenderingOptimization"in t&&(t.textRenderingOptimization="optimizeQuality")};(0,l.useEffect)(()=>{let e=e=>e.preventDefault();return window.addEventListener("contextmenu",e),()=>{window.removeEventListener("contextmenu",e),ed()}},[]);let ef=e=>{let t=e[0];return t!==p.CLOSED&&t!==p.FLAGGED},eg=(e,t,n,r,l)=>{if(q.current)return;let a=0,c=eb(m,C,e,t),u=c[a];if((null==u?void 0:u.x)===void 0||(null==u?void 0:u.y)===void 0)return;let[h,f]=[i,s];H(c.length-1),J(e+d.x,t+d.y);let g=(e,t)=>{let{interactionCanvasRef:n,otherCursorsRef:r,otherPointerRef:i}=ee,l=document.getElementById("Tilemap"),a=[n.current,r.current,i.current,l],s=performance.now(),c=n=>{let r=Math.min((n-s)/200,1),i=o*(1-r),[l,u]=[i*e,i*t];a.forEach(e=>e.style.transform="translate(".concat(l,"px, ").concat(u,"px)")),r<1?requestAnimationFrame(c):a.forEach(e=>e.style.transform="translate(0, 0)")};requestAnimationFrame(c)};q.current=setInterval(()=>{if(++a>=c.length){ex(n,r,l),eo([]),ed();return}let e=c[a];if(!e)return;let[t,o]=[Math.sign(e.x-u.x),Math.sign(e.y-u.y)];es({x:t,y:o}),X(t,o),[h,f]=[t+h,o+f],u=e,eo(c.slice(a)),Y<.4||g(t,o)},200)},ex=(e,t,n)=>{$(JSON.stringify({event:L.POINTING,payload:{position:{x:e,y:t},click_type:n}}))},ey=(e,t)=>F.some(n=>{let[r,o]=n;return i+r===e&&s+o===t}),em=(e,t)=>{let r={x:1/0,y:1/0};return[[0,0],...F].some(o=>{let[i,l]=o,a=e+i,s=t+l;return!!(n[s]&&n[s][a]&&ef(n[s][a]))&&(r={x:a,y:s},!0)}),r},ep=(0,l.useCallback)(function(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,s=Y*a;if(e.save(),e.fillStyle=r,e.translate(t,n),1===a){let t=o>>1,n=t>>2;switch((Math.round((l+Math.PI)/(Math.PI/4))+2)%8){case 0:e.translate(t,n);break;case 1:e.translate(o-n,n);break;case 2:e.translate(o-n,t);break;case 3:e.translate(o-n,o-n);break;case 4:e.translate(t,o-n);break;case 5:e.translate(n,o-n);break;case 6:e.translate(n,t);break;case 7:e.translate(n,n)}}else e.translate(o/2,o/2);if(e.rotate(l-Math.PI/4),e.scale(s,s),e.fill(ec.cursor),e.restore(),!(i>0&&Date.now()<i&&(null==ec?void 0:ec.stun)))return;let c=Y/2;e.save(),e.translate(t-o/2,n-o/2),e.fillStyle="white",e.strokeStyle="black",e.scale(c,c),ec.stun.forEach(t=>{e.fill(t),e.stroke(t)}),e.restore()},[o,ec]),eL=(0,l.useCallback)(()=>{let e=ee.otherCursorsRef.current;if(!e)return;let t=e.getContext("2d");t&&(eh(e,t),t.clearRect(0,0,U,B),Q.forEach(e=>{var n;let{x:r,y:l,color:a,revive_at:c}=e,{x:u,y:d}=null!==(n=null==e?void 0:e.pointer)&&void 0!==n?n:{x:r,y:l},[h,f]=[r-i+_,l-s+k],[g,x]=[r-u,l-d];ep(t,h*o,f*o,A[a],c,0!==g||0!==x?Math.atan2(x,g):0)}))},[Q,i,s,b,E,o,U,B,ee.otherCursorsRef]),eC=(0,l.useCallback)((e,t,n,r,i)=>{e&&(e.beginPath(),e.strokeStyle=r,e.lineWidth=i,e.strokeRect(t+i/2,n+i/2,o-i,o-i),e.closePath())},[o]),ew=e=>{let t=ee.otherPointerRef.current;if(!t)return;let n=t.getContext("2d");n&&(eh(t,n),n.clearRect(0,0,U,B),Q.forEach(t=>{let{pointer:r,color:l}=t,{x:a,y:c}=null!=r?r:{x:0,y:0},[u,d]=[a-i+_,c-s+k];eC(n,u*o,d*o,N[l],e)}))},ev=(e,t)=>Q.some(n=>n.x===e+d.x&&n.y===t+d.y),eb=(e,t,r,o)=>{let i=(e,t)=>{let n=[];for(let[r,o]of F){let[i,l]=[t.x+r,t.y+o];l<0||l>=e.length||i<0||i>=e[l].length||null===e[l][i]||ev(i,l)||n.push({node:e[l][i],isDiagonal:0!==r&&0!==o})}return n},l=(e,t,n)=>({x:e.x-t,y:e.y-n}),[a,s]=[new P(e,t),new P(r,o)],c=n.map((e,t)=>e.map((e,n)=>ef(e)?new P(n,t):null)),u=[a],d=[];for(a.gScore=0,a.fTotal=a.gScore+a.heuristic;u.length>0;){let n=u.reduce((e,t)=>e.fTotal<t.fTotal?e:t);if(n.x===s.x&&n.y===s.y){el(l(n,e,t));let r=[];for(let o=n;o;o=o.parent)r.unshift({x:o.x-e,y:o.y-t});return r}for(let{node:e,isDiagonal:t}of(u=u.filter(e=>e!==n),d.push(n),i(c,n))){if(d.includes(e))continue;let r=n.gScore+(t?14:10);r>=e.gScore||(u.includes(e)||u.push(e),e.parent=n,e.gScore=r,e.heuristic=Math.abs(e.x-s.x)+Math.abs(e.y-s.y),e.fTotal=e.gScore+e.heuristic)}}return[]},eE=()=>{let{interactionCanvasRef:e,myCursorRef:n,otherCursorsRef:r,otherPointerRef:l}=ee,{current:a}=e,{current:c}=n,{current:u}=r,{current:d}=l;if(!a||!c||!u||!d)return;let[h,f]=[a.getContext("2d"),c.getContext("2d")];if(!h||!f)return;eh(a,h),eh(c,f),f.clearRect(0,0,U,B),h.clearRect(0,0,U,B);let g=A[K],x=5*Y,y={x:m/t*o,y:C/t*o},p={x:y.x+(V-i)*o,y:y.y+(z-s)*o},L={x:G-i-b-ei.x+m+.5,y:Z-s-E-ei.y+C+.5},w=(i!==V||s!==z)&&ea?Math.atan2(-ea.y,-ea.x):0;ep(f,y.x,y.y,g,0,w),eC(h,p.x,p.y,g,x),eL(),ew(x);let v=null==er?void 0:er.map(e=>{let[t,n]=[e.x+L.x,e.y+L.y];return{x:t*o,y:n*o}});if(v.length<=1)return;h.beginPath(),h.strokeStyle=g,h.lineWidth=o/10,h.lineJoin=h.lineCap="round",h.miterLimit=2;let _=.15*o;h.moveTo(v[0].x,v[0].y);for(let e=1;e<v.length-1;e++){let[t,n,r]=[...v.slice(e-1,e+2)],[o,i]=[n.x-t.x,n.y-t.y],[l,a]=[r.x-n.x,r.y-n.y],[s,c]=[Math.hypot(o,i),Math.hypot(l,a)],u=o*a-i*l,d=(o*l+i*a)/(s*c);if(1e-6>Math.abs(u)||d>.995)h.lineTo(n.x,n.y);else{let e=Math.min(_,.5*Math.min(s,c));h.arcTo(n.x,n.y,r.x,r.y,e)}}let[k,S]=[...v.slice(-2)],[T,M]=[(S.x+k.x)/2,(S.y+k.y)/2],O=Math.PI+Math.atan2(S.y-k.y,S.x-k.x);h.lineTo(T,M),ep(h,T-o/2,M-o/2,g,0,O,.6),h.stroke()};return(0,l.useLayoutEffect)(()=>{if(!et&&n.length>0)return;let e=async()=>{try{let e=new FontFace("LOTTERIACHAB","url('https://fastly.jsdelivr.net/gh/projectnoonnu/noonfonts_2302@1.0/LOTTERIACHAB.woff2') format('woff2')");await e.load(),document.fonts.add(e)}catch(e){console.warn("Font loading failed, using fallback font")}},t=T(O);eu({cursor:t,stun:M(I),flag:{flag:T(D[0]),pole:T(D[1])},boom:{inner:T(S[0]),outer:T(S[1])}}),en(!1),e()},[n,et]),(0,l.useEffect)(()=>{et||eE()},[i,s,d,V,z,K,Q]),(0,r.jsxs)(r.Fragment,{children:[et&&(0,r.jsxs)("div",{className:h().loading,children:[(0,r.jsx)("h1",{children:"Assets Loading..."}),(0,r.jsx)("div",{className:"".concat(n.length<1?h().loadingBar:h().loadComplete)})]}),!et&&(0,r.jsxs)("div",{className:"".concat(h().canvasContainer," ").concat(y>0?h().vibration:""),children:[(0,r.jsx)(v,{}),(0,r.jsx)(j,{className:h().canvas,tilePadHeight:E,tilePadWidth:b,tileSize:o,tiles:n}),(0,r.jsx)("canvas",{className:h().canvas,id:"OtherCursors",ref:ee.otherCursorsRef,width:U,height:B}),(0,r.jsx)("canvas",{className:h().canvas,id:"OtherPointer",ref:ee.otherPointerRef,width:U,height:B}),(0,r.jsx)("canvas",{className:h().canvas,id:"MyCursor",ref:ee.myCursorRef,width:U,height:B}),(0,r.jsx)("canvas",{className:h().canvas,id:"InteractionCanvas",ref:ee.interactionCanvasRef,width:U,height:B,onPointerDown:e=>{var t,r;let i=ee.interactionCanvasRef.current;if(!i)return;let{left:l,top:a}=i.getBoundingClientRect(),[s,c]=[e.clientX-l,e.clientY-a],[u,h]=[s/o+b>>>0,c/o+E>>>0],[f,g]=[Math.round(u+d.x),Math.round(h+d.y)],x=null!==(r=null===(t=n[h])||void 0===t?void 0:t[u])&&void 0!==r?r:"Out of bounds";W(f,g,x);let y=2===e.buttons?R.SPECIAL_CLICK:R.GENERAL_CLICK;if(q.current&&ed(),ex(f,g,y),y===R.SPECIAL_CLICK&&!x.includes(p.CLOSED))return;let{x:m,y:L}=em(u,h);ey(f,g)&&([m,L]=[u,h]),eg(m,L,f,g,y)}})]})]})},I=n(2723),B=n.n(I);function U(e){let{time:t}=e;return(0,r.jsxs)("div",{className:B().inactive,children:[(0,r.jsxs)("div",{className:B().alert,children:[(0,r.jsx)("p",{children:"You`re stunned!"}),(0,r.jsx)("p",{children:"Try Again After"}),(0,r.jsxs)("p",{children:[t/60>>>0,":",(t%60).toString().padStart(2,"0")]})]}),(0,r.jsx)("div",{className:B().ad,children:"광고 받습니다: kkh061101@naver.com"})]})}var W=n(6324),V=n.n(W);function z(){return(0,r.jsx)("svg",{width:"22",height:"26",viewBox:"0 0 22 26",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,r.jsx)("path",{d:"M0.436226 1.88654C0.321855 0.917668 1.42232 0.282312 2.2042 0.865797L20.8289 14.7645C21.6738 15.3951 21.2476 16.7379 20.1937 16.7657L12.1637 16.978C11.0359 17.0078 9.99976 17.606 9.41006 18.5678L5.21123 25.4159C4.66013 26.3147 3.28415 26.0124 3.16055 24.9653L0.436226 1.88654Z",fill:"white"})})}function H(){return(0,r.jsx)("svg",{width:"24",height:"14",viewBox:"0 0 24 14",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,r.jsx)("path",{d:"M2 2L11.5286 11.5286C11.7889 11.7889 12.2111 11.7889 12.4714 11.5286L22 2",stroke:"white",strokeWidth:"4",strokeLinecap:"round"})})}function G(){return(0,r.jsxs)("svg",{width:"32",height:"32",viewBox:"0 0 32 32",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,r.jsx)("path",{d:"M20 5L26 5C26.5523 5 27 5.44772 27 6L27 12",stroke:"white",strokeWidth:"4",strokeLinecap:"round"}),(0,r.jsx)("path",{d:"M12 27L6 27C5.44772 27 5 26.5523 5 26L5 20",stroke:"white",strokeWidth:"4",strokeLinecap:"round"}),(0,r.jsx)("path",{d:"M5 12L5 6C5 5.44772 5.44772 5 6 5L12 5",stroke:"white",strokeWidth:"4",strokeLinecap:"round"}),(0,r.jsx)("path",{d:"M27 20L27 26C27 26.5523 26.5523 27 26 27L20 27",stroke:"white",strokeWidth:"4",strokeLinecap:"round"})]})}function Z(){return(0,r.jsxs)("svg",{width:"32",height:"32",viewBox:"0 0 32 32",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,r.jsx)("circle",{cx:"14",cy:"14",r:"9",stroke:"white",strokeWidth:"4"}),(0,r.jsx)("path",{d:"M27 27L21.5 21.5",stroke:"white",strokeWidth:"4",strokeLinecap:"round"})]})}function Y(){return(0,r.jsx)("svg",{width:"24",height:"14",viewBox:"0 0 24 14",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,r.jsx)("path",{d:"M2 12L11.5286 2.4714C11.7889 2.21105 12.2111 2.21106 12.4714 2.4714L22 12",stroke:"white",strokeWidth:"4",strokeLinecap:"round"})})}function K(e){let{tileSize:t,renderRange:n,maxTileCount:o}=e,{zoom:i,zoomDown:s,zoomUp:u,originX:d,originY:h}=c(),{windowWidth:f,windowHeight:x}=(0,a.Z)(),{x:y,y:m}=g(),p=()=>f*n/(t/1.5)+x*n/(t/1.5)>o,[L,C]=(0,l.useState)(!0);return(0,r.jsx)("div",{className:V().dashboard,children:(0,r.jsxs)("div",{className:V().bottom,children:[(0,r.jsxs)("div",{className:V().toggle,onPointerDown:()=>C(!L),children:[!L&&(0,r.jsx)(H,{}),L&&(0,r.jsx)(Y,{})]}),L&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:V().coordinates,children:[(0,r.jsxs)("p",{children:["\xa0",(0,r.jsx)(z,{}),"(",d,", ",h,")"]}),(0,r.jsxs)("p",{children:[(0,r.jsx)(G,{}),"\xa0(",y===1/0?"":y,", ",m===1/0?"":m,")"]})]}),(0,r.jsxs)("div",{className:V().zoom,children:[(0,r.jsxs)("p",{children:[(0,r.jsx)(Z,{}),"\xa0",Math.ceil(100*i),"%"]}),(0,r.jsxs)("div",{className:V().buttons,children:[(0,r.jsx)("button",{onPointerDown:()=>!p()&&s(),children:"-"}),(0,r.jsx)("button",{onPointerDown:u,children:"+"})]})]})]})]})})}var J=n(1071),X=n.n(J),Q=n(3145),$=JSON.parse('{"a":[{"id":1,"gif":"/mainvideos/moving.gif","description":{"en":"Click Open Tile to move cursor","ko":"열린 타일을 클릭하여 커서를 이동하세요"}},{"id":2,"gif":"/mainvideos/block.gif","description":{"en":"If the path to the tile you clicked is blocked, you cannot move.","ko":"클릭한 타일로 가는 길이 막혀있을 경우 이동이 되지 않습니다."}},{"id":3,"gif":"/mainvideos/zoom.gif","description":{"en":"Click - and + buttons to zoom in and out","ko":"확대 및 축소 버튼을 클릭하여 확대 및 축소하세요"}},{"id":4,"gif":"/mainvideos/open_tile.gif","description":{"en":"Click left mouse button on closed tile to open tile","ko":"닫힌 타일에 왼쪽 마우스 버튼을 클릭하여 타일을 엽니다"}},{"id":5,"gif":"/mainvideos/flag.gif","description":{"en":"Click right mouse button on open tile to flag tile","ko":"열린 타일에 오른쪽 마우스 버튼을 클릭하여 타일을 깃발로 표시하세요"}},{"id":6,"gif":"/mainvideos/mine.gif","description":{"en":"If the tile you clicked is a mine, you get a stun for 3 minutes","ko":"클릭한 타일이 지뢰인 경우 3분간 스턴을 받습니다"}},{"id":7,"gif":"/mainvideos/chat.gif","description":{"en":"If you click on a tile that is not a mine, the number of mines around the tile will be displayed","ko":"엔터 버튼을 누를 경우 채팅이 활성화 되며, 끄려면 ESC를 누르세요. 입력하고 엔터를 다시 누를 경우 채팅이 전송됩니다."}}]}'),q=n(9376);function ee(){return(0,r.jsxs)("svg",{width:"120",height:"120",viewBox:"0 0 120 120",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,r.jsx)("path",{d:"M25 55L58.2322 21.7678C59.2085 20.7915 60.7915 20.7915 61.7678 21.7678L95 55",stroke:"white",strokeWidth:"10",strokeLinecap:"round"}),(0,r.jsx)("path",{d:"M25 90L58.2322 56.7678C59.2085 55.7915 60.7915 55.7915 61.7678 56.7678L95 90",stroke:"white",strokeWidth:"10",strokeLinecap:"round"})]})}function et(){return(0,r.jsxs)("svg",{width:"120",height:"120",viewBox:"0 0 120 120",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,r.jsx)("path",{d:"M25 65L58.2322 98.2322C59.2085 99.2085 60.7915 99.2085 61.7678 98.2322L95 65",stroke:"white",strokeWidth:"10",strokeLinecap:"round"}),(0,r.jsx)("path",{d:"M25 30L58.2322 63.2322C59.2085 64.2085 60.7915 64.2085 61.7678 63.2322L95 30",stroke:"white",strokeWidth:"10",strokeLinecap:"round"})]})}function en(){let e="https://gamultong.github.io/gamulpung-client",t=(0,q.useSearchParams)().get("lang")||"ko",[n,o]=(0,l.useState)(-1),i=$.a[n];return(0,l.useEffect)(()=>{"done"!==localStorage.getItem("tutorial")&&o(0)},[]),(0,r.jsx)(r.Fragment,{children:-1!==n&&(0,r.jsxs)("div",{className:X().tutorial,children:[(0,r.jsx)("div",{className:X().button,onClick:()=>o(n>0?n-1:n),children:n>0&&(0,r.jsx)(ee,{})}),(0,r.jsxs)("div",{className:X().step,children:[(0,r.jsx)(Q.default,{src:"".concat(e).concat(i.gif),alt:i.gif,width:400,height:225}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("p",{children:["Step ",i.id]}),(0,r.jsx)("p",{children:i.description[t]})]})]}),(0,r.jsx)("div",{className:X().button,onClick:()=>{n<$.a.length-1?o(n+1):(o(-1),localStorage.setItem("tutorial","done"))},children:$.a.length-1>n?(0,r.jsx)(et,{}):(0,r.jsx)(Q.default,{src:"".concat(e,"/icon.png"),alt:"Play",width:88,height:88})})]})})}var er=n(1871),eo=n.n(er),ei=()=>(0,r.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,r.jsx)("path",{d:"M3.75 17.25H20.25V18.75C20.25 19.5784 19.5784 20.25 18.75 20.25H5.25C4.42157 20.25 3.75 19.5784 3.75 18.75V17.25Z",fill:"#FFB743"}),(0,r.jsx)("path",{d:"M20.25 15.75H3.75L2.48723 6.91058C2.39554 6.2688 3.1063 5.82087 3.64571 6.18047L7.875 9L11.36 3.29721C11.6525 2.81866 12.3475 2.81866 12.64 3.29721L16.125 9L20.3543 6.18048C20.8937 5.82087 21.6045 6.2688 21.5128 6.91058L20.25 15.75Z",fill:"#FFB743"})]});let el=(0,s.U)(e=>({rankings:[{ranking:1,score:12345},{ranking:2,score:12345},{ranking:3,score:12345},{ranking:4,score:12345},{ranking:5,score:12345},{ranking:6,score:12345},{ranking:7,score:12345},{ranking:8,score:12345},{ranking:9,score:12345},{ranking:10,score:12345}],setRanking:t=>e({rankings:t})}));function ea(){let{rankings:e}=el(),[t,n]=(0,l.useState)(!0);return(0,r.jsxs)("div",{className:eo().scoreboard,children:[(0,r.jsxs)("div",{className:eo().toggle,onPointerDown:()=>n(!t),children:[(0,r.jsx)("span",{children:"RANKING"}),t?(0,r.jsx)(H,{}):(0,r.jsx)(Y,{})]}),t&&(0,r.jsx)("div",{className:eo().scoreList,children:e.map((e,t)=>(0,r.jsxs)("div",{className:eo().scoreItem,children:[(0,r.jsxs)("span",{children:["#",e.ranking," ",1===e.ranking&&(0,r.jsx)(ei,{})]}),(0,r.jsx)("span",{children:e.score})]},t))})]})}(0,s.U)(e=>({ranking:0,score:0,setRanking:t=>e({ranking:t.ranking,score:t.score})}));let es=[["F00","F01"],["F10","F11"],["F20","F21"],["F30","F31"]],ec=["O","1","2","3","4","5","6","7"],eu=Array(256),ed=Array(256),eh=Array(256);function ef(){let e="".concat("wss://a4ed-152-67-203-244.ngrok-free.app","/session"),{setPosition:t}=g(),{setCursors:n,addCursors:o,cursors:s}=u(),{isOpen:d,message:h,sendMessage:f,connect:y,disconnect:m}=x(),{x:p,y:v,zoom:b,originX:E,originY:_}=c(),{setColor:k,setPosition:S,setOringinPosition:T,setId:M}=c(),{zoomUp:O,zoomDown:j,setZoom:F}=c(),{windowWidth:A,windowHeight:N}=(0,a.Z)(),[R,P]=(0,l.useState)(0),[I,B]=(0,l.useState)({x:0,y:0}),[W,V]=(0,l.useState)({x:0,y:0}),[z,H]=(0,l.useState)({x:0,y:0}),[G,Z]=(0,l.useState)([]),[Y,J]=(0,l.useState)([...G.map(e=>[...e])]),[X,Q]=(0,l.useState)(-1),[$,q]=(0,l.useState)(!1),ee=(0,l.useRef)(0),et=globalThis._tileWorkerRef||{current:null},er=globalThis._tileWorkerInit||{current:!1},eo=globalThis._tileWorkerGen||{current:0};globalThis._tileWorkerRef=et,globalThis._tileWorkerInit=er,globalThis._tileWorkerGen=eo;let ei=(e,t,n,r,o)=>{if(!d||!$)return;let i=performance.now();if(o===w.ALL&&i-ee.current<.3)return;ee.current=i;let[l,a]=[Math.abs(n-e)+1,Math.abs(t-r)+1];Z(e=>{let t=[...e];switch(o){case w.UP:t=[...Array.from({length:a},()=>Array(l).fill("??")),...t.slice(0,-a)];break;case w.DOWN:t=[...t.slice(a),...Array.from({length:a},()=>Array(l).fill("??"))];break;case w.LEFT:for(let e=0;e<a;e++)t[e]=[...Array(l).fill("??"),...t[e].slice(0,t[0].length-l)];break;case w.RIGHT:for(let e=0;e<a;e++)t[e]=[...t[e].slice(l),...Array(l).fill("??")];break;case w.ALL:t=Array.from({length:a},()=>Array.from({length:l},()=>"??"))}return t}),f(JSON.stringify({event:L.FETCH_TILES,payload:{start_p:{x:e,y:t},end_p:{x:n,y:r}}}))},el=e=>{switch(e.key.toLowerCase()){case"-":e.preventDefault(),j();break;case"=":e.preventDefault(),O()}};(0,l.useLayoutEffect)(()=>(document.documentElement.style.overflow="hidden",q(!1),F(1),document.addEventListener("keydown",el),()=>{document.documentElement.style.overflow="auto",document.removeEventListener("keydown",el),m()}),[]),(0,l.useLayoutEffect)(()=>{if(!d&&I.x!==W.x&&W.y!==I.y){Q(-1);let[t,n]=[W.x-I.x+1,W.y-I.y+1];y(e+"?view_width=".concat(t,"&view_height=").concat(n))}},[d,I,W]);let es=(e,t,n)=>{if(e.length<2)return"";let r=parseInt(e.slice(0,2),16),o=7&r;return(128&r)!=0?(64&r)!=0?"B":0===o?"O":"".concat(o):(32&r)!=0?"F"+((24&r)>>3)+(t+n)%2:"C"+(t+n)%2},ec=(e,t,n,r,o,i)=>{if(0===o.length)return;let l=Math.abs(e-n+1)<<1,a=l>>1,s=Math.abs(r-t+1),c=G,u=!1,d="All"===i?v<t?W.y-I.y-s+1:0:t-I.y,h=n-I.x,f=function(){if(et.current)return et.current;try{let e=new Blob(["\n        // LUTs will be injected from the main thread to avoid recomputation\n        let OPEN_LUT = null;      // (string|null)[]\n        let CLOSED0_LUT = null;   // string[]\n        let CLOSED1_LUT = null;   // string[]\n\n        // Optional fallback precompute if INIT not received\n        function ensureLocalLUTs() {\n          if (OPEN_LUT && CLOSED0_LUT && CLOSED1_LUT) return;\n          const FLAG_LOOKUP = [['F00','F01'],['F10','F11'],['F20','F21'],['F30','F31']];\n          const OPEN_NUM_LOOKUP = ['O','1','2','3','4','5','6','7'];\n          OPEN_LUT = new Array(256);\n          CLOSED0_LUT = new Array(256);\n          CLOSED1_LUT = new Array(256);\n          for (let byteValue = 0; byteValue < 256; byteValue++) {\n            const isOpened = (byteValue & 0x80) !== 0;\n            const isMine = (byteValue & 0x40) !== 0;\n            const isFlag = (byteValue & 0x20) !== 0;\n            const color = (byteValue & 0x18) >> 3;\n            const number = byteValue & 0x07;\n            if (isOpened) {\n              OPEN_LUT[byteValue] = isMine ? 'B' : OPEN_NUM_LOOKUP[number];\n              CLOSED0_LUT[byteValue] = 'C0';\n              CLOSED1_LUT[byteValue] = 'C1';\n            } else if (isFlag) {\n              OPEN_LUT[byteValue] = null;\n              const flagPair = FLAG_LOOKUP[color];\n              CLOSED0_LUT[byteValue] = flagPair[0];\n              CLOSED1_LUT[byteValue] = flagPair[1];\n            } else {\n              OPEN_LUT[byteValue] = null;\n              CLOSED0_LUT[byteValue] = 'C0';\n              CLOSED1_LUT[byteValue] = 'C1';\n            }\n          }\n        }\n\n        // Worker message handler\n        onmessage = (e) => {\n          const msg = e.data && e.data.msg;\n          if (msg === 'INIT') {\n            OPEN_LUT = e.data.OPEN;\n            CLOSED0_LUT = e.data.CL0;\n            CLOSED1_LUT = e.data.CL1;\n            return;\n          }\n\n          const { id, hex, start_x, end_y, xOffset, yOffset, rowlengthBytes, tilesPerRow, columnlength, widthHint } = e.data;\n          ensureLocalLUTs();\n          const rows = [];\n          for (let i = 0; i < columnlength; i++) {\n            const reversedI = columnlength - 1 - i;\n            const rowIndex = reversedI + yOffset;\n            const yAbs = end_y - reversedI;\n            const rowParityBase = (start_x + yAbs) & 1;\n\n            // Horizontal clipping with hint\n            let tStart = 0;\n            if (xOffset < 0) tStart = -xOffset;\n            let tEnd = tilesPerRow;\n            const maxVisible = widthHint - xOffset; // widthHint may be row length\n            if (tEnd > maxVisible) tEnd = maxVisible;\n            if (tStart >= tEnd) continue;\n\n            let p = i * rowlengthBytes + (tStart << 1);\n            let checker = rowParityBase ^ (tStart & 1);\n            const values = new Array(tEnd - tStart);\n            let idx = 0;\n            let t = tStart;\n\n            while (t < tEnd) {\n              // Tile A\n              let c0 = hex.charCodeAt(p), c1 = hex.charCodeAt(p + 1);\n              let n0 = c0 <= 57 ? c0 - 48 : c0 <= 70 ? c0 - 55 : c0 - 87;\n              let n1 = c1 <= 57 ? c1 - 48 : c1 <= 70 ? c1 - 55 : c1 - 87;\n              let byteValue = (n0 << 4) | n1; p += 2;\n              let opened = OPEN_LUT[byteValue];\n              values[idx++] = opened !== null ? opened : (checker === 0 ? CLOSED0_LUT[byteValue] : CLOSED1_LUT[byteValue]);\n              checker ^= 1; t++;\n              if (t >= tEnd) break;\n\n              // Tile B (unrolled)\n              c0 = hex.charCodeAt(p); c1 = hex.charCodeAt(p + 1);\n              n0 = c0 <= 57 ? c0 - 48 : c0 <= 70 ? c0 - 55 : c0 - 87;\n              n1 = c1 <= 57 ? c1 - 48 : c1 <= 70 ? c1 - 55 : c1 - 87;\n              byteValue = (n0 << 4) | n1; p += 2;\n              opened = OPEN_LUT[byteValue];\n              values[idx++] = opened !== null ? opened : (checker === 0 ? CLOSED0_LUT[byteValue] : CLOSED1_LUT[byteValue]);\n              checker ^= 1; t++;\n            }\n            rows.push({ rowIndex, tStart, values, xOffset });\n          }\n          postMessage({ id, rows });\n        };\n      "],{type:"application/javascript"}),t=URL.createObjectURL(e);et.current=new Worker(t);try{er.current||(et.current.postMessage({msg:"INIT",OPEN:eu,CL0:ed,CL1:eh}),er.current=!0)}catch(e){}return et.current}catch(e){return null}}(),g=s*a;if(f&&g>2e4){var x;let e=(null===(x=c[0])||void 0===x?void 0:x.length)||a,r={id:++eo.current,hex:o,start_x:n,end_y:t,startPointY:I.y,endPointY:W.y,xOffset:h,yOffset:d,rowlengthBytes:l,tilesPerRow:a,columnlength:s,widthHint:e};f.postMessage(r),f.onmessage=e=>{let{id:t,rows:n}=e.data;if(t!==eo.current)return;let r=G,o=!1,i=!1;for(let e of n){let t=r[e.rowIndex]||[],n=t,l=!1,a=e.tStart+h,s=a+e.values.length;if(a<0||s<=0)continue;i||(r=[...r],i=!0),n.length<s&&((n=t.slice()).length=s,l=!0,r[e.rowIndex]=n);let c=a;for(let i=0;i<e.values.length;i++,c++){let a=e.values[i];n[c]!==a&&(l||(n=t.slice(),r[e.rowIndex]=n,l=!0),n[c]=a,o=!0)}}i&&o&&Z(r)};return}let y=!1;for(let e=0;e<s;e++){let r=s-1-e,i=r+d;if(i<0||i>=c.length)continue;let f=c[i]||[],g=f,x=!1,m=f.length;if(0===m)continue;let p=n+(t-r)&1,L=0;h<0&&(L=-h);let C=a,w=m-h;if(C>w&&(C=w),L>=C)continue;let v=e*l+(L<<1),b=p^1&L,E=L;for(;E<C;){let e=o.charCodeAt(v),t=o.charCodeAt(v+1),n=e<=57?e-48:e<=70?e-55:e-87,r=t<=57?t-48:t<=70?t-55:t-87,l=n<<4|r;v+=2;let a=E+h,s=eu[l],d=null!==s?s:0===b?ed[l]:eh[l];if(u||(c=[...c],u=!0),x||(g=f.slice(),c[i]=g,x=!0),g[a]!==d&&(g[a]=d,y=!0),b^=1,++E>=C)break;e=o.charCodeAt(v),t=o.charCodeAt(v+1),l=(n=e<=57?e-48:e<=70?e-55:e-87)<<4|(r=t<=57?t-48:t<=70?t-55:t-87),v+=2,a=E+h,d=null!==(s=eu[l])?s:0===b?ed[l]:eh[l],g[a]!==d&&(g[a]=d,y=!0),b^=1,E++}}u&&y&&Z(c)};(0,l.useLayoutEffect)(()=>{if(!h)return;let{MY_CURSOR:e,YOU_DIED:r,MOVED:i,ERROR:l}=C,{POINTER_SET:a,CURSORS:c,CURSORS_DIED:u,CURSOR_QUIT:d,CHAT:f}=C,{TILES:g,FLAG_SET:x,SINGLE_TILE_OPENED:y,TILES_OPENED:m}=C;try{var p,L,w;let{event:C,payload:v}=JSON.parse(h);switch(C){case g:{let{tiles:e,start_p:t,end_p:n}=v,{x:r,y:o}=t,{x:i,y:l}=n;ec(i,l,r,o,e,"All");break}case x:{let{position:e,is_set:t,color:n}=v,{x:r,y:o}=e,i=[...G],l="number"==typeof n?n:null!==(p=({RED:0,YELLOW:1,BLUE:2,PURPLE:3})[n])&&void 0!==p?p:0,a=(r+o&1).toString();i[o-I.y][r-I.x]=t?"F".concat(l).concat(a):"C".concat(a),Z(i);break}case a:{let{id:e,pointer:t}=v,r=s.map(n=>e===n.id?{...n,pointer:t}:n);n(r);break}case y:{let{position:e,tile:t}=v;if(!e||!t)return;let{x:n,y:r}=e,o=[...G];o[r-I.y][n-I.x]=es(t,n,r),Z(o);break}case m:{let{tiles:e,start_p:t,end_p:n}=v,{x:r,y:o}=t,{x:i,y:l}=n;ec(i,l,r,o,e,"PART");break}case e:{let{position:e,pointer:n,color:r,id:o}=v;M(o),T(e.x,e.y),S(e.x,e.y),k(r.toLowerCase()),n&&t(n.x,n.y,""),setTimeout(()=>q(!0),0);break}case r:{let{revive_at:e}=v,t=(((L=new Date(e),void 0===L)?void 0:L.getTime())-Date.now())/1e3>>>0;Q(t);break}case c:{let{cursors:e}=v,t=e.map(e=>{let{position:{x:t,y:n},color:r,id:o,pointer:i}=e;return{id:o,pointer:i,x:t,y:n,color:r.toLowerCase()}});o(t);break}case u:{let{cursors:e,revive_at:t}=v,r=(w=new Date(t),void 0===w)?void 0:w.getTime(),o=s.map(t=>{for(let n of e)if(t.id===n.id)return{...t,revive_at:r};return t});n(o);break}case i:{let{id:e,new_position:t}=v,{x:r,y:o}=t,i=s.map(t=>e===t.id?{...t,x:r,y:o}:t);n(i);break}case d:{let{id:e}=v,t=[...s],r=t.findIndex(t=>t.id===e);-1!==r&&t.splice(r,1),n(t);break}case f:{let{cursor_id:e,message:t}=v,r=s.map(n=>n.id!==e?n:{...n,message:t,messageTime:Date.now()+8e3});n(r);break}case l:{let{msg:e}=v;console.error(e)}}}catch(e){console.error(e)}},[h]);let ef=(0,l.useMemo)(()=>{let e=G.length;if(0===e)return[];let t=E-p,n=_-v,r=z.x,o=z.y;return 0===t&&0===n?G:G.map((i,l)=>{let a=l+n;if(a<0||a>=e)return Array(i.length).fill("??");let s=G[a];return s?i.map((e,n)=>{let i=n+t;if(i<0||i>=s.length)return"??";let a=s[i];if(!a||"??"===a)return"??";let c=a[0];if("C"!==c&&"F"!==c)return a;let u=r+n+(o+l)&1;if("C"===c)return u?"C1":"C0";if("F"===c){let e=a[1]||"0";return u?"F".concat(e,"1"):"F".concat(e,"0")}return a}):Array(i.length).fill("??")})},[G,E,_,p,v,z]);return(0,l.useLayoutEffect)(()=>{J(ef)},[ef]),(0,l.useLayoutEffect)(()=>{let e=80*b,[t,n]=[1.5*A/e/2>>>0,1.5*N/e/2>>>0];n<1||t<1||(B({x:p-t,y:v-n}),V({x:p+t,y:v+n}),H({x:E-t,y:_-n}),P(e))},[A,N,b,E,_,p,v,$]),(0,l.useLayoutEffect)(()=>{if(!$)return;let e=80*b,t=1.5*A/e>>>0,n=1.5*N/e>>>0,[r,o]=[t/2>>>0,n/2>>>0],[i,l]=[0,0];t>W.x-I.x+1||n>W.y-I.y+1?(i=o-(W.y-I.y)/2>>>0,l=Math.round(r-(W.x-I.x)/2)):(i=-Math.round((W.y-I.y-n)/2),l=-Math.round((W.x-I.x-t)/2)),ei(I.x-l,W.y+i,W.x+l,I.y-i,w.ALL);let a=1.5*A/e>>>0,s=1.5*N/e>>>0;f(JSON.stringify({event:L.SET_VIEW_SIZE,payload:{width:a,height:s}}))},[A,N,b,$]),(0,l.useEffect)(()=>{let[e,t]=[p-E,v-_],[n,r]=[e<0,e>0],[o,i]=[t<0,t>0],{upfrom:l,upto:a,downfrom:s,downto:c,leftfrom:u,leftto:d,rightfrom:h,rightto:f}={upfrom:I.y-1,upto:I.y+t,downfrom:W.y+t,downto:W.y+1,leftfrom:I.x+e,leftto:I.x-1,rightfrom:W.x+1,rightto:W.x+e};r&&i?(ei(h,s,f,a,w.RIGHT),ei(u,s,f,c,w.DOWN)):n&&i?(ei(u,s,d,a,w.LEFT),ei(u,s,f,c,w.DOWN)):r&&o?(ei(h,s,f,a,w.RIGHT),ei(u,l,f,a,w.UP)):n&&o?(ei(u,s,d,a,w.LEFT),ei(u,l,f,a,w.UP)):r?ei(h,W.y,f,I.y,w.RIGHT):n?ei(u,W.y,d,I.y,w.LEFT):i?ei(I.x,s,W.x,c,w.DOWN):o&&ei(I.x,l,W.x,a,w.UP)},[p,v]),(0,l.useEffect)(()=>{$&&f(JSON.stringify({event:L.MOVING,payload:{position:{x:E,y:_}}}))},[E,_]),(0,l.useEffect)(()=>{setTimeout(()=>Q(e=>e>0?e-1:e),1e3)},[X]),(0,r.jsxs)("div",{className:i().page,children:[X>0&&(0,r.jsx)(U,{time:X}),(0,r.jsx)(en,{}),(0,r.jsx)(ea,{}),(0,r.jsx)(K,{tileSize:R,renderRange:1.5,maxTileCount:530}),(0,r.jsx)(D,{leftReviveTime:X,paddingTiles:1.5,tiles:Y,tileSize:R,startPoint:z,cursorOriginX:E,cursorOriginY:_})]})}(()=>{for(let e=0;e<256;e++){let t=(128&e)!=0,n=(64&e)!=0,r=(32&e)!=0,o=(24&e)>>3,i=7&e;if(t)eu[e]=n?"B":ec[i],ed[e]="C0",eh[e]="C1";else if(r){eu[e]=null;let t=es[o];ed[e]=t[0],eh[e]=t[1]}else eu[e]=null,ed[e]="C0",eh[e]="C1"}})()},8144:function(e,t,n){"use strict";n.d(t,{Z:function(){return o}});var r=n(2265);function o(){let[e,t]=(0,r.useState)({windowWidth:0,windowHeight:0});return(0,r.useEffect)(()=>{let e=()=>{t({windowWidth:1.1*window.innerWidth,windowHeight:1.1*window.innerHeight})};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),e}},7397:function(e){e.exports={page:"page_page__9CbJ0"}},6507:function(e){e.exports={loading:"style_loading__42LVe",loadingBar:"style_loadingBar__AtBJr",loadingAnimation:"style_loadingAnimation__ScSQQ",loadComplete:"style_loadComplete__SRD5Z",canvasContainer:"style_canvasContainer__nKMjH",canvas:"style_canvas__m8mJO",vibration:"style_vibration__6_Fiw"}},6324:function(e){e.exports={dashboard:"style_dashboard__nDsof",bottom:"style_bottom___8aLI",coordinates:"style_coordinates__3RzzR",toggle:"style_toggle__R68Vw",zoom:"style_zoom__EWfUf",buttons:"style_buttons__zf0nF"}},2698:function(e){e.exports={chat:"style_chat__ZTXhD",message:"style_message__uEVba"}},2723:function(e){e.exports={inactive:"style_inactive__B_gRa",fade:"style_fade__sZevv",alert:"style_alert__pv_lG",ad:"style_ad__2DN3O"}},1871:function(e){e.exports={scoreboard:"style_scoreboard__Th1NE",scoreList:"style_scoreList__P4ewN",scoreItem:"style_scoreItem__lRMtn",toggle:"style_toggle__axVEQ"}},1071:function(e){e.exports={tutorial:"style_tutorial__75p5w",step:"style_step__kswJY",fade:"style_fade__KaBU4",button:"style_button__rjKit"}}},function(e){e.O(0,[118,145,214,971,117,744],function(){return e(e.s=6124)}),_N_E=e.O()}]);