(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{6124:function(e,t,n){Promise.resolve().then(n.bind(n,9136))},9136:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return e5}});var r=n(7437),i=n(7397),l=n.n(i),o=n(2265);function s(){let[e,t]=(0,o.useState)({windowWidth:0,windowHeight:0});return(0,o.useEffect)(()=>{let e=()=>{t({windowWidth:1.1*window.innerWidth,windowHeight:1.1*window.innerHeight})};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),e}var a=n(3011);let c=(0,a.U)(e=>({x:1/0,y:1/0,content:0,movecost:0,setMovecost:t=>e({movecost:t}),setPosition:(t,n,r)=>e({x:t,y:n,content:r})})),u=(0,a.U)(e=>({useAnimation:!0,setAnimation:t=>e({useAnimation:t})})),h={CHAT:"CHAT",MOVE:"MOVE",OPEN_TILES:"OPEN-TILES",SET_FLAG:"SET-FLAG",SET_WINDOW:"SET-WINDOW",CREATE_CURSOR:"CREATE-CURSOR",DISMANTLE_MINE:"DISMANTLE-MINE",INSTALL_BOMB:"INSTALL-BOMB"},d={CHAT:"CHAT",CURSORS_STATE:"CURSORS-STATE",EXPLOSION:"EXPLOSION",MY_CURSOR:"MY-CURSOR",QUIT_CURSOR:"QUIT-CURSOR",SCOREBOARD_STATE:"SCOREBOARD-STATE",TILES_STATE:"TILES-STATE"},f={RIGHT:"R",LEFT:"L",UP:"U",DOWN:"D",ALL:"A",UP_RIGHT:"UR",DOWN_RIGHT:"DR",UP_LEFT:"UL",DOWN_LEFT:"DL"},g=[["F00","F01"],["F10","F11"],["F20","F21"],["F30","F31"]],x=["O","1","2","3","4","5","6","7"],m=Array(256),p=Array(256),y=Array(256),w=new Int8Array(128);(()=>{for(let e=0;e<w.length;e++)w[e]=-1;for(let e=48;e<=57;e++)w[e]=e-48;for(let e=65;e<=70;e++)w[e]=e-55;for(let e=97;e<=102;e++)w[e]=e-87})();let C=new Uint8Array(65536);(()=>{for(let e=0;e<65536;e++){let t=e>>8&255,n=255&e,r=t<128?w[t]:-1,i=n<128?w[n]:-1;if(r<0||i<0){C[e]=255;continue}let l=r<<4|i,o=(128&l)!=0,s=(64&l)!=0,a=(32&l)!=0,c=(24&l)>>3,u=7&l;o?C[e]=s?8:u:a?C[e]=16+2*c:C[e]=24}})(),(()=>{for(let e=0;e<256;e++){let t=e>>5,n=(4&t)!=0,r=(2&t)!=0,i=(1&t)!=0,l=(24&e)>>3,o=7&e;if(n)m[e]=r?"B":x[o],p[e]="C0",y[e]="C1";else if(i){m[e]=null;let t=g[l];p[e]=t[0],y[e]=t[1]}else m[e]=null,p[e]="C0",y[e]="C1"}})();let v={BOMB:8,FILL:255},L=e=>e===v.BOMB,b=e=>(254&e)==16,k=e=>e>=32&&e<=39,M=e=>e>=16&&e<=39,_=e=>e<16||e>39,E=e=>1&e,S=e=>e-32>>1,T=e=>16|1&e,j=(e,t)=>32|(3&e)<<1|1&t;class R{get(e,t){return e<0||e>=this.height||t<0||t>=this.width?v.FILL:this.data[e*this.width+t]}set(e,t,n){e>=0&&e<this.height&&t>=0&&t<this.width&&(this.data[e*this.width+t]=n)}clone(){let e=new R(0,0,0);return e.width=this.width,e.height=this.height,e.data=this.data.slice(),e}get isEmpty(){return 0===this.width||0===this.height}static empty(){return new R(0,0,0)}constructor(e,t,n=v.FILL){this.width=e,this.height=t,this.data=new Uint8Array(e*t),0!==n&&this.data.fill(n)}}let P=null,I=null;async function A(){return P||I||(I=(async()=>{let e=await n.e(464).then(n.bind(n,3464));return await e.default(),P=e,e})())}async function N(){await A()}let B=new TextEncoder,F=new Map,O={tiles:R.empty(),renderTiles:R.empty(),startPoint:{x:0,y:0},endPoint:{x:0,y:0},renderStartPoint:{x:0,y:0},tileSize:0},D=(0,a.U)((e,t)=>({...O,setTiles:t=>e({tiles:t}),setRenderTiles:t=>e({renderTiles:t}),setStartPoint:t=>e({startPoint:t}),setEndPoint:t=>e({endPoint:t}),setRenderStartPoint:t=>e({renderStartPoint:t}),setTileSize:t=>e({tileSize:t}),padtiles:(n,r,i,l,o)=>{let{tiles:s}=t(),a=Math.abs(i-n)+1,c=Math.abs(l-r)+1,{UP:u,ALL:h,DOWN:d,LEFT:g,RIGHT:x,DOWN_LEFT:m,DOWN_RIGHT:p,UP_LEFT:y,UP_RIGHT:w}=f;if(o===h){let t=new R(a,c);!function(e,t,n,r,i){for(let l=0;l<i;l++)for(let i=0;i<r;i++){let o=F.get("".concat(e+i,",").concat(t+l));void 0!==o&&(n[l*r+i]=o)}}(Math.min(n,i),Math.min(r,l),t.data,a,c),e({tiles:t});return}let C=s.clone(),{data:L}=C,b=C.width,k=C.height;if((o===u||o===w||o===y)&&(L.copyWithin(b,0,(k-1)*b),L.fill(v.FILL,0,b)),(o===d||o===p||o===m)&&(L.copyWithin(0,b,k*b),L.fill(v.FILL,(k-1)*b,k*b)),o===g||o===m||o===y)for(let e=k-1;e>=0;e--){let t=e*b;L.copyWithin(t+1,t,t+b-1),L[t]=v.FILL}if(o===x||o===p||o===w)for(let e=0;e<k;e++){let t=e*b;L.copyWithin(t,t+1,t+b),L[t+b-1]=v.FILL}console.log("pad after",o,performance.now()),e({tiles:C})},applyTileChanges:n=>{if(n.length<1)return;let{tiles:r}=t(),i=r.clone();for(let{row:e,col:t,value:r}of n)i.set(e,t,r);e({tiles:i})},applyPackedChanges:n=>{if(0===n.length)return;let{tiles:r}=t(),i=r.clone(),l=i.data,o=i.width;for(let e=0;e<n.length;e++){let t=n[e];l[(t>>16&65535)*o+(t>>8&255)]=255&t}e({tiles:i})},reset:()=>e(O),getTile:(e,n)=>{let{tiles:r}=t();return r.get(e,n)}})),W=()=>D(e=>e.tiles),U=()=>D(e=>e.renderTiles),z=()=>D(e=>e.startPoint),H=()=>D(e=>e.endPoint),Z=()=>D(e=>e.renderStartPoint),G=()=>D(e=>e.tileSize),K="".concat("wss://gamulpung-server-prod.kimgh06.com","/session");var V=n(6507),X=n.n(V);let Y=(0,a.U)(e=>({id:"",position:{x:0,y:0},color:"blue",originPosition:{x:0,y:0},zoom:1,score:0,isBombMode:!1,items:{bomb:0},setId:t=>e({id:t}),setColor:t=>e({color:t}),setZoom:t=>e({zoom:t}),setIsBombMode:t=>e({isBombMode:t}),setOriginPosition:t=>e({originPosition:t}),setPosition:t=>e({position:t}),zoomUp:()=>e(e=>({zoom:1.5*e.zoom<1.7?1.5*e.zoom:e.zoom})),zoomDown:()=>e(e=>({zoom:e.zoom/1.5>.15?e.zoom/1.5:e.zoom})),moveUp:()=>e(e=>({position:{x:e.position.x,y:e.position.y-1}})),moveDown:()=>e(e=>({position:{x:e.position.x,y:e.position.y+1}})),moveLeft:()=>e(e=>({position:{x:e.position.x-1,y:e.position.y}})),moveRight:()=>e(e=>({position:{x:e.position.x+1,y:e.position.y}})),setScore:t=>e({score:t}),setItems:t=>e({items:t})})),J=(0,a.U)(e=>({cursors:[],addCursors:t=>e(e=>({cursors:[...e.cursors,...t]})),removeCursor:t=>e(e=>({cursors:e.cursors.filter(e=>e!==t)})),setCursors:t=>e({cursors:t})})),Q=(0,a.U)(e=>({socket:null,message:"",binaryMessage:null,isOpen:!1,connect:t=>{let n=new WebSocket(t);n.binaryType="arraybuffer",n.onopen=()=>{console.info("connect: WebSocket is opened"),e({socket:n,isOpen:!0})},n.onclose=()=>{console.info("server closed: WebSocket is closed"),e({socket:null,isOpen:!1})},n.onmessage=t=>{t.data instanceof ArrayBuffer?e({binaryMessage:t.data}):e({message:t.data})}},disconnect:()=>{let{socket:t}=Q.getState();null==t||t.close(),e({socket:null,isOpen:!1}),console.info("disconnect: WebSocket is closed")},sendMessage:(e,t)=>{let{socket:n,isOpen:r}=Q.getState();r&&n?n.send(JSON.stringify({header:{event:e},payload:t})):console.error("send: WebSocket is closed")}}));var q=n(2698),$=n.n(q);function ee(){let[e,t]=(0,o.useState)(""),[n,i]=(0,o.useState)(0),[l,a]=(0,o.useState)(0),[c,u]=(0,o.useState)(Date.now()),{sendMessage:d}=Q(),{color:f,originPosition:g,zoom:x}=Y(),{cursors:m}=J(),{windowHeight:p,windowWidth:y}=s(),w=(0,o.useRef)(null),C=(0,o.useRef)(null),v=e=>e?e-c>4e3?1:(e-c)/4e3:0,L={left:"51%",top:"51%",backgroundColor:f,opacity:v(l)};(0,o.useEffect)(()=>{if(!C.current||!e)return;let t=requestAnimationFrame(()=>{C.current&&i(C.current.getBoundingClientRect().width)});return()=>cancelAnimationFrame(t)},[e]);let b=e=>{var n;"Enter"===e.key&&(null===(n=w.current)||void 0===n||n.focus()),"Escape"===e.key&&(t(""),a(null))};return(0,o.useEffect)(()=>(window.addEventListener("keydown",b),()=>window.removeEventListener("keydown",b)),[]),(0,o.useEffect)(()=>{setTimeout(()=>u(Date.now()),1e3)},[c]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("form",{className:$().chat,onSubmit:n=>{n.preventDefault(),a(Date.now()+8e3),""===e||l<c||(d(h.CHAT,{message:e}),t(""))},style:L,children:[(0,r.jsx)("input",{type:"text",ref:w,className:$().message,value:e,maxLength:40,onChange:e=>{t(e.target.value),a(Date.now()+8e3)},style:{width:"".concat(n+5,"px"),color:"yellow"===f?"black":"white"}}),(0,r.jsx)("div",{ref:C,"aria-hidden":!0,children:e})]}),m.map((e,t)=>(0,r.jsx)("div",{className:$().chat,style:{left:"".concat(y/2+(e.position.x-g.x-1/x/2)*x*80,"px"),top:"".concat(p/2+(e.position.y-g.y-1/x/2)*x*80,"px"),backgroundColor:e.color,color:"yellow"===e.color?"black":"white",opacity:v(e.messageTime)},children:e.message},"".concat(e.id,"-").concat(t)))]})}var et=n(4648),en=n(1442),er=JSON.parse('{"tileColors":{"inner":[["#8fe340","#A4E863"],["#62B628","#71C637"],["#F1FAD1","#E9F6B9"]],"outer":[["#A8EC67","#81D92C"],["#74C63C","#5BB31F"],["#E9FAAA","#F5FDD8"]]},"flagPaths":["M219.428 109.389 C226.519 114.964 223.188 126.337 214.21 127.205 L79.8702 140.188 L115.929 28.0267 L219.428 109.389 Z","M79.9801 8.51632 C75.8798 9.72627 73.972 13.8825 73.0599 18.0591 L25.8244 234.356 C30.5707 235.401 36.0988 236 42 236 C45.1362 236 48.1671 235.831 51.0311 235.515 L116.451 28.5289 C117.573 24.9766 117.96 21.0358 115.39 18.3387 C112.87 15.6942 108.055 12.4097 98.862 9.69397 C89.7757 7.00975 83.7643 7.39963 79.9801 8.51632 Z"],"boomPaths":[" M77.85 145.025 L0.899994 54.5752 L103.5 92.3752 L117 0.575195 L164.25 74.8252 L219.6 38.3752 L202.05 103.175 L276.3 108.575 L219.6 153.125 L287.1 223.325 L198 230.075 L177.75 312.425 L130.5 236.825 L67.05 284.075 L75.15 196.325 L11.7 177.425 L77.85 145.025 "," M67.05 104.525 L104.85 150.425 L71.1 169.325 L104.85 178.775 L100.8 226.025 L133.2 200.375 L158.85 239.525 L168.3 196.325 L218.25 192.275 L181.8 154.475 L212.85 131.525 L171 128.825 L181.8 93.7251 L152.1 113.975 L126.45 73.4751 L118.35 122.075 L67.05 104.525 "],"cursorPaths":"M1.50025 12.3269C-1.20902 5.52993 5.52992 -1.20901 12.3269 1.50027L52.892 17.6696C60.2374 20.5975 59.7565 31.1525 52.1752 33.4002L50.7 33.8376C42.5878 36.2427 36.2427 42.5878 33.8376 50.7L33.4002 52.1752C31.1525 59.7565 20.5975 60.2374 17.6696 52.892L1.50025 12.3269Z","countColors":["#0059B280","#0095B280","#00B20080","#77B20080","#B2950080","#B24A0080","#B2000080","#7700B280"],"stunPaths":["M129.815 125.662C130.503 123.446 133.497 123.446 134.185 125.662L139.22 141.887C139.527 142.878 140.409 143.549 141.404 143.549H157.699C159.924 143.549 160.849 146.53 159.049 147.899L145.866 157.927C145.061 158.539 144.724 159.625 145.032 160.616L150.067 176.841C150.755 179.057 148.333 180.899 146.533 179.53L133.35 169.502C132.545 168.89 131.455 168.89 130.65 169.502L117.467 179.53C115.667 180.899 113.245 179.057 113.933 176.841L118.968 160.616C119.276 159.625 118.939 158.539 118.134 157.927L104.951 147.899C103.151 146.53 104.076 143.549 106.301 143.549H122.596C123.591 143.549 124.473 142.878 124.78 141.887L129.815 125.662Z","M194.44 89.187C194.931 87.6043 197.069 87.6043 197.56 89.187L201.157 100.776C201.377 101.484 202.007 101.963 202.717 101.963H214.356C215.946 101.963 216.606 104.093 215.321 105.071L205.905 112.234C205.329 112.671 205.089 113.446 205.309 114.154L208.905 125.744C209.396 127.326 207.666 128.642 206.38 127.664L196.964 120.501C196.389 120.064 195.611 120.064 195.036 120.501L185.62 127.664C184.334 128.642 182.604 127.326 183.095 125.744L186.691 114.154C186.911 113.446 186.671 112.671 186.095 112.234L176.679 105.071C175.394 104.093 176.054 101.963 177.644 101.963H189.283C189.993 101.963 190.623 101.484 190.843 100.776L194.44 89.187Z","M170 93.7976C170 90.9223 167.92 88.439 165.054 88.2051C163.391 88.0694 161.705 88 160 88C139.889 88 122.445 97.66 113.794 111.795C111.465 115.603 114.57 120 119.034 120C121.483 120 123.681 118.599 125.072 116.583C131.592 107.134 144.005 100 160 100C160.973 100 161.933 100.026 162.879 100.078C166.586 100.281 170 97.5106 170 93.7976ZM206 132C202.686 132 200.06 134.723 199.266 137.94C196.313 149.9 184.652 160.816 167.768 163.416C164.571 163.908 162 166.522 162 169.756C162 173.154 164.823 175.908 168.191 175.457C190.725 172.44 208.443 157.177 211.524 137.977C212.049 134.705 209.314 132 206 132Z"]}');let ei=e=>new Path2D(e),el=e=>{let t=[];return e.forEach(e=>t.push(new Path2D(e))),t},eo=(e,t,n)=>{e.save(),e.fillStyle=n,e.fill(t),e.restore()},es=async(e,t,n,r)=>{let i=en.xEZ.from(e);try{let t=await createImageBitmap(e);i=en.xEZ.from(t)}catch(e){}finally{return i.baseTexture.scaleMode=en.aH$.NEAREST,i.baseTexture.mipmap=en.WBB.OFF,i.baseTexture.wrapMode=en.Nt$.CLAMP,i.baseTexture.setSize(t,n),"number"==typeof r&&(i.baseTexture.resolution=r),i}},ea=e=>{let t=parseInt(e.replace("#",""),16);return{r:t>>16&255,g:t>>8&255,b:255&t}},ec=(e,t,n)=>Math.round(e+(t-e)*n),eu=[[-1,0],[0,-1],[0,1],[1,0],[-1,-1],[-1,1],[1,-1],[1,1]],eh={red:"#FF4D00",blue:"#0094FF",yellow:"#F0C800",purple:"#BC3FDC",0:"#FF4D00",1:"#F0C800",2:"#0094FF",3:"#BC3FDC"},ed={red:"#FBCBB6",blue:"#A8DBFF",yellow:"#FFEE99",purple:"#E8BEF3",0:"#FBCBB6",1:"#A8DBFF",2:"#FFEE99",3:"#E8BEF3"};function ef(e){let t=0,n=[],r=()=>{if(t>=e)return;let r=n.shift();r&&(t++,r())};return i=>new Promise((l,o)=>{let s=e=>{let n=i();n.then(l),n.catch(o),n.finally(()=>{!e&&t--,r()})};t>=e?n.push(s):s(!0)})}function eg(e){return e.getContext("2d",{willReadFrequently:!1,desynchronized:!0})}function ex(e,t,n){for(;e.length<n;){let n=new en.jyi;n.roundPixels=!0,n.eventMode="none",n.cullable=!0,n.visible=!1,t.addChild(n),e.push(n)}return e}function em(e,t){for(let n=t;n<e.length;n++)e[n].visible=!1}function ep(e){let{tilePadWidth:t,tilePadHeight:n,className:i}=e,l=U(),a=G(),{tileColors:c}=er,{outer:u,inner:h}=c,{zoom:d}=Y(),{windowHeight:f,windowWidth:g}=s(),{cachedTexturesRef:x,numberTexturesRef:m,texturesReady:p,numbersReady:y}=function(e,t){let{flagPaths:n,tileColors:r,countColors:i,boomPaths:l}=er,{outer:s,inner:a}=r,c=(0,o.useRef)(new Map),u=(0,o.useRef)(new Map),[h,d]=(0,o.useState)(!1),[f,g]=(0,o.useState)(!1);return(0,o.useEffect)(()=>{(async()=>{let t=[],n=ef(8),r=new Map;for(let l=1;l<=i.length;l++)t.push(n(async()=>{let t=document.createElement("canvas");t.width=t.height=e;let n=eg(t);if(!n)return;n.clearRect(0,0,e,e),n.textAlign="center",n.textBaseline="middle",n.font="".concat(.6*e>>>0,"px LOTTERIACHAB"),n.fillStyle=i[l-1],n.imageSmoothingEnabled=!1,n.fillText("".concat(l),e/2,e/2);let o=await es(t,e,e,1);r.set(l,o)}));await Promise.all(t),u.current=r,g(!0)})();let r=c.current,o=(t,n)=>{let i="".concat(t).concat(n).concat(e);if(r.has(i))return;let l=document.createElement("canvas");l.width=l.height=4;let o=eg(l);if(!o)return;let s=ea(t),a=ea(n);for(let e=0;e<4;e++){let t=e/3,n=ec(s.r,a.r,t),r=ec(s.g,a.g,t),i=ec(s.b,a.b,t);o.fillStyle="rgb(".concat(n,",").concat(r,",").concat(i,")"),o.fillRect(e,0,1,4)}let c=en.xEZ.from(l);c.baseTexture.scaleMode=en.aH$.NEAREST,c.baseTexture.mipmap=en.WBB.OFF,c.baseTexture.wrapMode=en.Nt$.CLAMP,c.baseTexture.setSize(4,4),c.baseTexture.resolution=.001,r.set(i,c)};for(let e=0;e<s.length;e++)o(s[e][0],s[e][1]),o(a[e][0],a[e][1]);let h=[],f=ef(8);h.push(f(async()=>{let n=document.createElement("canvas");n.width=n.height=e/3;let i=eg(n);if(!i)return;i.scale(t/3/4,t/3/4),eo(i,ei(l[0]),"rgba(0, 0, 0, 0.6)"),eo(i,ei(l[1]),"rgba(0, 0, 0, 0.5)");let o=await es(n,e/3,e/3);r.set("boom",o)})),[0,1,2,3].forEach(i=>h.push(f(async()=>{let l=document.createElement("canvas");l.width=l.height=e/2;let o=eg(l);if(!o)return;let s=o.createLinearGradient(36.5,212.5,36.5,259);s.addColorStop(0,"#E8E8E8"),s.addColorStop(1,"transparent"),o.translate(l.width/6,l.height/6),o.scale(t/2/4.5,t/2/4.5),eo(o,ei(n[0]),eh[i]),eo(o,ei(n[1]),s);let a=await es(l,e,e);r.set("flag".concat(i),a)}))),Promise.all(h).finally(()=>d(!0))},[e]),(0,o.useEffect)(()=>{let e=c.current;return()=>{e.forEach(e=>e.destroy()),e.clear()}},[]),{cachedTexturesRef:c,numberTexturesRef:u,texturesReady:h,numbersReady:f}}(a,d),w=(0,o.useRef)(null),C=(0,o.useRef)(null),b=(0,o.useRef)(null),_=(0,o.useRef)(null),T=(0,o.useRef)([]),j=(0,o.useRef)([]),R=(0,o.useRef)([]),P=(0,o.useRef)([]),I=(0,o.useRef)([]),A=(0,o.useRef)([]);return((0,o.useEffect)(()=>{let e=R.current;return()=>{e.forEach(e=>{let{outer:t,inner:n}=e;t.destroy(),n.destroy()}),R.current=[],T.current=[],j.current=[],P.current=[],I.current=[],A.current=[]}},[]),(0,o.useLayoutEffect)(()=>{let e=w.current,r=C.current,i=b.current,o=_.current;if(!e||!r||!i||!o||!p||!y)return;let s=l.height,c=l.width;if(0===s||0===c)return;let N=Math.max(0,Math.ceil(t-1)),B=Math.min(c-1,t+(g+a)/(a||1)>>>0),F=Math.max(0,Math.ceil(n-1)),O=Math.min(s-1,n+(f+a)/(a||1)>>>0);if(N>B||F>O||!Number.isFinite(N+B+F+O))return;let D=x.current,W=D.get("".concat(u[2][0]).concat(u[2][1]).concat(a)),U=D.get("".concat(h[2][0]).concat(h[2][1]).concat(a));if(!W||!U)return;let z=Math.max(0,O-F+1|0)*Math.max(0,B-N+1|0),H=5*d;for(ex(T.current,e,z),ex(j.current,e,z),ex(P.current,i,z),ex(I.current,o,z),ex(A.current,e,z);R.current.length<z;){let e=new en.jyi;e.roundPixels=!0,e.eventMode="none",e.cullable=!0;let t=new en.jyi;t.roundPixels=!0,t.eventMode="none",t.cullable=!0,r.addChild(e),r.addChild(t),R.current.push({outer:e,inner:t})}let Z=0,G=0,K=0,V=0,X=0,Y=0;for(let e=F;e<=O;e++)for(let r=N;r<=B;r++){let i,o;let s=l.get(e,r);if(s===v.FILL){let i=(r-t)*a,l=(e-n)*a,o=Math.round(i),s=Math.round(l),c=Math.round(i+a),d=Math.round(l+a),f=e+r&1,[g,x]=[u[f],h[f]],m=D.get("".concat(g[0]).concat(g[1]).concat(a))||W,p=D.get("".concat(x[0]).concat(x[1]).concat(a))||U,y=R.current[K++];if(!y)continue;y.outer.texture=m,y.outer.x=o,y.outer.y=s,y.outer.width=y.outer.height=a,y.outer.visible=!0;let w=Math.round(o+H),C=Math.round(s+H);y.inner.texture=p,y.inner.x=w,y.inner.y=C,y.inner.width=Math.max(0,Math.round(c-H)-w),y.inner.height=Math.max(0,Math.round(d-H)-C),y.inner.visible=!0;continue}let c=(r-t)*a,d=(e-n)*a,f=Math.round(c),g=Math.round(d),x=Math.round(c+a),p=Math.round(d+a),y=x-f,w=p-g,C=M(s);if(C){let e=E(s),[t,n]=[u[e],h[e]];i=D.get("".concat(t[0]).concat(t[1]).concat(a))||W,o=D.get("".concat(n[0]).concat(n[1]).concat(a))||U}else i=W,o=U;if(C){let e=R.current[K++];if(!e)continue;e.outer.texture=i,e.outer.x=f,e.outer.y=g,e.outer.width=e.outer.height=a,e.outer.visible=!0;let t=Math.round(f+H),n=Math.round(g+H),r=Math.round(x-H),l=Math.round(p-H);if(e.inner.texture=o,e.inner.x=t,e.inner.y=n,e.inner.width=Math.max(0,r-t),e.inner.height=Math.max(0,l-n),e.inner.visible=!0,k(s)){let e=S(s),t=D.get("flag".concat(e));if(t){let e=I.current[X++];e.texture=t,e.anchor.set(.5),e.x=f+a/2,e.y=g+a/2,e.width=y,e.height=w,e.visible=!0}}}else{let e=T.current[Z++];e.texture=i,e.x=f,e.y=g,e.width=y,e.height=w,e.visible=!0;let t=Math.round(c+H),n=Math.round(d+H),r=Math.round(f+y-H),l=Math.round(g+w-H),u=j.current[G++];if(u.texture=o,u.x=t,u.y=n,u.width=Math.max(0,r-t),u.height=Math.max(0,l-n),u.visible=!0,L(s)){let e=D.get("boom");if(e){let t=P.current[V++];t.texture=e,t.x=f,t.y=g,t.width=y,t.height=w,t.visible=!0}}if(s>=1&&s<=7){let e=m.current.get(s);if(e){let t=A.current[Y++];t.texture=e,t.anchor.set(.5),t.x=f+a/2,t.y=g+a/2,t.width=y,t.height=w,t.visible=!0}}}}em(T.current,Z),em(j.current,G),em(P.current,V),em(I.current,X),em(A.current,Y);for(let e=K;e<R.current.length;e++)R.current[e].outer.visible=!1,R.current[e].inner.visible=!1},[l,p,y]),p&&y)?(0,r.jsx)(et.Hf,{id:"Tilemap",className:i,width:g,height:f,options:{backgroundColor:8421504,resolution:1,antialias:!1,powerPreference:"low-power",autoDensity:!1,preserveDrawingBuffer:!1,sharedTicker:!0},children:(0,r.jsxs)(et.W2,{name:"container",sortableChildren:!1,eventMode:"none",cacheAsBitmap:!1,cullable:!0,children:[(0,r.jsx)(et.W2,{name:"background",ref:w,eventMode:"none",sortableChildren:!1}),(0,r.jsx)(et.W2,{name:"closed-layer",ref:C,eventMode:"none",sortableChildren:!1}),(0,r.jsx)(et.W2,{name:"boom-layer",ref:b,eventMode:"none",sortableChildren:!1}),(0,r.jsx)(et.W2,{name:"flag-layer",ref:_,eventMode:"none",sortableChildren:!1})]})}):null}let ey=(0,a.U)(e=>({purchasedSkills:[],setPurchasedSkills:t=>e(e=>({purchasedSkills:"function"==typeof t?t(e.purchasedSkills):t}))}));var ew=n(1616),eC=n(2542);let ev=[{id:"1",name:"SPEED I",description:"Increase moving speed",nexts:["2"],cost:2},{id:"2",name:"SPEED II",description:"Increase moving speed",nexts:["3"],cost:4},{id:"3",name:"CLICK I",description:"Increase click intraction range",nexts:["4"],cost:8},{id:"4",name:"SPEED III",description:"Increase moving speed",nexts:["5"],cost:16},{id:"5",name:"EXPLODE I",description:"Increase intraction range",nexts:["6"],cost:32},{id:"6",name:"SPEED IV",description:"Increase moving speed",nexts:["7"],cost:64}],eL=["1","2","4","6"],eb=()=>{let e=2*Math.PI/ev.length;return ev.map((t,n)=>{let{id:r,name:i}=t,l=(n-2)*e;return{id:r,data:{label:i},position:{x:200*Math.cos(l),y:200*Math.sin(l)}}})},ek=()=>ev.flatMap(e=>e.nexts.map(t=>({id:"".concat(e.id,"-").concat(t),source:e.id,target:t,animated:!0,style:{strokeWidth:4,stroke:"#ff4d4f"},markerEnd:{type:ew.QZ.ArrowClosed,width:20,height:20}})));function eM(){let e=ey(e=>e.purchasedSkills),t=ey(e=>e.setPurchasedSkills),[n,r,i]=(0,eC.Rr)(eb()),[l,s,a]=(0,eC.ll)(ek()),[c,u]=(0,o.useState)(null),[h,d]=(0,o.useState)([]),f=(0,o.useMemo)(()=>c&&e.includes(c.id),[e,c]),g=(0,o.useMemo)(()=>200/(1+.2*eL.filter(t=>e.includes(t)).length),[e]);return{nodes:n,edges:l,onNodesChange:i,onEdgesChange:a,selectedSkill:c,purchasedSkills:e,purchaseableSkills:h,isPurchased:f,MOVE_SPEED:g,onNodeClick:(e,t)=>{let n=ev.find(e=>{let{id:n}=e;return n===t.id});u(null!=n?n:null)},purchaseSkill:()=>{if(!c||e.includes(c.id))return;let i=ev.filter(e=>e.nexts.includes(c.id));if(!i.every(t=>e.includes(t.id))&&i.length>0)return;let o=[...e,c.id];t(o),s(l.map(e=>{let t=o.includes(e.target)?"#ffd700":"#ff4d4f";return{...e,style:{...e.style,stroke:t}}})),r(n.map(e=>e.id===c.id?{...e,className:"skill-purchased"}:e)),d(h.filter(e=>e.id!==c.id))}}}class e_{constructor(e,t){this.x=e,this.y=t,this.gScore=1/0,this.heuristic=0,this.fTotal=1/0,this.parent=null}}function eE(e,t){let n=e.getBoundingClientRect();e.width=n.width,e.height=n.height,e.style.width=n.width+"px",e.style.height=n.height+"px",t.imageSmoothingEnabled=!0,t.imageSmoothingQuality="low","textRenderingOptimization"in t&&(t.textRenderingOptimization="optimizeQuality")}let eS={special:h.SET_FLAG,general:h.OPEN_TILES};var eT=e=>{let{paddingTiles:t,cursorOriginX:n,cursorOriginY:i,leftReviveTime:l,activeExplosions:a,removeExplosion:d}=e,g=U(),x=G(),m=Z(),p=z(),y=H(),{padtiles:w}=D(),{MOVE_SPEED:C}=eM(),{windowHeight:v,windowWidth:L}=s(),{setPosition:M,x:E,y:S,setMovecost:T}=c(),{position:j,zoom:R,color:P,setPosition:I,setOriginPosition:A,isBombMode:N}=Y(),{cursors:B}=J(),{sendMessage:F}=Q(),{useAnimation:O}=u(),[W,K]=[n-m.x,i-m.y],[V,q]=[(t-1)*W/t,(t-1)*K/t],$=(0,o.useRef)(null),et={interactionCanvasRef:(0,o.useRef)(null),otherCursorsRef:(0,o.useRef)(null),otherPointerRef:(0,o.useRef)(null),myCursorRef:(0,o.useRef)(null)},{movingPaths:en,forwardPath:eo,lastMovingPosition:es,leftMovingPaths:ea,moveCursor:ec,cancelCurrentMovement:ef,clickEvent:eg,isAlreadyCursorNeighbor:ex,findOpenedNeighbors:em,findOpenedNeighborsAroundTarget:ey}=function(e){let{tiles:t,tileSize:n,startPoint:r,viewStart:i,viewEnd:l,cursorOriginX:s,cursorOriginY:a,cursorPosition:c,relativeX:u,relativeY:d,padtiles:g,sendMessage:x,setCursorPosition:m,setOriginPosition:p,setMovecost:y,MOVE_SPEED:w,useAnimation:C,canvasRefs:v,shockwaveCanvasRef:L,cursors:b}=e,k=(0,o.useRef)(null),[M,E]=(0,o.useState)([]),[S,T]=(0,o.useState)({x:1/0,y:1/0}),[j,R]=(0,o.useState)(),[P,I]=(0,o.useState)({x:1/0,y:1/0}),A=(0,o.useCallback)(()=>{k.current&&(clearInterval(k.current),k.current=null)},[]),N=(0,o.useCallback)((e,t)=>b.some(n=>n.position.x===e+r.x&&n.position.y===t+r.y),[b,r]),B=(0,o.useCallback)((e,t)=>eu.some(n=>{let[r,i]=n;return s+r===e&&a+i===t}),[s,a]),F=(0,o.useCallback)((e,n)=>{let r={x:1/0,y:1/0};return[[0,0],...eu].some(i=>{let[l,o]=i,[s,a]=[e+l,n+o];return!(a<0)&&!(a>=t.height)&&!(s<0)&&!(s>=t.width)&&!!_(t.get(a,s))&&(r={x:s,y:a},!0)}),r},[t]),O=(0,o.useCallback)((e,n)=>{let i={x:1/0,y:1/0},l=s-r.x,o=a-r.y;if((eu.some(t=>{let[r,i]=t;return s===e+r&&a===n+i})||s===e&&a===n)&&o>=0&&o<t.height&&l>=0&&l<t.width&&_(t.get(o,l)))return{x:l,y:o};let c=1/0;return[[0,0],...eu].forEach(s=>{let[a,u]=s,h=e+a-r.x,d=n+u-r.y;if(d<0||d>=t.height||h<0||h>=t.width||!_(t.get(d,h)))return;let f=Math.abs(h-l)+Math.abs(d-o);f<c&&(c=f,i={x:h,y:d})}),i},[t,s,a,r]);return{movingPaths:M,forwardPath:j,lastMovingPosition:P,leftMovingPaths:S,moveCursor:(e,o,s,a,b)=>{if(k.current)return;let M=0,S=function(e,t,n,r,i,l,o){var s;if(t===r&&n===i)return[{x:0,y:0}];let a=r-t,c=i-n;if(1>=Math.abs(a)&&1>=Math.abs(c)&&(0!==a||0!==c)&&i>=0&&i<e.height&&r>=0&&r<e.width&&_(e.get(i,r))&&!l(r,i))return[{x:0,y:0},{x:a,y:c}];let u=(e,t)=>{let n=[];for(let[r,i]of eu){let[o,s]=[t.x+r,t.y+i];s<0||s>=e.length||o<0||o>=e[s].length||null===e[s][o]||l(o,s)||n.push({node:e[s][o],isDiagonal:0!==r&&0!==i})}return n},h=(e,t,n)=>({x:e.x-t,y:e.y-n}),[d,f]=[new e_(t,n),new e_(r,i)],g=[];for(let t=0;t<e.height;t++){let n=[];for(let r=0;r<e.width;r++)n.push(_(e.get(t,r))?new e_(r,t):null);g.push(n)}if(i<0||i>=g.length||r<0||r>=(null===(s=g[i])||void 0===s?void 0:s.length)||null===g[i][r])return[];let x=[d],m=[];for(d.gScore=0,d.heuristic=Math.abs(t-r)+Math.abs(n-i),d.fTotal=d.gScore+d.heuristic;x.length>0;){let e=x.reduce((e,t)=>e.fTotal<t.fTotal?e:t),r=h(e,t,n);if(null==o||o(r),e.x===f.x&&e.y===f.y){let r=[];for(let i=e;i;i=i.parent)r.unshift({x:i.x-t,y:i.y-n});return r}for(let{node:t,isDiagonal:n}of(x=x.filter(t=>t!==e),m.push(e),u(g,e))){if(m.includes(t))continue;let r=e.gScore+(n?14:10);r>=t.gScore||(x.includes(t)||x.push(t),t.parent=e,t.gScore=r,t.heuristic=Math.abs(t.x-f.x)+Math.abs(t.y-f.y),t.fTotal=t.gScore+t.heuristic)}}return[]}(t,u,d,e,o,(e,t)=>N(e,t),e=>T(e)),j=S[M];if((null==j?void 0:j.x)===void 0||(null==j?void 0:j.y)===void 0)return;let P=[...S];if(P.length>2){let t=P[P.length-2],n=u+t.x,r=d+t.y;n===e&&r===o&&P.pop();let i=P[P.length-1];i&&I({x:c.x+i.x,y:c.y+i.y})}let[B,F]=[c.x,c.y];y(P.length-1);let O=(e,t)=>{let{interactionCanvasRef:r,otherCursorsRef:i,otherPointerRef:l}=v,o=document.getElementById("Tilemap"),s=[r.current,i.current,l.current,L.current,o],a=performance.now(),c=r=>{let i=Math.min((r-a)/w,1),l=n*(1-i),[o,u]=[l*e,l*t];s.forEach(e=>e.style.transform="translate(".concat(o,"px, ").concat(u,"px)")),i<1?requestAnimationFrame(c):s.forEach(e=>e.style.transform="translate(0, 0)")};requestAnimationFrame(c)};k.current=setInterval(()=>{if(++M>=P.length){m({x:e+r.x,y:o+r.y}),E([]),I({x:1/0,y:1/0}),A(),null==b||b(s,a);return}let t=P[M];if(!t)return;let[n,c]=[Math.sign(t.x-j.x),Math.sign(t.y-j.y)];R({x:n,y:c});let u="";1===c&&(u+=f.DOWN),-1===c&&(u+=f.UP),1===n&&(u+=f.RIGHT),-1===n&&(u+=f.LEFT),[B,F]=[n+B,c+F];let d={x:B,y:F};x(h.MOVE,{position:d}),p(d),m(d),j=t,E(P.slice(M)),u&&i&&l&&g(i.x,l.y,l.x,i.y,u),C&&O(n,c),console.log("animation",performance.now())},w)},cancelCurrentMovement:A,clickEvent:(0,o.useCallback)((e,t,n)=>{let{MOVE:r,OPEN_TILES:i,SET_FLAG:l,DISMANTLE_MINE:o,INSTALL_BOMB:s}=h;[r,i,l,o,s].some(e=>e===n)&&x(n,{position:{x:e,y:t}})},[x]),isAlreadyCursorNeighbor:B,findOpenedNeighbors:F,findOpenedNeighborsAroundTarget:O}}({tiles:g,tileSize:x,startPoint:m,viewStart:p,viewEnd:y,cursorOriginX:n,cursorOriginY:i,cursorPosition:j,relativeX:W,relativeY:K,padtiles:w,sendMessage:F,setCursorPosition:I,setOriginPosition:A,setMovecost:T,MOVE_SPEED:C,useAnimation:O,canvasRefs:et,shockwaveCanvasRef:$,cursors:B}),{isInitializing:ew,cleanupCanvasResources:eC}=function(e){let{canvasRefs:t,tiles:n,tileSize:r,zoom:i,windowWidth:l,windowHeight:s,cursors:a,color:c,cursorOriginX:u,cursorOriginY:h,relativeX:d,relativeY:f,paddingTiles:g,clickX:x,clickY:m,tilePaddingWidth:p,tilePaddingHeight:y,startPoint:w,movingPaths:C,forwardPath:v,lastMovingPosition:L,leftMovingPaths:b}=e,k=r>>1,M=1/(g-1),[_,E]=[p*M,y*M],{boomPaths:S,cursorPaths:T,flagPaths:j,stunPaths:R}=er,[P,I]=(0,o.useState)(!0),[A,N]=(0,o.useState)(),B=(0,o.useCallback)(function(e,t,n,l){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,c=i*a;if(e.save(),e.fillStyle=l,e.translate(t,n),1===a){let t=(Math.round((s+Math.PI)/(Math.PI/4))+2)%8,n=k>>2;0===t?e.translate(k,n):1===t?e.translate(r-n,n):2===t?e.translate(r-n,k):3===t?e.translate(r-n,r-n):4===t?e.translate(k,r-n):5===t?e.translate(n,r-n):6===t?e.translate(n,k):7===t&&e.translate(n,n)}else e.translate(k,k);if(e.rotate(s-Math.PI/4),e.scale(c,c),e.fill(A.cursor),e.restore(),!(o>0&&Date.now()<o&&(null==A?void 0:A.stun)))return;let u=i/2;e.save(),e.translate(t-k,n-k),e.fillStyle="white",e.strokeStyle="black",e.scale(u,u),A.stun.forEach(t=>{e.fill(t),e.stroke(t)}),e.restore()},[r,A]),F=(0,o.useCallback)((e,t,n,i,l)=>{e&&(e.beginPath(),e.strokeStyle=i,e.lineWidth=l,e.strokeRect(t+l/2,n+l/2,r-l,r-l),e.closePath())},[r]),O=(0,o.useCallback)(()=>{let e=t.otherCursorsRef.current;if(!e)return;let n=e.getContext("2d");n&&(eE(e,n),n.clearRect(0,0,l,s),a.forEach(e=>{var t;let{position:i,color:l,revive_at:o}=e,{x:s,y:a}=null!==(t=null==e?void 0:e.pointer)&&void 0!==t?t:{x:1/0,y:1/0},[c,d]=[i.x-u+_,i.y-h+E],[f,g]=[i.x-s,i.y-a];B(n,c*r,d*r,eh[l],o,0!==f||0!==g?Math.atan2(g,f):0)}))},[a,u,h,p,y,r,l,s,t.otherCursorsRef]),D=(0,o.useCallback)(e=>{let n=t.otherPointerRef.current;if(!n)return;let i=n.getContext("2d");i&&(eE(n,i),i.clearRect(0,0,l,s),a.forEach(t=>{let{pointer:n,color:l}=t,{x:o,y:s}=null!=n?n:{x:0,y:0},[a,c]=[o-u+_,s-h+E];F(i,a*r,c*r,ed[l],e)}))},[a,u,h,_,E,r,l,s,F,t.otherPointerRef]),W=(0,o.useCallback)(()=>{let{interactionCanvasRef:e,myCursorRef:n,otherCursorsRef:o,otherPointerRef:a}=t,{current:w}=e,{current:M}=n,{current:_}=o,{current:E}=a;if(!w||!M||!_||!E)return;let[S,T]=[w.getContext("2d"),M.getContext("2d")];if(!S||!T)return;eE(w,S),eE(M,T),T.clearRect(0,0,l,s),S.clearRect(0,0,l,s);let j=eh[c],R=5*i,P={x:d/g*r,y:f/g*r},I={x:P.x+(x-u)*r,y:P.y+(m-h)*r},A={x:L.x-u-b.x-p+d+.5,y:L.y-h-b.y-y+f+.5},N=(u!==x||h!==m)&&v?Math.atan2(-v.y,-v.x):0;B(T,P.x,P.y,j,0,N),F(S,I.x,I.y,j,R),O(),D(R);let W=null==C?void 0:C.map(e=>{let[t,n]=[e.x+A.x,e.y+A.y];return{x:t*r,y:n*r}});if(W.length<=1)return;let U=.15*r;S.beginPath(),S.strokeStyle=j,S.lineWidth=r/10,S.lineJoin=S.lineCap="round",S.miterLimit=2,S.moveTo(W[0].x,W[0].y);for(let e=1;e<W.length-1;e++){let[t,n,r]=[...W.slice(e-1,e+2)],[i,l]=[n.x-t.x,n.y-t.y],[o,s]=[r.x-n.x,r.y-n.y],[a,c]=[Math.hypot(i,l),Math.hypot(o,s)],u=i*s-l*o,h=(i*o+l*s)/(a*c);if(1e-6>Math.abs(u)||h>.995)S.lineTo(n.x,n.y);else{let e=Math.min(U,.5*Math.min(a,c));S.arcTo(n.x,n.y,r.x,r.y,e)}}let[z,H]=[...W.slice(-2)],[Z,G]=[(H.x+z.x)/2,(H.y+z.y)/2],K=Math.PI+Math.atan2(H.y-z.y,H.x-z.x);S.lineTo(Z,G),B(S,Z-k,G-k,j,0,K,.6),S.stroke()},[t,l,s,c,i,d,f,g,r,x,m,u,h,p,y,L,b,v,C,B,F,O,D,k]);return(0,o.useLayoutEffect)(()=>{if(!P&&!n.isEmpty)return;let e=async()=>{try{if(document.fonts.check("1em LOTTERIACHAB"))return;let e=new FontFace("LOTTERIACHAB","url('https://fastly.jsdelivr.net/gh/projectnoonnu/noonfonts_2302@1.0/LOTTERIACHAB.woff2') format('woff2')");await e.load(),document.fonts.add(e)}catch(e){console.warn("Font loading failed, using fallback font")}},t=ei(T),r=el(R),[i,l]=j.map(ei),[o,s]=S.map(ei);N({cursor:t,stun:r,flag:{flag:i,pole:l},boom:{inner:o,outer:s}}),I(!1),e()},[n,P]),(0,o.useEffect)(()=>{P||W()},[u,h,w,x,m,c,a,b]),{isInitializing:P,cleanupCanvasResources:(0,o.useCallback)(()=>{Object.values(t).forEach(e=>{if(e.current){let t=e.current.getContext("2d");null==t||t.clearRect(0,0,e.current.width,e.current.height)}}),N(void 0)},[])}}({canvasRefs:et,tiles:g,tileSize:x,zoom:R,windowWidth:L,windowHeight:v,cursors:B,color:P,cursorOriginX:n,cursorOriginY:i,relativeX:W,relativeY:K,paddingTiles:t,clickX:E,clickY:S,tilePaddingWidth:V,tilePaddingHeight:q,startPoint:m,movingPaths:en,forwardPath:eo,lastMovingPosition:es,leftMovingPaths:ea}),{handleClick:ev,handlePointerDown:eL,handlePointerUp:eb,handlePointerMove:ek}=function(e){let{canvasRefs:t,tiles:n,tileSize:r,tilePaddingWidth:i,tilePaddingHeight:l,startPoint:s,cursorOriginX:a,cursorOriginY:c,isBombMode:u,movingPaths:d,moveCursor:f,clickEvent:g,setClickPosition:x,isAlreadyCursorNeighbor:m,findOpenedNeighbors:p,findOpenedNeighborsAroundTarget:y}=e,w=(0,o.useRef)(null),C=(0,o.useRef)(null),v=(0,o.useRef)(!1);return{handleClick:e=>{if(v.current){v.current=!1;return}let o=t.interactionCanvasRef.current;if(!o)return;let{left:w,top:C}=o.getBoundingClientRect(),[L,M]=[e.clientX-w,e.clientY-C],[_,E]=[L/r+i>>>0,M/r+l>>>0],[S,T]=[Math.round(_+s.x),Math.round(E+s.y)],j=n.get(E,_);x(S,T,j);let R=b(j),P=k(j),[I,A]=[S-a,T-c],N=I>=-1&&I<=1&&A>=-1&&A<=1,B=2!==e.buttons?"general":"special",F=R||P;if(N){if(u&&F&&"special"===B){g(S,T,h.INSTALL_BOMB);return}if(F&&"special"===B?g(S,T,h.SET_FLAG):R&&"general"===B&&g(S,T,h.OPEN_TILES),F)return}if(!N&&F){let{x:e,y:t}=y(S,T);if(e===1/0||t===1/0||d.length>0)return;let n=u&&"special"===B?h.INSTALL_BOMB:eS[B],r=e+s.x,i=t+s.y;if(r===a&&i===c){n&&g(S,T,n);return}if(!n)return;f(e,t,S,T,(e,t)=>g(e,t,n));return}if("special"===B&&d.length>0)return;let{x:O,y:D}=p(_,E);m(S,T)&&([O,D]=[_,E]),f(O,D,S,T)},handlePointerDown:e=>{if(2===e.button){e.preventDefault();let o=t.interactionCanvasRef.current;if(!o)return;let{left:m,top:p}=o.getBoundingClientRect(),[w,C]=[e.clientX-m,e.clientY-p],[v,L]=[w/r+i>>>0,C/r+l>>>0],[M,_]=[Math.round(v+s.x),Math.round(L+s.y)],E=n.get(L,v);x(M,_,E);let S=b(E),T=k(E),[j,R]=[M-a,_-c],P=j>=-1&&j<=1&&R>=-1&&R<=1,I=u?h.INSTALL_BOMB:h.SET_FLAG;if(P&&(S||T))g(M,_,I);else if(!P&&(S||T)){let{x:e,y:t}=y(M,_);if(!(e===1/0||t===1/0||d.length>0)){let n=e+s.x,r=t+s.y;n===a&&r===c&&g(M,_,I),f(e,t,M,_,(e,t)=>g(e,t,I))}}return}let o=t.interactionCanvasRef.current;if(!o)return;let{left:m,top:p}=o.getBoundingClientRect(),[L,M]=[e.clientX-m,e.clientY-p];C.current={x:L,y:M},w.current&&clearTimeout(w.current),w.current=setTimeout(()=>{let e=C.current;if(!e)return;let{x:t,y:o}=e,[u,x]=[t/r+i>>>0,o/r+l>>>0],[m,p]=[Math.round(u+s.x),Math.round(x+s.y)],L=n.get(x,u),M=b(L),_=k(L),E=M||_,[S,T]=[m-a,p-c];if(S>=-1&&S<=1&&T>=-1&&T<=1&&E)g(m,p,h.DISMANTLE_MINE);else if(E){let{x:e,y:t}=y(m,p);e===1/0||t===1/0||d.length>0||f(e,t,m,p,(e,t)=>g(e,t,h.DISMANTLE_MINE))}v.current=!0,w.current=null,C.current=null},500)},handlePointerUp:()=>{w.current&&(clearTimeout(w.current),w.current=null),C.current=null},handlePointerMove:e=>{if(!w.current||!C.current)return;let n=t.interactionCanvasRef.current;if(!n)return;let{left:r,top:i}=n.getBoundingClientRect(),[l,o]=[e.clientX-r,e.clientY-i];Math.hypot(l-C.current.x,o-C.current.y)>10&&(clearTimeout(w.current),w.current=null,C.current=null)}}}({canvasRefs:et,tiles:g,tileSize:x,tilePaddingWidth:V,tilePaddingHeight:q,startPoint:m,cursorOriginX:n,cursorOriginY:i,isBombMode:N,movingPaths:en,moveCursor:ec,clickEvent:eg,setClickPosition:M,isAlreadyCursorNeighbor:ex,findOpenedNeighbors:em,findOpenedNeighborsAroundTarget:ey});return!function(e){let{canvasRef:t,activeExplosions:n,removeExplosion:r,tileSize:i,startPoint:l,tilePaddingWidth:s,tilePaddingHeight:a}=e,c=(0,o.useRef)([]);c.current=n;let u=(0,o.useRef)(0),h=(0,o.useRef)(new Map),d=(0,o.useRef)(r);d.current=r;let f=n.length>0;(0,o.useEffect)(()=>{if(!f||u.current)return;let e=t.current;if(!e)return;let n=e.getContext("2d");if(!n)return;let r=e.getBoundingClientRect();e.width=r.width,e.height=r.height,e.style.width=r.width+"px",e.style.height=r.height+"px",n.imageSmoothingEnabled=!0,n.imageSmoothingQuality="low";let o=e=>{let t=h.current,n=t.get(e);if(!n){n=[];let r=9301*e+49297;for(let e=0;e<16;e++)r=(9301*r+49297)%233280,n.push(r/233280*Math.PI*2);t.set(e,n)}return n},g=()=>{let t=c.current,r=performance.now();if(n.clearRect(0,0,e.width,e.height),0===t.length){u.current=0;return}let f=[];for(let c of t){let t=r-c.startTime;if(t>=2e3){f.push(c.id);continue}let u=t/2e3,h=c.position.x-l.x,d=c.position.y-l.y,g=(h+.5-s)*i,x=(d+.5-a)*i,m=4*i;if(u<.08){let t=.25*(1-u/.08);n.fillStyle="rgba(255, 200, 100, ".concat(t,")"),n.fillRect(0,0,e.width,e.height)}if(u<.7){let e=u/.7,t=e*e*m*1.2,r=.35*(1-e);n.save(),n.translate(g,x),n.globalCompositeOperation="lighter";for(let l=0;l<12;l++){let o=l/12*Math.PI*2+.5*u,s=.08*i*(1-.6*e);n.beginPath(),n.moveTo(0,0),n.lineTo(Math.cos(o-s)*t,Math.sin(o-s)*t),n.lineTo(Math.cos(o+s)*t,Math.sin(o+s)*t),n.closePath(),n.fillStyle="rgba(255, 180, 60, ".concat(r,")"),n.fill()}n.globalCompositeOperation="source-over",n.restore()}if(u<.7){let e=u/.7,t=e*e*m*.8,r=.5*(1-e),i=n.createRadialGradient(g,x,0,g,x,t||1);i.addColorStop(0,"rgba(255, 220, 80, ".concat(r,")")),i.addColorStop(.3,"rgba(255, 100, 20, ".concat(.7*r,")")),i.addColorStop(.6,"rgba(200, 40, 10, ".concat(.3*r,")")),i.addColorStop(1,"rgba(150, 20, 5, 0)"),n.beginPath(),n.arc(g,x,t||1,0,2*Math.PI),n.fillStyle=i,n.fill()}for(let e=0;e<5;e++){let t=.1*e,r=Math.max(0,Math.min(1,(u-t)/(1-t)));if(r<=0)continue;let l=r*r*m,o=Math.min(1,r/.15)*Math.max(0,1-(r-.15)/.85)*(1-.12*e),s=Math.max(2,.3*i*(1-.8*r));n.beginPath(),n.arc(g,x,l,0,2*Math.PI),n.strokeStyle="rgba(255, 60, 10, ".concat(.4*o,")"),n.lineWidth=2.5*s,n.stroke(),n.beginPath(),n.arc(g,x,l,0,2*Math.PI),n.strokeStyle="rgba(255, ".concat(80+25*e,", ").concat(10+10*e,", ").concat(o,")"),n.lineWidth=s,n.stroke()}let p=o(c.id);if(u>.02&&u<.8){let e=(u-.02)/.78,t=e*e,r=Math.min(1,e/.1)*Math.max(0,1-(e-.3)/.7);for(let l=0;l<16;l++){let o=t*m*(.6+l%3*.25),s=g+Math.cos(p[l])*o,a=x+Math.sin(p[l])*o,c=Math.max(1,.06*i*(1-.7*e));n.beginPath(),n.arc(s,a,c,0,2*Math.PI),n.fillStyle=l%2==0?"rgba(255, 255, 180, ".concat(r,")"):"rgba(255, 140, 40, ".concat(.8*r,")"),n.fill()}}if(u<.4){let e=u/.4,t=.5*i*(1-e*e),r=1*(1-e);n.beginPath(),n.arc(g,x,t,0,2*Math.PI),n.fillStyle="rgba(255, 255, 240, ".concat(r,")"),n.fill(),n.beginPath(),n.arc(g,x,2*t,0,2*Math.PI),n.fillStyle="rgba(255, 150, 30, ".concat(.5*r,")"),n.fill(),n.beginPath(),n.arc(g,x,3*t,0,2*Math.PI),n.fillStyle="rgba(200, 50, 10, ".concat(.2*r,")"),n.fill()}}f.length>0&&f.forEach(e=>{h.current.delete(e),d.current(e)}),u.current=requestAnimationFrame(g)};return u.current=requestAnimationFrame(g),()=>{u.current&&(cancelAnimationFrame(u.current),u.current=0)}},[f])}({canvasRef:$,activeExplosions:a,removeExplosion:d,tileSize:x,startPoint:m,tilePaddingWidth:V,tilePaddingHeight:q}),(0,o.useEffect)(()=>{let e=e=>e.preventDefault();return window.addEventListener("contextmenu",e),()=>{window.removeEventListener("contextmenu",e),ef()}},[]),(0,o.useEffect)(()=>()=>{ef(),eC()},[]),(0,r.jsxs)(r.Fragment,{children:[ew&&(0,r.jsxs)("div",{className:X().loading,children:[(0,r.jsx)("h1",{children:"Assets Loading..."}),(0,r.jsx)("div",{className:"".concat(g.isEmpty?X().loadingBar:X().loadComplete)})]}),!ew&&(0,r.jsxs)("div",{className:"".concat(X().canvasContainer," ").concat(l>0?X().vibration:""),children:[(0,r.jsx)(ee,{}),(0,r.jsx)(ep,{className:X().canvas,tilePadHeight:q,tilePadWidth:V}),(0,r.jsx)("canvas",{className:X().canvas,id:"ShockwaveCanvas",ref:$,width:L,height:v}),(0,r.jsx)("canvas",{className:X().canvas,id:"OtherCursors",ref:et.otherCursorsRef,width:L,height:v}),(0,r.jsx)("canvas",{className:X().canvas,id:"OtherPointer",ref:et.otherPointerRef,width:L,height:v}),(0,r.jsx)("canvas",{className:X().canvas,id:"MyCursor",ref:et.myCursorRef,width:L,height:v}),(0,r.jsx)("canvas",{className:X().canvas,id:"InteractionCanvas",ref:et.interactionCanvasRef,width:L,height:v,onPointerDown:eL,onPointerUp:eb,onPointerMove:ek,onPointerCancel:eb,onClick:ev})]})]})},ej=n(2723),eR=n.n(ej);function eP(e){let{time:t}=e;return(0,r.jsxs)("div",{className:eR().inactive,children:[(0,r.jsxs)("div",{className:eR().alert,children:[(0,r.jsx)("p",{children:"You`re stunned!"}),(0,r.jsx)("p",{children:"Try Again After"}),(0,r.jsxs)("p",{children:[t/60>>>0,":",(t%60).toString().padStart(2,"0")]})]}),(0,r.jsx)("div",{className:eR().ad,children:"Contact To kkh061101@naver.com"})]})}var eI=n(6324),eA=n.n(eI);function eN(){return(0,r.jsx)("svg",{width:"22",height:"26",viewBox:"0 0 22 26",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,r.jsx)("path",{d:"M0.436226 1.88654C0.321855 0.917668 1.42232 0.282312 2.2042 0.865797L20.8289 14.7645C21.6738 15.3951 21.2476 16.7379 20.1937 16.7657L12.1637 16.978C11.0359 17.0078 9.99976 17.606 9.41006 18.5678L5.21123 25.4159C4.66013 26.3147 3.28415 26.0124 3.16055 24.9653L0.436226 1.88654Z",fill:"white"})})}function eB(){return(0,r.jsx)("svg",{width:"24",height:"14",viewBox:"0 0 24 14",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,r.jsx)("path",{d:"M2 2L11.5286 11.5286C11.7889 11.7889 12.2111 11.7889 12.4714 11.5286L22 2",stroke:"white",strokeWidth:"4",strokeLinecap:"round"})})}function eF(){return(0,r.jsxs)("svg",{width:"32",height:"32",viewBox:"0 0 32 32",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,r.jsx)("path",{d:"M20 5L26 5C26.5523 5 27 5.44772 27 6L27 12",stroke:"white",strokeWidth:"4",strokeLinecap:"round"}),(0,r.jsx)("path",{d:"M12 27L6 27C5.44772 27 5 26.5523 5 26L5 20",stroke:"white",strokeWidth:"4",strokeLinecap:"round"}),(0,r.jsx)("path",{d:"M5 12L5 6C5 5.44772 5.44772 5 6 5L12 5",stroke:"white",strokeWidth:"4",strokeLinecap:"round"}),(0,r.jsx)("path",{d:"M27 20L27 26C27 26.5523 26.5523 27 26 27L20 27",stroke:"white",strokeWidth:"4",strokeLinecap:"round"})]})}function eO(){return(0,r.jsxs)("svg",{width:"32",height:"32",viewBox:"0 0 32 32",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,r.jsx)("circle",{cx:"14",cy:"14",r:"9",stroke:"white",strokeWidth:"4"}),(0,r.jsx)("path",{d:"M27 27L21.5 21.5",stroke:"white",strokeWidth:"4",strokeLinecap:"round"})]})}function eD(){return(0,r.jsx)("svg",{width:"24",height:"14",viewBox:"0 0 24 14",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,r.jsx)("path",{d:"M2 12L11.5286 2.4714C11.7889 2.21105 12.2111 2.21106 12.4714 2.4714L22 12",stroke:"white",strokeWidth:"4",strokeLinecap:"round"})})}function eW(e){var t;let{renderRange:n,maxTileCount:i}=e,l=G(),{x:a,y:h}=c(),{useAnimation:d,setAnimation:f}=u(),{windowWidth:g,windowHeight:x}=s(),{zoom:m,zoomDown:p,zoomUp:y,originPosition:w,score:C,items:v,setIsBombMode:L,isBombMode:b}=Y(),k=null!==(t=null==v?void 0:v.bomb)&&void 0!==t?t:0,M=g*n/(l/1.5),_=x*n/(l/1.5),[E,S]=(0,o.useState)(!0),T=()=>M*_>i;return(0,r.jsx)("div",{className:eA().dashboard,children:(0,r.jsxs)("div",{className:eA().bottom,children:[(0,r.jsxs)("div",{className:eA().toggle,onPointerDown:()=>S(!E),children:[!E&&(0,r.jsx)(eB,{}),E&&(0,r.jsx)(eD,{})]}),E&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:eA().score,children:[C," pts"]}),(0,r.jsxs)("div",{className:eA().coordinates,children:[(0,r.jsxs)("p",{children:["\xa0",(0,r.jsx)(eN,{}),"(",w.x,", ",w.y,")"]}),(0,r.jsxs)("p",{children:[(0,r.jsx)(eF,{}),"\xa0(",a===1/0?"":a,", ",h===1/0?"":h,")"]}),(0,r.jsxs)("button",{type:"button",className:"".concat(eA().bomb," ").concat(b?eA().bombMode:""),onClick:()=>L(!b),children:[(0,r.jsx)("span",{children:"\uD83D\uDCA3"}),(0,r.jsxs)("span",{children:["X ",k]})]}),(0,r.jsxs)("p",{className:eA().animation,onClick:()=>f(!d),children:[(0,r.jsx)("input",{type:"checkbox",checked:d,readOnly:!0}),"Animation"]})]}),(0,r.jsxs)("div",{className:eA().zoom,children:[(0,r.jsxs)("p",{children:[(0,r.jsx)(eO,{}),"\xa0",Math.ceil(100*m),"%"]}),(0,r.jsxs)("div",{className:eA().buttons,children:[(0,r.jsx)("button",{onPointerDown:()=>!T()&&p(),children:"-"}),(0,r.jsx)("button",{onPointerDown:y,children:"+"})]})]})]})]})})}var eU=n(1071),ez=n.n(eU),eH=n(3145),eZ=JSON.parse('{"a":[{"id":1,"gif":"/mainvideos/moving.gif","description":{"en":"Click Open Tile to move cursor","ko":"열린 타일을 클릭하여 커서를 이동하세요"}},{"id":2,"gif":"/mainvideos/block.gif","description":{"en":"If the path to the tile you clicked is blocked, you cannot move.","ko":"클릭한 타일로 가는 길이 막혀있을 경우 이동이 되지 않습니다."}},{"id":3,"gif":"/mainvideos/zoom.gif","description":{"en":"Click - and + buttons to zoom in and out","ko":"확대 및 축소 버튼을 클릭하여 확대 및 축소하세요"}},{"id":4,"gif":"/mainvideos/open_tile.gif","description":{"en":"Click left mouse button on closed tile to open tile","ko":"닫힌 타일에 왼쪽 마우스 버튼을 클릭하여 타일을 엽니다"}},{"id":5,"gif":"/mainvideos/flag.gif","description":{"en":"Click right mouse button on open tile to flag tile","ko":"열린 타일에 오른쪽 마우스 버튼을 클릭하여 타일을 깃발로 표시하세요"}},{"id":6,"gif":"/mainvideos/mine.gif","description":{"en":"If the tile you clicked is a mine, you get a stun for 3 minutes","ko":"클릭한 타일이 지뢰인 경우 3분간 스턴을 받습니다"}},{"id":7,"gif":"/mainvideos/chat.gif","description":{"en":"If you click on a tile that is not a mine, the number of mines around the tile will be displayed","ko":"엔터 버튼을 누를 경우 채팅이 활성화 되며, 끄려면 ESC를 누르세요. 입력하고 엔터를 다시 누를 경우 채팅이 전송됩니다."}}]}'),eG=n(9376);function eK(){return(0,r.jsxs)("svg",{width:"120",height:"120",viewBox:"0 0 120 120",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,r.jsx)("path",{d:"M25 55L58.2322 21.7678C59.2085 20.7915 60.7915 20.7915 61.7678 21.7678L95 55",stroke:"white",strokeWidth:"10",strokeLinecap:"round"}),(0,r.jsx)("path",{d:"M25 90L58.2322 56.7678C59.2085 55.7915 60.7915 55.7915 61.7678 56.7678L95 90",stroke:"white",strokeWidth:"10",strokeLinecap:"round"})]})}function eV(){return(0,r.jsxs)("svg",{width:"120",height:"120",viewBox:"0 0 120 120",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,r.jsx)("path",{d:"M25 65L58.2322 98.2322C59.2085 99.2085 60.7915 99.2085 61.7678 98.2322L95 65",stroke:"white",strokeWidth:"10",strokeLinecap:"round"}),(0,r.jsx)("path",{d:"M25 30L58.2322 63.2322C59.2085 64.2085 60.7915 64.2085 61.7678 63.2322L95 30",stroke:"white",strokeWidth:"10",strokeLinecap:"round"})]})}function eX(){let e="https://gamultong.github.io/gamulpung-client",t=(0,eG.useSearchParams)().get("lang")||"ko",[n,i]=(0,o.useState)(-1),l=eZ.a[n];return(0,o.useEffect)(()=>{"done"!==localStorage.getItem("tutorial")&&i(0)},[]),(0,r.jsx)(r.Fragment,{children:-1!==n&&(0,r.jsxs)("div",{className:ez().tutorial,children:[(0,r.jsx)("div",{className:ez().button,onClick:()=>i(n>0?n-1:n),children:n>0&&(0,r.jsx)(eK,{})}),(0,r.jsxs)("div",{className:ez().step,children:[(0,r.jsx)(eH.default,{src:"".concat(e).concat(l.gif),alt:l.gif,width:400,height:225}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("p",{children:["Step ",l.id]}),(0,r.jsx)("p",{children:l.description[t]})]})]}),(0,r.jsx)("div",{className:ez().button,onClick:()=>{n<eZ.a.length-1?i(n+1):(i(-1),localStorage.setItem("tutorial","done"))},children:eZ.a.length-1>n?(0,r.jsx)(eV,{}):(0,r.jsx)(eH.default,{src:"".concat(e,"/icon.png"),alt:"Play",width:88,height:88})})]})})}var eY=n(1871),eJ=n.n(eY),eQ=()=>(0,r.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,r.jsx)("path",{d:"M3.75 17.25H20.25V18.75C20.25 19.5784 19.5784 20.25 18.75 20.25H5.25C4.42157 20.25 3.75 19.5784 3.75 18.75V17.25Z",fill:"#FFB743"}),(0,r.jsx)("path",{d:"M20.25 15.75H3.75L2.48723 6.91058C2.39554 6.2688 3.1063 5.82087 3.64571 6.18047L7.875 9L11.36 3.29721C11.6525 2.81866 12.3475 2.81866 12.64 3.29721L16.125 9L20.3543 6.18048C20.8937 5.82087 21.6045 6.2688 21.5128 6.91058L20.25 15.75Z",fill:"#FFB743"})]});let eq=(0,a.U)(e=>({rankings:[{ranking:1,score:12345},{ranking:2,score:12345},{ranking:3,score:12345},{ranking:4,score:12345},{ranking:5,score:12345},{ranking:6,score:12345},{ranking:7,score:12345},{ranking:8,score:12345},{ranking:9,score:12345},{ranking:10,score:12345}],setRanking:t=>e({rankings:t})}));function e$(){let{rankings:e}=eq(),[t,n]=(0,o.useState)(!0);return(0,r.jsxs)("div",{className:eJ().scoreboard,children:[(0,r.jsxs)("div",{className:eJ().toggle,onPointerDown:()=>n(!t),children:[(0,r.jsx)("span",{children:"RANK"}),t?(0,r.jsx)(eB,{}):(0,r.jsx)(eD,{})]}),t&&(0,r.jsx)("div",{className:eJ().scoreList,children:e.map((e,t)=>(0,r.jsxs)("div",{className:eJ().scoreItem,children:[(0,r.jsxs)("span",{children:["#",e.ranking," ",1===e.ranking&&(0,r.jsx)(eQ,{})]}),(0,r.jsx)("span",{children:e.score})]},t))})]})}(0,a.U)(e=>({ranking:0,score:0,setRanking:t=>e({ranking:t.ranking,score:t.score})}));var e0=n(9720),e1=n.n(e0);function e2(){let[e,t]=(0,o.useState)(!1),{nodes:n,edges:i,onNodesChange:l,onEdgesChange:s,selectedSkill:a,onNodeClick:c,purchaseSkill:u,isPurchased:h}=eM();return(0,r.jsxs)("div",{className:"".concat(e1().skillTree," ").concat(e?e1().closed:""),children:[(0,r.jsx)("span",{children:"SKILL TREE"}),!e&&(0,r.jsxs)("div",{className:e1().skillContainer,children:[(0,r.jsx)("div",{className:e1().skillInfo,children:a?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:e1().skillName,children:a.name}),(0,r.jsxs)("p",{className:e1().skillCost,children:[a.cost.toLocaleString()," G"]}),(0,r.jsx)("p",{className:e1().skillDesc,children:a.description})]}),!h&&(0,r.jsx)("button",{onClick:u,children:"BUY"})]}):(0,r.jsx)("span",{className:e1().skillPlaceholder,children:"SKILL INFO"})}),(0,r.jsx)("div",{className:e1().skillCanvas,children:(0,r.jsx)(eC.x$,{nodes:n,edges:i,onNodesChange:l,onEdgesChange:s,onNodeClick:c,nodesDraggable:!1,fitView:!0,children:(0,r.jsx)(eC.Aq,{})})})]}),(0,r.jsx)("button",{onClick:()=>t(!e),className:e1().toggleButton,children:e?"OPEN":"CLOSE"})]})}function e5(){let{}=c(),{isOpen:e,sendMessage:t,connect:n,disconnect:i}=Q(),{position:a,zoom:u,originPosition:g}=Y(),{zoomUp:x,zoomDown:m,setZoom:p}=Y(),y=W(),{startPoint:w,endPoint:L,renderStartPoint:b,setTiles:k,setRenderTiles:M,setStartPoint:_,setEndPoint:E,setRenderStartPoint:S,setTileSize:I,padtiles:A,applyTileChanges:O,applyPackedChanges:U,reset:z}=D(),{windowWidth:H,windowHeight:Z}=s(),[G,V]=(0,o.useState)(-1),[X,q]=(0,o.useState)(!1),$=(0,o.useRef)(null),ee=(0,o.useRef)(!1),{activeExplosions:et,onExplosion:en,removeExplosion:er}=function(){let[e,t]=(0,o.useState)([]),n=(0,o.useRef)(0);return{activeExplosions:e,onExplosion:(0,o.useCallback)(e=>{let r=++n.current;t(t=>[...t,{id:r,position:e,startTime:performance.now()}])},[]),removeExplosion:(0,o.useCallback)(e=>{t(t=>t.filter(t=>t.id!==e))},[])}}(),{replaceTiles:ei}=function(e){let{padtiles:t,startPoint:n,cachingTiles:r,cursorPosition:i,cursorOriginPosition:l,renderStartPoint:s,setTiles:a,setRenderTiles:c,applyTileChanges:u,applyPackedChanges:h}=e;(0,o.useEffect)(()=>{N().catch(e=>console.warn("WASM tile engine init failed, will use JS fallback:",e))},[]);let d=(0,o.useCallback)(function(e,t,n,r,i,l,o){let s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,a=arguments.length>8&&void 0!==arguments[8]?arguments[8]:-1,c=Math.abs(e-n+1)<<1,u=c>>1,h=Math.abs(r-t+1),d=t-o.y,f="All"===l?0:n-o.x-1,g=-1===a?h*u:a,x=[],m=D.getState().tiles;for(let e=s;e<g;e++){let n=Math.floor(e/u),r=e%u,l=h-1-n,s=l+d;if(s<0||s>=m.height||0===m.width)continue;let a=t-l,g=Math.max(0,-f),p=Math.min(u,m.width-f);if(r<g||r>=p)continue;let y=n*c+(r<<1),w=C[i.charCodeAt(y)<<8|i.charCodeAt(y+1)];if(255===w)continue;let L=r+f,b=L+a+o.x&1,k=v.FILL;w<8?k=w:8===w?k=v.BOMB:24===w?k=T(b):w>=16&&w<24&&(k=j(w-16>>1,b)),m.get(s,L)!==k&&x.push({row:s,col:L,value:k})}return x},[]),g=(0,o.useCallback)(async(e,r,i,l,o,s)=>{if(0===o.length)return;console.log("replaceTiles",s,performance.now()),"All"===s&&t(i,l,e,r,f.ALL);let c=i+1,g=e-1,x="All"===s,m=P;if(m){let e=D.getState().tiles,t=B.encode(o);if(m.process_hex_tiles_inplace){let i=e.clone();m.process_hex_tiles_inplace(t,i.data,i.width,i.height,g,r,c,l,n.x,n.y,x)>0&&a(i)}else h(m.process_hex_tiles(t,e.data,e.width,e.height,g,r,c,l,n.x,n.y,x))}else u(d(g,r,c,l,o,s,n));console.log("replace",performance.now());let p=D.getState().tiles;p.isEmpty||function(e,t,n,r,i){for(let l=0;l<i;l++)for(let i=0;i<r;i++){let o=n[l*r+i];o!==v.FILL&&F.set("".concat(e+i,",").concat(t+l),o)}if(F.size>1e5){let e=F.size-1e5,t=0;for(let n of F.keys()){if(t>=e)break;F.delete(n),t++}}}(n.x,n.y,p.data,p.width,p.height)},[t,d,n,u,h,a]),x=(0,o.useMemo)(()=>{if(r.isEmpty)return R.empty();let e=l.x-i.x,t=l.y-i.y;return 0===e&&0===t?r:function(){let n=r.data,i=r.width,l=r.height,o=new R(i,l),a=o.data;a.fill(v.FILL);let c=Math.max(0,t),u=Math.min(l,l+t),h=Math.max(0,e),d=Math.min(i,i+e),f=Math.max(0,-t),g=Math.max(0,-e),x=d-h;if(x<=0||u<=c)return o;let m=u-c;for(let e=0;e<m;e++){let t=(c+e)*i+h,r=(f+e)*i+g;a.set(n.subarray(t,t+x),r);let l=s.y+f+e;for(let e=0;e<x;e++){let t=a[r+e];if(t>=16&&t<=39){let n=s.x+g+e;a[r+e]=254&t|n+l&1}}}return o}()},[r,l,s]);return(0,o.useLayoutEffect)(()=>{c(x)},[x,c]),{replaceTiles:g}}({padtiles:A,startPoint:w,cachingTiles:y,cursorPosition:a,cursorOriginPosition:g,renderStartPoint:b,setTiles:k,setRenderTiles:M,applyTileChanges:O,applyPackedChanges:U}),{getCurrentTileWidthAndHeight:el}=function(e){let{zoom:t,windowWidth:n,windowHeight:r,cursorPosition:i,cursorOriginPosition:l,isInitialized:s,setStartPoint:a,setEndPoint:c,setRenderStartPoint:u,setTileSize:d,sendMessage:f}=e,g=(0,o.useCallback)(()=>{let e=80*t;return{width:1.5*n/e/2>>>0,height:1.5*r/e/2>>>0}},[t,n,r]);(0,o.useLayoutEffect)(()=>{let e=80*t,[o,s]=[1.5*n/e/2>>>0,1.5*r/e/2>>>0];s<1||o<1||(a({x:i.x-o,y:i.y-s}),c({x:i.x+o,y:i.y+s}),u({x:l.x-o,y:l.y-s}),d(e))},[n,r,t,l,i,s]);let x=(0,o.useRef)(null);return(0,o.useLayoutEffect)(()=>{s&&(x.current&&clearTimeout(x.current),x.current=setTimeout(()=>{let e=g();f(h.SET_WINDOW,e)},200))},[n,r,t,s]),(0,o.useEffect)(()=>()=>{x.current&&clearTimeout(x.current)},[]),{getCurrentTileWidthAndHeight:g}}({zoom:u,windowWidth:H,windowHeight:Z,cursorPosition:a,cursorOriginPosition:g,isInitialized:X,setStartPoint:_,setEndPoint:E,setRenderStartPoint:S,setTileSize:I,sendMessage:t}),eo=e=>{let t=e.key.toLowerCase();switch(["-","="].includes(t)&&e.preventDefault(),t){case"-":m();break;case"=":x()}};return(0,o.useLayoutEffect)(()=>(document.documentElement.style.overflow="hidden",q(!1),p(1),document.addEventListener("keydown",eo),()=>{document.documentElement.style.overflow="auto",document.removeEventListener("keydown",eo),$.current&&(clearTimeout($.current),$.current=null),i(),z(),q(!1),V(-1)}),[]),(0,o.useLayoutEffect)(()=>{e||w.x===L.x||L.y===w.y||(V(-1),ee.current||(n(K),ee.current=!0))},[e,w]),!function(e){let{getCurrentTileWidthAndHeight:t,replaceTiles:n,replaceBinaryTiles:r,setLeftReviveTime:i,setIsInitialized:l,onExplosion:s}=e,{sendMessage:a}=Q(),{setRanking:c}=eq(),u=(0,o.useCallback)(async e=>{let{MY_CURSOR:r,CHAT:o,CURSORS_STATE:u,EXPLOSION:f,QUIT_CURSOR:g,SCOREBOARD_STATE:x,TILES_STATE:m}=d,{position:p,id:y,setPosition:w,setOriginPosition:C,setId:v,setScore:L,setItems:b}=Y.getState(),{cursors:k,setCursors:M}=J.getState();try{let{header:d,payload:_}=JSON.parse(e),{event:E}=d;switch(E){case m:{let{tiles_li:e}=_;for(let r of e){let{data:e,range:i}=r,{top_left:l,bottom_right:o}=i,{width:s,height:a}=t(),[c,u]=[o.x-l.x+1,l.y-o.y+1],[h,d]=[c/2>>>0,u/2>>>0],f="PART";h===s&&d===a&&(f="All"),await n(l.x,o.y,o.x,l.y,e,f)}break}case f:{let{position:e}=_,{x:t,y:n}=e;s(e);let{x:r,y:l}=p;r>=t-1&&r<=t+1&&l>=n-1&&l<=n+1&&(console.log("explosion",performance.now()),i(10));break}case x:{let{scoreboard:e}=_;c(Object.entries(e).map(e=>{let[t,n]=e;return{ranking:+t,score:n}}));let n=t();y||a(h.CREATE_CURSOR,n);break}case u:{let{cursors:e}=_,t=new Map;for(let n of e){if(n.id===y){L(n.score),b(n.items),w(n.position),C(n.position);continue}t.set(n.id,{color:"red",id:n.id,position:n.position,message:"",messageTime:0,pointer:{x:1/0,y:1/0},score:n.score,revive_at:new Date(n.active_at).getTime(),items:n.items})}let n=[],r=new Set;for(let e of k){let i=t.get(e.id);i?(n.push(i),r.add(e.id)):n.push(e)}for(let[e,i]of t)r.has(e)||n.push(i);M(n);break}case r:{let{id:e}=_;v(e),setTimeout(()=>l(!0),0);break}case g:{let{id:e}=_;M(k.filter(t=>t.id!==e));break}case o:{let{id:e,message:t}=_,n=k.map(n=>n.id!==e?n:{...n,message:t,messageTime:Date.now()+8e3});M(n)}}}catch(e){console.error(e)}},[n,i,l,t,a,c,s]),f=(0,o.useCallback)(async e=>{if(r)try{let t=new Uint8Array(e);await r(t)}catch(e){console.error("Binary message error:",e)}},[r]),{message:g}=Q();(0,o.useLayoutEffect)(()=>{g&&u(g)},[g]);let{binaryMessage:x}=Q();(0,o.useLayoutEffect)(()=>{x&&f(x)},[x])}({getCurrentTileWidthAndHeight:el,replaceTiles:ei,setLeftReviveTime:V,setIsInitialized:q,onExplosion:en}),(0,o.useEffect)(()=>(G>0&&($.current=setTimeout(()=>V(e=>e>0?e-1:e),1e3)),()=>{$.current&&(clearTimeout($.current),$.current=null)}),[G]),(0,r.jsxs)("div",{className:l().page,children:[G>0&&(0,r.jsx)(eP,{time:G}),(0,r.jsx)(eX,{}),(0,r.jsx)(e$,{}),(0,r.jsx)(e2,{}),(0,r.jsx)(eW,{renderRange:1.5,maxTileCount:2e4}),(0,r.jsx)(eT,{leftReviveTime:G,paddingTiles:1.5,cursorOriginX:g.x,cursorOriginY:g.y,activeExplosions:et,removeExplosion:er})]})}n(6190)},7397:function(e){e.exports={page:"page_page__9CbJ0"}},6507:function(e){e.exports={loading:"style_loading__42LVe",loadingBar:"style_loadingBar__AtBJr",loadingAnimation:"style_loadingAnimation__ScSQQ",loadComplete:"style_loadComplete__SRD5Z",canvasContainer:"style_canvasContainer__nKMjH",canvas:"style_canvas__m8mJO",vibration:"style_vibration__6_Fiw"}},6324:function(e){e.exports={dashboard:"style_dashboard__nDsof",bottom:"style_bottom___8aLI",score:"style_score__vmqZh",coordinates:"style_coordinates__3RzzR",animation:"style_animation__Kv66j",bomb:"style_bomb__yX97I",bombMode:"style_bombMode__KI65w",toggle:"style_toggle__R68Vw",zoom:"style_zoom__EWfUf",buttons:"style_buttons__zf0nF"}},2698:function(e){e.exports={chat:"style_chat__ZTXhD",message:"style_message__uEVba"}},2723:function(e){e.exports={inactive:"style_inactive__B_gRa",fade:"style_fade__sZevv",alert:"style_alert__pv_lG",ad:"style_ad__2DN3O"}},1871:function(e){e.exports={scoreboard:"style_scoreboard__Th1NE",scoreList:"style_scoreList__P4ewN",scoreItem:"style_scoreItem__lRMtn",toggle:"style_toggle__axVEQ"}},9720:function(e){e.exports={skillTree:"style_skillTree__I_uYb",skillContainer:"style_skillContainer__pchHZ",skillCanvas:"style_skillCanvas__Keawm",skillInfo:"style_skillInfo__K5nQm",skillName:"style_skillName__A7_1D",skillDesc:"style_skillDesc__s_Ail",skillCost:"style_skillCost__9pUKk",skillPlaceholder:"style_skillPlaceholder__2iOpv",toggleButton:"style_toggleButton__SGLp4",closed:"style_closed__3UTSI"}},1071:function(e){e.exports={tutorial:"style_tutorial__75p5w",step:"style_step__kswJY",fade:"style_fade__KaBU4",button:"style_button__rjKit"}}},function(e){e.O(0,[398,690,167,145,407,214,971,117,744],function(){return e(e.s=6124)}),_N_E=e.O()}]);