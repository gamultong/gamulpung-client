# 웹소켓 이벤트 종류  

## 1. 요약  
웹소켓 메시지 핸들러는 서버에서 보내는 다양한 이벤트를 처리합니다. 각 이벤트는 그 유형과 연관된 데이터(payload)에 따라 특정 작업을 트리거합니다. 이를 통해 타일, 커서 위치 및 사용자 동작을 처리하며, 클라이언트와 서버 간 동기화를 유지합니다.  

| 요청 이름               | 설명                                                                |  
|----------------------|--------------------------------------------------------------------|  
| `Create Connection`   | 클라이언트의 화면 크기를 URL 쿼리 문자열에 포함하여 서버에 웹소켓 연결을 생성합니다.  |  
| `fetch-tiles`         | 지정된 범위의 타일 데이터를 서버에 요청합니다.                                 |  
| `set-view-size`       | 클라이언트의 현재 화면 크기를 서버에 전달하여 보이는 영역에 따라 타일을 최적화합니다.            |  
| `pointing`            | 커서 위치를 서버에 전송하며 동시에 특정 타일에 클릭 동작을 수행합니다.                |  
| `moving`              | 타겟 위치로 이동을 요청하며, 규칙에 따라 이동 가능 여부를 확인합니다.                  |  

| 이벤트 이름           | 목적                                 | 주요 동작                                          |  
|----------------------|--------------------------------------|--------------------------------------------------|  
| `tiles`             | 요청한 타일 그리드 업데이트 처리.             | `replaceTiles`로 그리드 업데이트.                      |  
| `flag-set`          | 타일 플래그 처리.                        | 캐시된 타일 데이터 업데이트.                          |  
| `tile-updated`      | 동적으로 타일 상태 업데이트.                | 페이로드에 따라 타일 그리드 수정.                        |  
| `my-cursor`         | 초기 사용자 정보 설정.                   | 커서 위치, 색상 및 포인터 정보 업데이트.                  |  
| `you-died`          | 사용자 사망 카운트다운 관리.               | 부활 시간을 계산하고 설정.                             |  
| `cursors`           | 다른 사용자 커서 업데이트.                 | 커서 위치와 색상 정규화 후 상태 업데이트.                  |  
| `moved`             | 커서 이동 이벤트 업데이트.                 | 커서 위치를 동적으로 조정.                               |  
| `cursor-quit`       | 게임을 종료한 사용자의 커서를 제거.           | 상태에서 커서 데이터를 삭제.                             |  

---

## 2. 요청 유형 및 동작  

### 2.1. `Create Connection` 요청  
웹소켓 연결을 생성할 때, URL에 화면 가로(width)와 세로(height) 정보를 쿼리 문자열로 추가합니다.  
목적: 클라이언트 브라우저에서 렌더링할 수 있는 타일 수를 서버가 확인합니다.  

---

### 2.2. `fetch-tiles` 요청  
타일 데이터를 요청하기 위해 `fetch-tiles` 요청을 서버로 보냅니다. 이 요청은 특정 좌표 범위와 함께 정의된 영역의 타일 정보를 가져옵니다.  

**요청 본문 필드**  
| 필드 이름    | 타입    | 설명                                                  |  
|-----------|--------|--------------------------------------------------|  
| `start_p` | 객체   | 요청 타일 범위의 시작 위치를 정의합니다.                          |  
| `start_p.x` | 숫자   | 시작점의 x좌표.                                        |  
| `start_p.y` | 숫자   | 시작점의 y좌표.                                        |  
| `end_p`   | 객체   | 요청 타일 범위의 끝 위치를 정의합니다.                          |  
| `end_p.x` | 숫자   | 끝점의 x좌표.                                          |  
| `end_p.y` | 숫자   | 끝점의 y좌표.                                          |  

---

### 2.3. `set-view-size` 요청  
현재 클라이언트 화면 또는 디스플레이 영역의 크기를 서버에 알립니다. 이를 통해 서버가 클라이언트가 볼 수 있는 영역에 기반하여 타일 데이터를 최적화할 수 있습니다.  

**요청 본문 필드**  
| 필드 이름   | 타입    | 설명                                                |  
|--------|--------|--------------------------------------------------|  
| `width`  | 숫자   | 현재 화면 또는 보이는 영역의 가로 크기(타일 단위).              |  
| `height` | 숫자   | 현재 화면 또는 보이는 영역의 세로 크기(타일 단위).              |  

---

### 2.4. `pointing` 요청  
현재 커서 위치를 서버에 전송하며, 동시에 특정 타일에 클릭 동작을 수행합니다. 서버는 이 이벤트를 처리하고 업데이트된 커서 정보나 타일 상태를 응답으로 보냅니다.  

**요청 본문 필드**  
| 필드 이름       | 타입       | 설명                                                |  
|-------------|----------|--------------------------------------------------|  
| `position.x`| 정수      | 커서 위치의 x좌표.                                     |  
| `position.y`| 정수      | 커서 위치의 y좌표.                                     |  
| `click_type`| 문자열     | 클릭 상호작용 유형(`GENERAL_CLICK` 또는 `SPECIAL_CLICK`). |  

---

### 2.5. `moving` 요청  
플레이어가 이동하려는 대상 위치를 서버로 전송합니다. 서버는 이 이벤트를 처리하고 규칙에 따라 이동 가능 여부를 확인합니다.  

**요청 본문 필드**  
| 필드 이름       | 타입       | 설명                                |  
|-------------|----------|----------------------------------|  
| `position.x`| 정수      | 타겟 위치의 x좌표.                     |  
| `position.y`| 정수      | 타겟 위치의 y좌표.                     |  

---

## 3. 이벤트 유형 및 동작  

### 3.1. `tiles` 이벤트  
- **목적**: 사용자가 요청한 타일을 처리합니다.  
- **페이로드**: 타일 그리드 및 경계 위치 데이터를 포함합니다.  
- **동작**:  
  - 타일 그리드(`unsortedTiles`)와 경계 위치(`start_p`, `end_p`)를 추출합니다.  
  - `replaceTiles`를 호출해 타일 그리드를 업데이트합니다.  

---  

### 3.2. `flag-set` 및 `tile-updated` 이벤트  
- **목적**: 요청되지 않은 타일 업데이트 또는 타일 플래그 처리.  
- **페이로드**: 타일의 위치, 상태, 시각적 속성에 대한 세부 정보 포함.  
- **동작**:  
  - 캐시된 타일을 `setCachingTiles`로 업데이트합니다.  
  - 타일 상태에 따라 다음을 결정합니다:  
    - **열린 타일**:  
      - 지뢰 포함 → `'B'`로 설정.  
      - 지뢰 미포함 → 주변 지뢰 수(`number`)를 표시.  
    - **닫힌 타일**:  
      - 플래그 설정 → `'F'` 및 타일 색상으로 표시.  
      - 플래그 미설정 → `'C'`로 표시.  
      - 타일 위치의 패턴(`0` 또는 `1`)에 따라 시각적 변화를 줍니다.  
### 3.3. `my-cursor` 이벤트  
- **목적**: 현재 사용자 정보를 초기화하고 커서 상태를 설정합니다.  
- **페이로드**: 사용자의 초기 좌표와 커서 색상을 포함합니다.  
- **동작**:  
  1. 서버에서 제공하는 좌표(`x`, `y`)와 색상 데이터를 기반으로 사용자 커서를 설정합니다.  
  2. `setMyCursor`를 호출해 커서 정보를 업데이트합니다.  

---

### 3.4. `you-died` 이벤트  
- **목적**: 사용자가 "사망" 상태로 전환된 후 부활 대기 시간을 관리합니다.  
- **페이로드**: 부활 대기 시간(`revive_time`)을 포함합니다.  
- **동작**:  
  1. 현재 시간을 기준으로 부활 가능 시간을 계산합니다.  
  2. `setReviveTime`을 호출해 부활 대기 상태를 설정합니다.  

---

### 3.5. `cursors` 이벤트  
- **목적**: 현재 게임 내 다른 사용자들의 커서 상태를 업데이트합니다.  
- **페이로드**: 다른 사용자들의 커서 좌표와 색상 정보를 포함합니다.  
- **동작**:  
  1. 사용자 커서 데이터는 클라이언트에서 정규화됩니다.  
  2. `setCursors`를 호출해 현재 커서 상태를 동기화합니다.  

---

### 3.6. `moved` 이벤트  
- **목적**: 특정 커서의 이동 이벤트를 처리합니다.  
- **페이로드**: 이동한 커서의 최종 위치와 상태를 포함합니다.  
- **동작**:  
  1. 이동한 사용자 커서를 확인합니다.  
  2. `moveCursor`를 호출해 새로운 좌표로 커서를 업데이트합니다.  

---

### 3.7. `cursor-quit` 이벤트  
- **목적**: 게임을 종료하거나 접속을 끊은 사용자의 커서를 제거합니다.  
- **페이로드**: 연결이 끊어진 사용자의 ID 정보를 포함합니다.  
- **동작**:  
  1. 특정 사용자 ID에 해당하는 커서를 제거합니다.  
  2. `removeCursor`를 호출해 클라이언트에서 상태를 업데이트합니다.  
